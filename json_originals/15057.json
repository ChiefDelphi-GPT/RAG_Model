{"data":"{\"post_stream\":{\"posts\":[{\"id\":3011036,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-21T23:45:49.237Z\",\"cooked\":\"\\u003cp\\u003eHeyo! This is my team’s first year building our own swerve drive and we’re having some issues~ We notice that when setting the target for our motors our pid works fine, but since we’re aiming for a rotational target, our controllers are making an odd reaction.\\u003c/p\\u003e\\n\\u003cp\\u003eIt seems that they dont have a wrap-around feature, when we ask the controller to move from 3.1, to -3.1 (a small angle) it instead wraps in reverse and takes the long route all the way through 0 when it should take a much shorter route.\\u003c/p\\u003e\\n\\u003cp\\u003eWe noticed rev did not seem to have methods for this type of thing so we experimented with using a sum that would take the difference between two rotation2ds as a value in radians and append it but we seem to be loosing radians and steps and overall it feels very clunky… Has anybody else encountered a similar problem and how did you fix it?\\u003c/p\\u003e\\n\\u003cp\\u003eWe’ve recently looked at just ditching rev PID for the steering alltogether, and simply piping values over can to use the wpilib pid controller witch does have an angular wrap around feature.\\u003c/p\\u003e\",\"post_number\":1,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-21T23:45:49.237Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1033,\"reads\":392,\"readers_count\":391,\"score\":5243.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://www.chiefdelphi.com/t/translating-code-from-wpilib-pidcontroller-to-revlib-sparkmaxpidcontroller/404624/2\",\"internal\":true,\"reflection\":true,\"title\":\"Translating code from WPILIB PIDController to REVLIB SparkMaxPIDController\",\"clicks\":0}],\"read\":true,\"user_title\":null,\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/1\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null,\"can_vote\":false},{\"id\":3011048,\"name\":\"Joe Ross\",\"username\":\"Joe_Ross\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/joe_ross/{size}/37_2.png\",\"created_at\":\"2022-02-22T00:29:33.631Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"kenwoodfox\\\" data-post=\\\"1\\\" data-topic=\\\"403608\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/kenwoodfox/48/127503_2.png\\\" class=\\\"avatar\\\"\\u003e kenwoodfox:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eIt seems that they dont have a wrap-around feature,\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eFrom the Rev trello:\\u003cbr\\u003e\\n          \\u003ciframe src=\\\"https://trello.com/c/bvnPPcZD.html\\\" width=\\\"100%\\\" height=\\\"200\\\" frameborder=\\\"0\\\" style=\\\"border:0\\\" seamless=\\\"seamless\\\" sandbox=\\\"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation\\\"\\u003e\\u003c/iframe\\u003e\\n\\u003c/p\\u003e\",\"post_number\":2,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-22T00:30:28.447Z\",\"reply_count\":2,\"reply_to_post_number\":null,\"quote_count\":1,\"incoming_link_count\":6,\"reads\":362,\"readers_count\":361,\"score\":142.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"Joe Ross\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":2}],\"moderator\":true,\"admin\":false,\"staff\":true,\"user_id\":65,\"hidden\":false,\"trust_level\":4,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/2\",\"custom_user_title\":null,\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2}],\"current_user_reaction\":null,\"reaction_users_count\":2,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3011051,\"name\":\"Ryan Blue\",\"username\":\"Ryan_Blue\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/ryan_blue/{size}/174016_2.png\",\"created_at\":\"2022-02-22T00:35:44.087Z\",\"cooked\":\"\\u003cp\\u003eThat’s just a feature request though, with no activity since November.\\u003c/p\\u003e\",\"post_number\":3,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-22T00:35:44.087Z\",\"reply_count\":1,\"reply_to_post_number\":2,\"quote_count\":0,\"incoming_link_count\":6,\"reads\":332,\"readers_count\":331,\"score\":101.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"Ryan Blue\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":65,\"username\":\"Joe_Ross\",\"name\":\"Joe Ross\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/joe_ross/{size}/37_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":29846,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"WPILib Dev | 1024 Mentor\"},\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/3\",\"custom_user_title\":\"WPILib Dev | 1024 Mentor\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3011078,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-22T01:56:24.345Z\",\"cooked\":\"\\u003cp\\u003eI have been linked to the trello board a LOT and im sorry to say that even features they move to done are not implemented yet :c\\u003c/p\\u003e\",\"post_number\":4,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-22T01:56:24.345Z\",\"reply_count\":1,\"reply_to_post_number\":2,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":314,\"readers_count\":313,\"score\":82.8,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":65,\"username\":\"Joe_Ross\",\"name\":\"Joe Ross\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/joe_ross/{size}/37_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/4\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3011106,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-22T03:10:01.490Z\",\"cooked\":\"\\u003cp\\u003eAny chance rev moved the other trello card they had for automatic zero on endstop rise?\\u003c/p\\u003e\\n\\u003cp\\u003eEdit: found it, \\u003ca href=\\\"https://trello.com/c/85rXA2ow/78-re-zero-encoder-on-limit-switch\\\" class=\\\"inline-onebox\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eTrello\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003ereally wish these were ready! the 112ms delay is causing issues when zeroing for us rn\\u003c/p\\u003e\",\"post_number\":5,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-22T03:11:29.233Z\",\"reply_count\":1,\"reply_to_post_number\":3,\"quote_count\":0,\"incoming_link_count\":5,\"reads\":286,\"readers_count\":285,\"score\":87.2,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://trello.com/c/85rXA2ow/78-re-zero-encoder-on-limit-switch\",\"internal\":false,\"reflection\":false,\"title\":\"Trello\",\"clicks\":26}],\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":29846,\"username\":\"Ryan_Blue\",\"name\":\"Ryan Blue\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/ryan_blue/{size}/174016_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/5\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3011117,\"name\":\"Will Toth\",\"username\":\"Will_Toth\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/will_toth/{size}/111117_2.png\",\"created_at\":\"2022-02-22T03:21:12.807Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"kenwoodfox\\\" data-post=\\\"5\\\" data-topic=\\\"403608\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/kenwoodfox/48/127503_2.png\\\" class=\\\"avatar\\\"\\u003e kenwoodfox:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003ethe 112ms delay is causing issues when zeroing for us rn\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eNot sure what you mean by this? Calling \\u003ccode\\u003eencoder.setPosition()\\u003c/code\\u003e is very fast.\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"kenwoodfox\\\" data-post=\\\"4\\\" data-topic=\\\"403608\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/kenwoodfox/48/127503_2.png\\\" class=\\\"avatar\\\"\\u003e kenwoodfox:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eeven features they move to done are not implemented yet :c\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eWhich ones?\\u003c/p\\u003e\",\"post_number\":6,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-22T03:21:12.807Z\",\"reply_count\":1,\"reply_to_post_number\":5,\"quote_count\":2,\"incoming_link_count\":4,\"reads\":272,\"readers_count\":271,\"score\":79.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"Will Toth\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":6349,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"FRC 3005 Mentor\"},\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/6\",\"custom_user_title\":\"FRC 3005 Mentor\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3011163,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-22T04:44:46.557Z\",\"cooked\":\"\\u003cp\\u003eOh sorry, suppose its something else than, too many tabs open, the delay is only for velocity control not sensors. \\u003ca href=\\\"https://www.chiefdelphi.com/t/thoughts-on-neos-and-spark-max/400769/65\\\" class=\\\"inline-onebox\\\"\\u003eThoughts on NEOs and Spark Max - #65 by dyanoshak\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eAs for other features, the zero-on-lock was moved to done but iirc it got moved back to feature and a few other things were moved around a lot especially method renames\\u003c/p\\u003e\",\"post_number\":7,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-22T04:44:46.557Z\",\"reply_count\":0,\"reply_to_post_number\":6,\"quote_count\":0,\"incoming_link_count\":7,\"reads\":247,\"readers_count\":246,\"score\":84.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://www.chiefdelphi.com/t/thoughts-on-neos-and-spark-max/400769/65\",\"internal\":true,\"reflection\":false,\"title\":\"Thoughts on NEOs and Spark Max\",\"clicks\":7}],\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":6349,\"username\":\"Will_Toth\",\"name\":\"Will Toth\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/will_toth/{size}/111117_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/7\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3011173,\"name\":\"JohnGilb\",\"username\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\",\"created_at\":\"2022-02-22T06:04:28.936Z\",\"cooked\":\"\\u003cp\\u003eYou’re right that something is going to have to mediate between the two systems. I’m going to use a circle with angles between -180 and 180 as an example, since I’m not sure what your units are in.\\u003c/p\\u003e\\n\\u003cp\\u003eOne way to do this would to have a target angle and figure out how to map it to a sensible instruction for the Spark. For now, let’s say that target angle is 45 degrees. Once you have your target, you query your Spark for it’s current angle - since it’s counting continuously, perhaps it says it is at 400 degrees, since it has already rotated more than once counter-clockwise beforehand.\\u003c/p\\u003e\\n\\u003cp\\u003eWe anchor ourselves at 400, and say that from that position the only sensible instructions are between 220 and 580 degrees (400-180 and 400+180 degrees respectively). Next, we translate our target angle into this range, via something like the following code:\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003eif (value \\u0026lt; lowerBound) {\\n    value = upperBound\\n            + ((value - lowerBound) % (upperBound - lowerBound));\\n} else if (value \\u0026gt; upperBound) {\\n    value = lowerBound\\n            + ((value - upperBound) % (upperBound - lowerBound));\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003ethis maps our 45 degree target to 405 degrees. We can now call setReference on the Spark with a target of 405 and expect the onboard PID to behave sensibly.\\u003c/p\\u003e\\n\\u003cp\\u003eHowever, there is still one significant source of error here - the ratio between motor rotations and  rotations of your swerve module. Unless that ratio is relatively accurate, you are going to build up error continuously if your modules keep turning in one direction. Potential solutions:\\u003c/p\\u003e\\n\\u003cul\\u003e\\n\\u003cli\\u003eUse an external encoder mounted directly to the steering shaft of the swerve module, such as a CANCoder.\\u003c/li\\u003e\\n\\u003cli\\u003eTake accurate measurements of the ratio between motor rotations and swerve module rotations. Zero everything out, then rotate the module 20 or 50 times in one direction, then measure how many motor rotations that maps to.\\u003c/li\\u003e\\n\\u003cli\\u003eWrite some software to periodically “un-twist” your modules so that they prefer to stay relatively close to the zero point and away from large \\u003cspan class=\\\"hashtag\\\"\\u003e#s\\u003c/span\\u003e of rotations in a single direction.\\u003c/li\\u003e\\n\\u003c/ul\\u003e\",\"post_number\":8,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-22T06:16:37.048Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":12,\"reads\":229,\"readers_count\":228,\"score\":140.8,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"JohnGilb\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":2}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16203,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/8\",\"custom_user_title\":null,\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2}],\"current_user_reaction\":null,\"reaction_users_count\":2,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3013019,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-25T22:53:09.114Z\",\"cooked\":\"\\u003cp\\u003eOur current solution has been to just handle the delta angle on our own with a method, this way we can append the delta angle witch wpilib handles correctly to the continous count on the motor controller. I think we have similar ideas.\\u003c/p\\u003e\\n\\u003cp\\u003eIm not a fan of how messy our solution looks but it goes something like this:\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003esetNewValue(newRotation)\\n\\ndelta = old_rotation - newRotation\\n\\nsum = sum + delta\\n\\nmotor.setref(sum)\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eThis way we can go from -3rad to 3 rad, append only -0.2 or so to the sum, and we dont care if the sum value goes over 6, it just rotates around and around.\\u003c/p\\u003e\\n\\u003cp\\u003eOne of the issues this causes though is if the motor lags too far behind, the error can be over 2pi witch makes the motor spin several times to catch up in this case, this is incorrect so we’ve also implemented a clamp check to make sure the error can never be more than 2pi, if it is, it just subtracts or adds 2pi to the current sum to similate a catchup, again messy but it works.\\u003c/p\\u003e\",\"post_number\":9,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-25T22:53:09.114Z\",\"reply_count\":1,\"reply_to_post_number\":8,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":166,\"readers_count\":165,\"score\":53.2,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":16203,\"username\":\"JohnGilb\",\"name\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/9\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3013021,\"name\":\"JohnGilb\",\"username\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\",\"created_at\":\"2022-02-25T23:00:57.911Z\",\"cooked\":\"\\u003cp\\u003eYour last\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"kenwoodfox\\\" data-post=\\\"9\\\" data-topic=\\\"403608\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/kenwoodfox/48/127503_2.png\\\" class=\\\"avatar\\\"\\u003e kenwoodfox:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eOne of the issues this causes though is if the motor lags too far behind, the error can be over 2pi witch makes the motor spin several times to catch up in this case, this is incorrect so we’ve also implemented a clamp check to make sure the error can never be more than 2pi, if it is, it just subtracts or adds 2pi to the current sum to similate a catchup, again messy but it works.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eSomething about this is suspicious. A swerve module should never be commanded to move more than 90 degrees (~1.5 radians) from its current angle, so you shouldn’t have errors of 2pi+.\\u003c/p\\u003e\\n\\u003cp\\u003eIf you were going to move a swerve module 135 degrees, you should instead move it 45 degrees the other way and reverse the drive direction. \\u003ca href=\\\"https://docs.wpilib.org/en/stable/docs/software/kinematics-and-odometry/swerve-drive-kinematics.html#module-angle-optimization\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eWPI’s swerve drive kinematics has an optimize method that should ensure this\\u003c/a\\u003e.\\u003c/p\\u003e\",\"post_number\":10,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-25T23:00:57.911Z\",\"reply_count\":1,\"reply_to_post_number\":9,\"quote_count\":1,\"incoming_link_count\":3,\"reads\":146,\"readers_count\":145,\"score\":49.2,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"JohnGilb\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://docs.wpilib.org/en/stable/docs/software/kinematics-and-odometry/swerve-drive-kinematics.html#module-angle-optimization\",\"internal\":false,\"reflection\":false,\"title\":\"Swerve Drive Kinematics — FIRST Robotics Competition documentation\",\"clicks\":5}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16203,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/10\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3013025,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-25T23:32:36.659Z\",\"cooked\":\"\\u003cp\\u003eThats exactly true but that’s higher level than the interfacing we’re talking about here. We do optimize our inputs BUT if the module lags behind, say, because the robot is turned off or low battery or some other reason. Because we have to include the summing math, the motor controller can acrew more small error buildups that never exceed 90 degrees on their own yet the motor can become more than 180 degrees behind the target.\\u003c/p\\u003e\\n\\u003cp\\u003eIf we could nativly set the target reference without need for our own suming math, this would not be an issue. Its not wpilib thats at fault it is the summing we need to do on our end.\\u003c/p\\u003e\\n\\u003cp\\u003eHope im explaining ok, in short, because the motor controller dosent see rotations as looping around, its all one long linear system, where 0, 2pi and 4pi are all 2pi away from each other, where in reality we know that they are 0 away, if the operator swings the controller around too fast for the wheels to keep up, they can snap a full 360 degree rotation and the motor will take the long route around because its using a linear targeting model.\\u003c/p\\u003e\\n\\u003cp\\u003eThis goes away if we remove the summing math, but then we have the problem of the robot swinging from -pi to pi every time the wheel approaches being pointed directly backward.\\u003c/p\\u003e\",\"post_number\":11,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-25T23:32:36.659Z\",\"reply_count\":1,\"reply_to_post_number\":10,\"quote_count\":0,\"incoming_link_count\":6,\"reads\":132,\"readers_count\":131,\"score\":61.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":16203,\"username\":\"JohnGilb\",\"name\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/11\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3013026,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-25T23:33:21.226Z\",\"cooked\":\"\\u003cp\\u003eIts, just a lot of mess, sorry for the way that was worded it came off a little defensive, id like to make some cleaner code and this works well right now but, i feel like interpolation between rotational targets should be a thing on the motor controller’s side.\\u003c/p\\u003e\",\"post_number\":12,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-25T23:33:21.226Z\",\"reply_count\":1,\"reply_to_post_number\":11,\"quote_count\":0,\"incoming_link_count\":4,\"reads\":118,\"readers_count\":117,\"score\":48.6,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":41201,\"username\":\"kenwoodfox\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/12\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3013151,\"name\":\"JohnGilb\",\"username\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\",\"created_at\":\"2022-02-26T05:26:38.997Z\",\"cooked\":\"\\u003cp\\u003eNo offense taken - I only have the tiniest window into your problem and your code, so it’s very likely that the solutions I’m offering aren’t particularly helpful.\\u003c/p\\u003e\\n\\u003cp\\u003eThat being said, I think if you using something like the below code you may be able to avoid the problem of accumulating error over time. This code doesn’t persist any state - each time through it gets the current angle of the wheel and finds the “best” angle to move to for a given target angle.\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003e/**\\n * \\n * @param targetAngleInDegrees target angle from WPI's swerve kinematics optimize method\\n */\\npublic void setSparkAngle(double targetAngleInDegrees) {\\n    // Get the current angle of the motor by reading the current rotation count and multiplying it by \\n    // an experimentally derived ratio\\n    double currentSparkAngle = spark.getEncoder().getPosition() * degreesPerMotorRotation;\\n    // Slide the target angle until it is close to the current angle\\n    double sparkRelativeTargetAngle = reboundValue(targetAngleInDegrees, currentSparkAngle);\\n    // Ask the spark to turn to the new angle. Also, convert from degrees into native motor units (rotations). \\n    spark.getPIDController().setReference(sparkRelativeTargetAngle / degreesPerMotorRotation, ControlType.kPosition);\\n}\\n\\nprivate double reboundValue(double value, double anchor) {\\n    double lowerBound = anchor - 180;\\n    double upperBound = anchor + 180;\\n    \\n    if (value \\u0026lt; lowerBound) {\\n        value = upperBound\\n                + ((value - lowerBound) % (upperBound - lowerBound));\\n    } else if (value \\u0026gt; upperBound) {\\n        value = lowerBound\\n                + ((value - upperBound) % (upperBound - lowerBound));\\n    }\\n\\n    return value;\\n}\\u003c/code\\u003e\\u003c/pre\\u003e\",\"post_number\":13,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-26T05:26:38.997Z\",\"reply_count\":1,\"reply_to_post_number\":12,\"quote_count\":0,\"incoming_link_count\":7,\"reads\":122,\"readers_count\":121,\"score\":64.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"JohnGilb\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":41201,\"username\":\"kenwoodfox\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16203,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/13\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3013433,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-02-26T20:10:56.098Z\",\"cooked\":\"\\u003cp\\u003eYes this is essentially exactly what we have right now. Except we called it a clamp and not a rebound value. Also we use position scaling.\\u003cbr\\u003e\\nAnd you still have the issue where you will have a snap-around? Im not sure exactly, but because you are not summing delta over time, SparkRelativeTargetAngle is bound between -180 and 180 witch means it will snap around when the wheel aproaches that limit?\\u003c/p\\u003e\",\"post_number\":14,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-02-26T20:10:56.098Z\",\"reply_count\":1,\"reply_to_post_number\":13,\"quote_count\":0,\"incoming_link_count\":7,\"reads\":102,\"readers_count\":101,\"score\":60.4,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":16203,\"username\":\"JohnGilb\",\"name\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/14\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3015007,\"name\":\"JohnGilb\",\"username\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\",\"created_at\":\"2022-03-01T17:17:30.788Z\",\"cooked\":\"\\u003cp\\u003eI believe you are missing something in the above code. There will never be snap around, because SparkRelativeTargetAngle is not bound between [-180, 180]. It’s bound between (currentSparkAngle-180, currentSparkAngle+180].\\u003c/p\\u003e\\n\\u003cp\\u003eIf the spark is currently reporting that it is at 360 degrees and you give it a command to move to 45 degrees, the above code will transform from 45 degrees (targetAngleInDegrees) to 405 degrees (sparkRelativeTargetAngle), because 405 is the best representation of 45 degrees in the  [180, 540] (aka [360-180, 360+180]),  degree space.\\u003c/p\\u003e\",\"post_number\":15,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-03-01T17:17:30.788Z\",\"reply_count\":1,\"reply_to_post_number\":14,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":96,\"readers_count\":95,\"score\":29.2,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"JohnGilb\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":41201,\"username\":\"kenwoodfox\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16203,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/15\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3015026,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-03-01T17:45:08.625Z\",\"cooked\":\"\\u003cp\\u003eI think I’m begining to see what you’re saying, but you’re appending a rotation (say, 45) to what your spark max reports, we tried this actually but our loop runs pretty quick and very rapidly you loose rotations if you trust the encoder like this, one loop may request 20+ plus to get to a ‘global’ angle of 20 degrees, and the next might want to go to 90 but the motor has only moved 2 degrees and the new target angle is 72. I think i might be missing where you account for this but the code is very familer, we ran that at week zero and the wheels got out of alignment pretty quick. Now we use the reported value for piping to an optimize function, but keep track of a global summation of angles so the target is always imagable to a (-180, 180) space.\\u003c/p\\u003e\\n\\u003cp\\u003eSorry for being slow, apart from that i’d like to spend more time with your custom reboundValue \\u003cimg src=\\\"https://www.chiefdelphi.com/images/emoji/google/slight_smile.png?v=9\\\" title=\\\":slight_smile:\\\" class=\\\"emoji\\\" alt=\\\":slight_smile:\\\"\\u003e i think this might help~ ill see if i can produce some tests and ill let you know if i’ve got a better understanding, thanks so much for your input.\\u003c/p\\u003e\\n\\u003cp\\u003eWould sure be nice if we could just set a target angle and let the spark max interpolate~\\u003c/p\\u003e\",\"post_number\":16,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-03-01T17:45:08.625Z\",\"reply_count\":1,\"reply_to_post_number\":15,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":89,\"readers_count\":88,\"score\":37.8,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":16203,\"username\":\"JohnGilb\",\"name\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/16\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3015048,\"name\":\"JohnGilb\",\"username\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\",\"created_at\":\"2022-03-01T18:19:41.160Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"kenwoodfox\\\" data-post=\\\"16\\\" data-topic=\\\"403608\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/kenwoodfox/48/127503_2.png\\\" class=\\\"avatar\\\"\\u003e kenwoodfox:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eI think I’m begining to see what you’re saying, but you’re appending a rotation (say, 45) to what your spark max reports, we tried this actually but our loop runs pretty quick and very rapidly you loose rotations if you trust the encoder like this, one loop may request 20+ plus to get to a ‘global’ angle of 20 degrees, and the next might want to go to 90 but the motor has only moved 2 degrees and the new target angle is 72\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eThe latter half of your statement is a little hard to parse, but for the first part - the above code does not append rotations to what the spark max reports. Instead, it is scaling an absolute target angle (e.g. you want your module pointed at 45 degrees) into a value close to where the spark max currently is.\\u003c/p\\u003e\\n\\u003cp\\u003eTo further clarify - this function isn’t used to apply a delta to the existing angle. It doesn’t take the current position of the module and rotate it by X degrees. If you want the module pointed at 45 degrees (e.g. targetAngleInDegrees is 45) and the spark max is currently reporting that it is at 405 degrees (currentSparkAngle returns 405), then nothing will happen (because sparkRelativeTargetAngle will also be 405 degrees).\\u003c/p\\u003e\",\"post_number\":17,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-03-01T18:19:41.160Z\",\"reply_count\":1,\"reply_to_post_number\":16,\"quote_count\":1,\"incoming_link_count\":3,\"reads\":89,\"readers_count\":88,\"score\":37.8,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"JohnGilb\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16203,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/17\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3015252,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-03-01T23:39:33.991Z\",\"cooked\":\"\\u003cp\\u003eI see now, sorry about being a bit confusing, its hectic here and I’m going through lots and lots of code. This is easier to digest with your explanation, thanks so much~ I like this implementation a lot more.\\u003c/p\\u003e\\n\\u003cp\\u003eI’m yet to test it out yet, but thank you for all your help, ill reply back when i iron this out a little and test it on the bot, but i’ve integrated it in place of our previous code, and im excited to see if it works, again thanks so much, this implementation is a lot cleaner, ill link a video when its on the bot!\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003e...\\n    def setDesiredState(self, newState):\\n            \\\"\\\"\\\"\\n            Updates the current desired state,\\n            where we want this module to now point.\\n            \\\"\\\"\\\"\\n            # Optimize the input command to reduce unneeded motion.\\n            optimizedState = kinematics.SwerveModuleState.optimize(\\n                newState, self.getCurrentState().angle\\n            )\\n\\n            # newTargetAngle is an angle in radians.\\n            newTargetAngle = self.reboundValue(\\n                optimizedState.angle.radians(),\\n                self.getCurrentState().angle.radians(),\\n            )\\n\\n            # newTargetRef is a number of rotations.\\n            newTargetRef = newTargetAngle / (2 * math.pi)\\n\\n            # Send newTargetRef to the motor controller.\\n            self.steer_PID.setReference(\\n                newTargetRef,\\n                CANSparkMaxLowLevel.ControlType.kPosition,\\n            )\\n\\n            self.desiredState = newState\\n...\\n    def reboundValue(self, target, datum) -\\u0026gt; float:\\n            \\\"\\\"\\\"\\n            https://www.chiefdelphi.com/t/wrap-around-with-rev-spark-maxes/403608/17\\n            Made with help from JohnGilb on Chief Delphi\\n            \\\"\\\"\\\"\\n\\n            lowerDatum = datum - math.pi  # 180 behind\\n            upperDatum = datum + math.pi  # 180 ahead\\n\\n            if target \\u0026lt; lowerDatum:\\n                target = upperDatum + ((target - lowerDatum) % (upperDatum - lowerDatum))\\n            elif target \\u0026gt; upperDatum:\\n                target = lowerDatum + ((target - upperDatum) % (upperDatum - lowerDatum))\\n\\n            return target\\u003c/code\\u003e\\u003c/pre\\u003e\",\"post_number\":18,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-03-01T23:39:33.991Z\",\"reply_count\":1,\"reply_to_post_number\":17,\"quote_count\":0,\"incoming_link_count\":7,\"reads\":84,\"readers_count\":83,\"score\":56.8,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":16203,\"username\":\"JohnGilb\",\"name\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/18\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3016511,\"name\":\"\",\"username\":\"kenwoodfox\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"created_at\":\"2022-03-03T23:06:45.235Z\",\"cooked\":\"\\u003cp\\u003e\\u003ca class=\\\"mention\\\" href=\\\"/u/johngilb\\\"\\u003e@JohnGilb\\u003c/a\\u003e Gave it a test just now and it seemed to cause an awful lot of spinning round and round, we’re on our way to our first comp! so wish us luck, ill try and integrate your algorithm in the pits.\\u003c/p\\u003e\",\"post_number\":19,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-03-03T23:07:04.856Z\",\"reply_count\":1,\"reply_to_post_number\":18,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":68,\"readers_count\":67,\"score\":23.6,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":41201,\"username\":\"kenwoodfox\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":41201,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/19\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3016522,\"name\":\"JohnGilb\",\"username\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\",\"created_at\":\"2022-03-03T23:40:26.655Z\",\"cooked\":\"\\u003cp\\u003eBest of luck to you and your team in competition!\\u003c/p\\u003e\",\"post_number\":20,\"post_type\":1,\"posts_count\":21,\"updated_at\":\"2022-03-03T23:40:26.655Z\",\"reply_count\":0,\"reply_to_post_number\":19,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":64,\"readers_count\":63,\"score\":32.8,\"yours\":false,\"topic_id\":403608,\"topic_slug\":\"wrap-around-with-rev-spark-maxes\",\"display_username\":\"JohnGilb\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":41201,\"username\":\"kenwoodfox\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16203,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/wrap-around-with-rev-spark-maxes/403608/20\",\"custom_user_title\":null,\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null}],\"stream\":[3011036,3011048,3011051,3011078,3011106,3011117,3011163,3011173,3013019,3013021,3013025,3013026,3013151,3013433,3015007,3015026,3015048,3015252,3016511,3016522,3156771]},\"timeline_lookup\":[[1,1328],[9,1324],[14,1323],[15,1320],[19,1318],[21,953]],\"tags\":[\"rev\"],\"tags_descriptions\":{},\"fancy_title\":\"Wrap-around with rev spark maxes\",\"id\":403608,\"title\":\"Wrap-around with rev spark maxes\",\"posts_count\":21,\"created_at\":\"2022-02-21T23:45:48.960Z\",\"views\":2635,\"reply_count\":17,\"like_count\":5,\"last_posted_at\":\"2023-03-03T23:40:46.847Z\",\"visible\":true,\"closed\":true,\"archived\":false,\"has_summary\":false,\"archetype\":\"regular\",\"slug\":\"wrap-around-with-rev-spark-maxes\",\"category_id\":31,\"word_count\":2534,\"deleted_at\":null,\"user_id\":41201,\"featured_link\":null,\"pinned_globally\":false,\"pinned_at\":null,\"pinned_until\":null,\"image_url\":null,\"slow_mode_seconds\":0,\"draft\":null,\"draft_key\":\"topic_403608\",\"draft_sequence\":null,\"unpinned\":null,\"pinned\":false,\"current_post_number\":1,\"highest_post_number\":21,\"deleted_by\":null,\"actions_summary\":[{\"id\":4,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":8,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":10,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":7,\"count\":0,\"hidden\":false,\"can_act\":false}],\"chunk_size\":20,\"bookmarked\":false,\"topic_timer\":null,\"message_bus_last_id\":0,\"participant_count\":5,\"show_read_indicator\":false,\"thumbnails\":null,\"slow_mode_enabled_until\":null,\"valid_reactions\":[\"heart\",\"laughing\",\"point_up\",\"+1\",\"-1\",\"100\",\"open_mouth\",\"cry\",\"question\",\"thinking\",\"call_me_hand\",\"hugs\",\"angry\"],\"user_chosen_thumbnail_url\":null,\"sidecar_installed\":true,\"can_vote\":false,\"vote_count\":0,\"user_voted\":false,\"discourse_zendesk_plugin_zendesk_id\":null,\"discourse_zendesk_plugin_zendesk_url\":\"https://your-url.zendesk.com/agent/tickets/\",\"details\":{\"can_edit\":false,\"notification_level\":1,\"participants\":[{\"id\":41201,\"username\":\"kenwoodfox\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\",\"post_count\":11,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":1},{\"id\":16203,\"username\":\"JohnGilb\",\"name\":\"JohnGilb\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/6bbea6/{size}.png\",\"post_count\":6,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":65,\"username\":\"Joe_Ross\",\"name\":\"Joe Ross\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/joe_ross/{size}/37_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"moderator\":true,\"trust_level\":4},{\"id\":6349,\"username\":\"Will_Toth\",\"name\":\"Will Toth\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/will_toth/{size}/111117_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":29846,\"username\":\"Ryan_Blue\",\"name\":\"Ryan Blue\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/ryan_blue/{size}/174016_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2}],\"created_by\":{\"id\":41201,\"username\":\"kenwoodfox\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/kenwoodfox/{size}/127503_2.png\"},\"last_poster\":{\"id\":-1,\"username\":\"system\",\"name\":\"system\",\"avatar_template\":\"/uploads/default/original/4X/9/3/2/93234578e69f55873c63fc00fe2d0d85f23bce55.png\"},\"links\":[{\"url\":\"https://trello.com/c/85rXA2ow/78-re-zero-encoder-on-limit-switch\",\"title\":\"Trello\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":26,\"user_id\":41201,\"domain\":\"trello.com\",\"root_domain\":\"trello.com\"},{\"url\":\"https://www.chiefdelphi.com/t/thoughts-on-neos-and-spark-max/400769/65\",\"title\":\"Thoughts on NEOs and Spark Max\",\"internal\":true,\"attachment\":false,\"reflection\":false,\"clicks\":7,\"user_id\":41201,\"domain\":\"www.chiefdelphi.com\",\"root_domain\":\"chiefdelphi.com\"},{\"url\":\"https://docs.wpilib.org/en/stable/docs/software/kinematics-and-odometry/swerve-drive-kinematics.html#module-angle-optimization\",\"title\":\"Swerve Drive Kinematics — FIRST Robotics Competition documentation\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":5,\"user_id\":16203,\"domain\":\"docs.wpilib.org\",\"root_domain\":\"wpilib.org\"}]},\"bookmarks\":[]}"}
