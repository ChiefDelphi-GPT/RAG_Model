{"data":"{\"post_stream\":{\"posts\":[{\"id\":3068285,\"name\":\"Noah Bistline\",\"username\":\"Radiator72\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/radiator72/{size}/112761_2.png\",\"created_at\":\"2022-06-08T20:26:29.194Z\",\"cooked\":\"\\u003cp\\u003eAll -\\u003c/p\\u003e\\n\\u003cp\\u003eI understand there are better places to ask questions referring to Arduinos than CD, although I have had good experiences in the past on CD, and also lack accounts to other popular technical forums.\\u003c/p\\u003e\\n\\u003cp\\u003eI am using a sensor to track data, and I am trying to be precise as possible. Because I don’t want to miss any data points, I am using the delay() for half a millisecond (.5). I would prefer to do anything less than one millisecond delay, and am hesitant to consider increasing it over that threshold for various reasons. Regardless:\\u003c/p\\u003e\\n\\u003cp\\u003eI am trying to use the micros() function to keep track of when I am reading these points. However, regardless of whether I uses micros() or millis(), it caps out on each side: ~27000, and ~-32000. It’s supposed to track up to I believe 70 days. I’m pretty inexperienced with Arduinos, and would appreciate any help I could get as to why the micros() function is capping out. I use an Arduino Mega 2560, power and serial comms over USB into my computer. I have tried manipulating the baud from 9600 to 500000. Nothing is working. I graphed the “time” over samples, and expected it to be a near linear, ever-increasing function. Clearly, that is not the case. It is for work, and somewhat sensitive, so I can reveal too many background details such as what I am actually sensing. I understand this hinders everyone’s ability to help. For pure testing purposes though, I created a sketch solely dedicated to tracking time. Thanks for reading.\\u003c/p\\u003e\\n\\u003cp\\u003eBest,\\u003cbr\\u003e\\nNoah\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003eindent preformatted text by 4 spaces\\nvoid setup() {\\n  // put your setup code here, to run once:\\n\\nint start = 0;\\nSerial.begin(9600);\\nSerial.println(start);\\n}\\n\\nint t = 0;\\n\\nvoid loop() {\\n\\nt = micros();\\nSerial.println(t);\\n\\ndelay(.5);\\n }\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003e\\u003cdiv class=\\\"lightbox-wrapper\\\"\\u003e\\u003ca class=\\\"lightbox\\\" href=\\\"https://www.chiefdelphi.com/uploads/default/original/3X/a/9/a99f52371bd4899350b08174ed626eaf9220e241.png\\\" data-download-href=\\\"https://www.chiefdelphi.com/uploads/default/a99f52371bd4899350b08174ed626eaf9220e241\\\" title=\\\"Error\\\"\\u003e\\u003cimg src=\\\"https://www.chiefdelphi.com/uploads/default/original/3X/a/9/a99f52371bd4899350b08174ed626eaf9220e241.png\\\" alt=\\\"Error\\\" data-base62-sha1=\\\"ocy2gjDd5diCrsD8xyOTneAlpw5\\\" width=\\\"690\\\" height=\\\"162\\\" data-dominant-color=\\\"EDEDFD\\\"\\u003e\\u003cdiv class=\\\"meta\\\"\\u003e\\u003csvg class=\\\"fa d-icon d-icon-far-image svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#far-image\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003cspan class=\\\"filename\\\"\\u003eError\\u003c/span\\u003e\\u003cspan class=\\\"informations\\\"\\u003e1183×279 19.8 KB\\u003c/span\\u003e\\u003csvg class=\\\"fa d-icon d-icon-discourse-expand svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#discourse-expand\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003c/div\\u003e\\u003c/a\\u003e\\u003c/div\\u003e\\u003c/p\\u003e\",\"post_number\":1,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-08T20:26:29.194Z\",\"reply_count\":0,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":199,\"reads\":199,\"readers_count\":198,\"score\":1049.8,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Noah Bistline\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://www.chiefdelphi.com/uploads/default/original/3X/a/9/a99f52371bd4899350b08174ed626eaf9220e241.png\",\"internal\":true,\"reflection\":false,\"clicks\":0}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":38287,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"That's what she said.  \"},\"post_url\":\"/t/arduino-micros-question/412626/1\",\"custom_user_title\":\"That's what she said.  \",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true,\"can_vote\":false},{\"id\":3068288,\"name\":\"Owen Busler\",\"username\":\"Owen_Busler\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/owen_busler/{size}/7684_2.png\",\"created_at\":\"2022-06-08T20:32:13.395Z\",\"cooked\":\"\\u003cp\\u003eTake a look at the arduino reference for millis() : \\u003ca href=\\\"https://www.arduino.cc/reference/en/language/functions/time/micros/\\\" class=\\\"inline-onebox\\\"\\u003emicros() - Arduino Reference\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eIt returns an unsigned long which will still overflow after about 70 minutes.\\u003c/p\\u003e\\n\\u003cp\\u003eHere is the reference for unsigned long: \\u003ca href=\\\"https://www.arduino.cc/reference/en/language/variables/data-types/unsignedlong/\\\" class=\\\"inline-onebox\\\"\\u003eunsigned long - Arduino Reference\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eIf you want, you can add some logic which tracks rollovers when millis() goes from very big to very small to know how long its been.\\u003c/p\\u003e\\n\\u003cp\\u003eEdit: adding the fact that in your case, you are storing millis() in an int, which caps out at -32k to 32k. Arudino int reference: \\u003ca href=\\\"https://www.arduino.cc/reference/en/language/variables/data-types/int/\\\" class=\\\"inline-onebox\\\"\\u003eint - Arduino Reference\\u003c/a\\u003e\\u003c/p\\u003e\",\"post_number\":2,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-08T20:36:29.817Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":174,\"readers_count\":173,\"score\":99.8,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Owen Busler\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://www.arduino.cc/reference/en/language/functions/time/micros/\",\"internal\":false,\"reflection\":false,\"title\":\"micros() - Arduino Reference\",\"clicks\":9},{\"url\":\"https://www.arduino.cc/reference/en/language/variables/data-types/int/\",\"internal\":false,\"reflection\":false,\"title\":\"int - Arduino Reference\",\"clicks\":2},{\"url\":\"https://www.arduino.cc/reference/en/language/variables/data-types/unsignedlong/\",\"internal\":false,\"reflection\":false,\"title\":\"unsigned long - Arduino Reference\",\"clicks\":2}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":3}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":23320,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"\"},\"post_url\":\"/t/arduino-micros-question/412626/2\",\"custom_user_title\":null,\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":3}],\"current_user_reaction\":null,\"reaction_users_count\":3,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":true,\"topic_accepted_answer\":true},{\"id\":3068291,\"name\":\"Noah Bistline\",\"username\":\"Radiator72\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/radiator72/{size}/112761_2.png\",\"created_at\":\"2022-06-08T20:38:13.719Z\",\"cooked\":\"\\u003cp\\u003eThat did it. I forgot to use unsigned long t. I never referenced that second link. I appreciate the quick response. Thanks a million (no pun intended)\\u003c/p\\u003e\",\"post_number\":3,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-08T20:38:13.719Z\",\"reply_count\":0,\"reply_to_post_number\":2,\"quote_count\":0,\"incoming_link_count\":2,\"reads\":158,\"readers_count\":157,\"score\":71.6,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Noah Bistline\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":23320,\"username\":\"Owen_Busler\",\"name\":\"Owen Busler\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/owen_busler/{size}/7684_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":2}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":38287,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"That's what she said.  \"},\"post_url\":\"/t/arduino-micros-question/412626/3\",\"custom_user_title\":\"That's what she said.  \",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2}],\"current_user_reaction\":null,\"reaction_users_count\":2,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3068896,\"name\":\"Martin Pirringer\",\"username\":\"mpirringer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mpirringer/{size}/124489_2.png\",\"created_at\":\"2022-06-12T22:48:06.693Z\",\"cooked\":\"\\u003cp\\u003eI am no friend of delay() except in the most simple cases as its always inaccurate. Granted the delay() might get you a .5ms delay but how long does the code before and after take? Just one if statement can kill reading the data in accurate interrupts. Lets say the code inside the loop (which includes all functions you call from inside the loop takes between .1 to .3 ms then you read the data every .6 to .9 ms.\\u003c/p\\u003e\\n\\u003cp\\u003eInstead I would use a timer interrupt that fires every so many ms and make sure the timer interval is more than the worst case scenario of processing the data like storing it or displaying it (if you use a touchscreen forget .5ms in most cases) you migh be ok to store it or average it or send it over the serial. but be aware that even at 250k baud each character takes about 35-45 microsec (8 databit plus probably some start/stop bits and overhead) And storing data in ram is limited on an arduino. So if you send more than 12 char per measurement the commnication becomes a bottleneck meaning the next measurement happens before the first one completed\\u003c/p\\u003e\\n\\u003cp\\u003eNow in your interrupt Iwould keep it short\\u003cbr\\u003e\\nnewdata = true;\\u003cbr\\u003e\\n\\u003c/p\\u003e\\n\\u003cp\\u003eAnd in your loop\\u003cbr\\u003e\\nif (newdata) {\\u003cbr\\u003e\\nnewdata = false;\\u003cbr\\u003e\\n\\u0026lt;process data must take less than the timer interval of .5ms\\u0026gt;\\u003c/p\\u003e\\n\\u003cp\\u003eYou could go to something faster like an esp32 and a faster protocol to send data.  or something with significantly more memory like a PI\\u003c/p\\u003e\",\"post_number\":5,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-12T22:48:06.693Z\",\"reply_count\":0,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":2,\"reads\":125,\"readers_count\":124,\"score\":50.0,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Martin Pirringer\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":2}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":24690,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Mentor \"},\"post_url\":\"/t/arduino-micros-question/412626/5\",\"custom_user_title\":\"Mentor \",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1},{\"id\":\"point_up\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":2,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3068965,\"name\":\"Anand Rajamani\",\"username\":\"asid61\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/asid61/{size}/7179_2.png\",\"created_at\":\"2022-06-13T14:47:13.700Z\",\"cooked\":\"\\u003cp\\u003eBear in mind that micros () will take about 100us to trigger, so if you want to delay 400us you should actually put 300us. Newer Arduinos may not have this issue, so it’s worth measuring yourself.\\u003c/p\\u003e\",\"post_number\":6,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-13T14:47:26.599Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":91,\"readers_count\":90,\"score\":43.2,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Anand Rajamani\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":21715,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"\"},\"post_url\":\"/t/arduino-micros-question/412626/6\",\"custom_user_title\":null,\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3068975,\"name\":\"Noah Bistline\",\"username\":\"Radiator72\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/radiator72/{size}/112761_2.png\",\"created_at\":\"2022-06-13T17:13:03.296Z\",\"cooked\":\"\\u003cp\\u003eThought about testing every line except for the micros() line. Thanks for reminding me \\u003cimg src=\\\"https://www.chiefdelphi.com/images/emoji/google/slight_smile.png?v=9\\\" title=\\\":slight_smile:\\\" class=\\\"emoji\\\" alt=\\\":slight_smile:\\\"\\u003e !\\u003c/p\\u003e\",\"post_number\":7,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-13T17:13:03.296Z\",\"reply_count\":0,\"reply_to_post_number\":6,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":76,\"readers_count\":75,\"score\":20.2,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Noah Bistline\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":21715,\"username\":\"asid61\",\"name\":\"Anand Rajamani\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/asid61/{size}/7179_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":38287,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"That's what she said.  \"},\"post_url\":\"/t/arduino-micros-question/412626/7\",\"custom_user_title\":\"That's what she said.  \",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3068987,\"name\":\"Martin Pirringer\",\"username\":\"mpirringer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mpirringer/{size}/124489_2.png\",\"created_at\":\"2022-06-13T19:02:56.256Z\",\"cooked\":\"\\u003cp\\u003eTo measure the time you can toggle an IO line before and after the code and then connect your oscilloscope to that IO that should you a pretty accurate reading as to the time the code takes If you write directly to the port you can toggle it in a couple of clock cycles so \\u0026lt; 1microsec.\\u003c/p\\u003e\",\"post_number\":8,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-13T19:02:56.256Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":70,\"readers_count\":69,\"score\":39.0,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Martin Pirringer\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":2}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":24690,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Mentor \"},\"post_url\":\"/t/arduino-micros-question/412626/8\",\"custom_user_title\":\"Mentor \",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1},{\"id\":\"point_up\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":2,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3068999,\"name\":\"Anand Rajamani\",\"username\":\"asid61\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/asid61/{size}/7179_2.png\",\"created_at\":\"2022-06-13T20:57:23.727Z\",\"cooked\":\"\\u003cp\\u003eI’ve done it by doing back to back reads and taking the difference. Good point about using direct port writes. digitalRead on Arduino takes a long time to run, in the tens of microseconds range iirc.\\u003c/p\\u003e\",\"post_number\":9,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-13T20:57:23.727Z\",\"reply_count\":1,\"reply_to_post_number\":8,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":57,\"readers_count\":56,\"score\":36.4,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Anand Rajamani\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":24690,\"username\":\"mpirringer\",\"name\":\"Martin Pirringer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mpirringer/{size}/124489_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":21715,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"\"},\"post_url\":\"/t/arduino-micros-question/412626/9\",\"custom_user_title\":null,\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3069028,\"name\":\"Martin Pirringer\",\"username\":\"mpirringer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mpirringer/{size}/124489_2.png\",\"created_at\":\"2022-06-14T01:21:37.398Z\",\"cooked\":\"\\u003cp\\u003eHere are some examples from a project I am currently working on. Its a long way from finished But it got bit wise I/O etc and I am still writing/optimizing. Its from my motor controller project I am working on hooking 2 BTS7960 to 1 arduino nano and have that as a module that is controlled via I2C from another arduino - so you can control many motors from one arduino controller in effect 1 arduino (probably Mega) will take the role of what the roborio does on a robot and the controllers hopefully does what something like a talon srx does. Each motor will have limit switches and encoders etc and current control. So you will have commands like \\\"run at 50% but dont exceed xx amps or run at … until the count reaches … ) etc. If the Nano chokes I probably port it to an esp32 Anyway here is some code - enjoy\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cspan class=\\\"hashtag\\\"\\u003e#include\\u003c/span\\u003e \\u0026lt;Wire.h\\u0026gt;\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e BUFF_SIZE 40\\u003cbr\\u003e\\nchar pbuff[BUFF_SIZE];\\u003cbr\\u003e\\nboolean toggle = false; // is a divide by 2 to get the 1khz output signal\\u003cbr\\u003e\\n/*\\u003cbr\\u003e\\nSub class of BTS7960. Needs the following\\u003cbr\\u003e\\nPIN/Name on Module   Description\\u003cbr\\u003e\\n3 and 4 L_EN R_EN    Shorted together to PWM needs a PWM pin on the arduino\\u003cbr\\u003e\\n1 marked RPWM        FWD pin on the Arduino\\u003cbr\\u003e\\n2 marked LPWM        REV Pin on the Arduino\\u003c/p\\u003e\\n\\u003cp\\u003eTruth table logic\\u003cbr\\u003e\\nPWM    FWD   REV   Result\\u003cbr\\u003e\\nLR_EN  in1   in2\\u003c/p\\u003e\\n\\u003cp\\u003epwm      1     0   Fwd controled speed by pwm\\u003cbr\\u003e\\npwm      0     1   Rev \\\"\\u003cbr\\u003e\\n1        0     0   Break - motor leads shorted\\u003cbr\\u003e\\n0        x     x   Coast - all off\\u003c/p\\u003e\\n\\u003cp\\u003eIS1 and IS2 connect to an analog input pin and will read the current depending on which side is on\\u003cbr\\u003e\\nanalogwrite(0) will turn it off and analogwrite(255) will turn it on\\u003c/p\\u003e\\n\\u003cp\\u003eThis One is for UNO and Nano only\\u003c/p\\u003e\\n\\u003cp\\u003eWe limit it for now to 6 motors max on a Mega and 2 on UNO and Nano\\u003cbr\\u003e\\nfor each motor that is used the corresponding timer (1 or 2) is set to approx 4 KHz\\u003c/p\\u003e\\n\\u003cp\\u003eArduino UNO, Nano (Remember A4 and A5 are reserved for wire library - I2C)\\u003c/p\\u003e\\n\\u003cp\\u003eMotor PWM Pin  in1_fwd  in2_rev, IS    Enc Pins(Quadrature) LS suggestion\\u003c/p\\u003e\\n\\u003cp\\u003e0         9 T1   8       11    A0      7,6                 2,3\\u003cbr\\u003e\\n1        10 T1   12      13    A1      5,4                 A2,A3\\u003c/p\\u003e\\n\\u003cp\\u003eA4, A5 used for nano for now we leave the serial pins alone makes debugging and programming easier\\u003c/p\\u003e\\n\\u003cp\\u003eMEGA 2560\\u003c/p\\u003e\\n\\u003cp\\u003e*/\\u003cbr\\u003e\\n// DEFINE PINS AND PINREGISTERS We use pins and pinregisters for speed\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_PWM 9    // Note if you change those you need also change the PCINT\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_PWM 10\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_IN1 8\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_IN1 12\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_IN2 11\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_IN2 13\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_QE1 7\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_QE2 6\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_QE1 5\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_QE2 4\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_LS1 3\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_LS2 2\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_LS1 A2\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_LS2 A3\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M1_CS A0\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e P_M2_CS A1\\u003c/p\\u003e\\n\\u003cp\\u003e//flags\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_ERROR 0       // 0 no error 1 is error\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_ENABLE_LS1 1  // 1 =  use limit switches use limitswitch ls1 tied to in1 (fwd)\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_ENABLE_LS2 2  // 1 =  ls2 tied to in2(rev)\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_LS_OPEN 3     // Limit switch unactivated state either 0 or 1 depending on NO, NC and if tied to ground or VCC\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_LS1 4         // Current limit switch values\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_LS2 5\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_ENCODER 6     // Encoder is present or not\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_QUADRATURE 7  // Encoder if present is Quadrature (immaterial if F_ENCODER = 0\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_REVERSE 8     // Reverse the motor (0 - speed input) if 1 but leaves LS assignments alone\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_DIRECTION 9   // current direction reflection of in1(FWD) pin. Can be used to guess direction if not quadrature encoder\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_Brake 10      // Motor in Brake mode\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_COAST 11      // Motor in Coast mode (disabled)\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_ENABLE_CS 12  // Use Current control (limit to max current)\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e F_CS_NOW 13     // measure current sense now\\u003c/p\\u003e\\n\\u003cp\\u003e// state register settings = bit positions corresponding with input bits that cause an interrupt like encoder and ls\\u003c/p\\u003e\\n\\u003cp\\u003eclass BTS7960_D {\\u003cbr\\u003e\\npublic:\\u003cbr\\u003e\\nBTS7960_D(uint8_t motor);\\u003cbr\\u003e\\nvoid Start(); // needs to be run in setup before setting anything else - makes sure the timer1 is properly set\\u003cbr\\u003e\\nvoid Enable_CS();\\u003cbr\\u003e\\nvoid Disable_CS();\\u003cbr\\u003e\\nvoid GetLS();\\u003cbr\\u003e\\nvoid Set_ls(uint8_t ls1, uint8_t ls2, uint8_t open); // 0 = off, 1 = on, open shows if ls is inactive if you see a 0 or a 1\\u003cbr\\u003e\\nvoid Brake();\\u003cbr\\u003e\\nvoid Coast();\\u003cbr\\u003e\\nbool Drive(int16_t mspeed);\\u003cbr\\u003e\\nuint16_t getStatus(); //Returns flags\\u003cbr\\u003e\\nvoid Reverse(); //sets reverse flag\\u003cbr\\u003e\\nvoid Update(); // needs to be called periodically to check thingslike current, switches, encoders etc etc\\u003cbr\\u003e\\nvoid CheckCS(); //\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003e// Make those variables available public for faster access\\nvolatile uint16_t flags = 0; // 7 - enable, 6 - reverse, 5 - useLimits, 4 - usequadrature, 3 - useencoder, 2 - direction,  0 - error\\n//8 - LSforward, 9 - LSreverse, 10 - CS_measure, 11 CS_measure_now\\nvolatile int16_t curr_Speed; // -255 to +255 0 will coast\\nvolatile int16_t last_Speed; // -255 to +255 0 will coast\\nvolatile uint32_t last_cs_read = 0; //holds millis for last current measure for now we try everyt 10 ms\\nvolatile int16_t last_cs = 0 ; //Value of last current read\\nvolatile int32_t enc_pos = 0; // Encoder Position\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eprivate:\\u003cbr\\u003e\\nuint8_t _motor = 0;\\u003cbr\\u003e\\n// pins\\u003cbr\\u003e\\nuint8_t _pwm;    // pin for pw\\u003cbr\\u003e\\nuint8_t _in1;    // pin for L_EN which is connecte internally to in_1\\u003cbr\\u003e\\nuint8_t _in2;    // pinf for R_EN\\u003cbr\\u003e\\nint8_t _cs = -1;    // Current sense 1 pin must be analog pin\\u003cbr\\u003e\\nint8_t _ls1 = -1;    // Limit switch in the in1 direction\\u003cbr\\u003e\\nint8_t _ls2 = -1;    // Limit swithc in the in2 direction\\u003cbr\\u003e\\nint8_t _enc1 = -1;  //encoder input 1\\u003cbr\\u003e\\nint8_t _enc2 = -1;   //encoder input 2\\u003cbr\\u003e\\n};\\u003cbr\\u003e\\n/*\\u003cbr\\u003e\\nConstructor do basic rudimentary setup\\u003cbr\\u003e\\nfor now lets handle the pins hard coded and for now define it for UNO/Nano\\u003cbr\\u003e\\nF_Error for now to detect if we called with an invalid Motor.\\u003cbr\\u003e\\n\\u003cem\\u003e/\\u003cbr\\u003e\\nBTS7960_D::BTS7960_D(uint8_t motor) {\\u003cbr\\u003e\\nif (motor \\u0026lt; 1 || motor \\u0026gt; 2) {\\u003cbr\\u003e\\nbitWrite(flags, F_ERROR, 1);\\u003cbr\\u003e\\nreturn; // only allow motor 1 and 2 on uno/nano\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nbitWrite(flags, F_ERROR, 0);\\u003cbr\\u003e\\n_motor = motor;\\u003cbr\\u003e\\n_pwm = (motor == 1) ? P_M1_PWM : P_M2_PWM;\\u003cbr\\u003e\\n_in1 = (motor == 1) ? P_M1_IN1 : P_M2_IN1;\\u003cbr\\u003e\\n_in2 = (motor == 1) ? P_M1_IN2 : P_M2_IN2;\\u003cbr\\u003e\\npinMode(_pwm, OUTPUT);\\u003cbr\\u003e\\npinMode(_in1, OUTPUT);\\u003cbr\\u003e\\npinMode(_in2, OUTPUT);\\u003cbr\\u003e\\ndigitalWrite(_pwm, 0);\\u003cbr\\u003e\\ndigitalWrite(_in1, 0);  //  make sure everything is turned off\\u003cbr\\u003e\\ndigitalWrite(_in2, 0);\\u003cbr\\u003e\\n//Setup pin interrupt for now we only accept them on PCINT 1 pin 9, 10 in the future we can expand here\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nvoid BTS7960_D::Start() {\\u003cbr\\u003e\\ncli();\\u003cbr\\u003e\\n//WGM 10 and 12 set FASTPMW 8 Bit to get them both to rise simultaneously and\\u003cbr\\u003e\\n//CS 11 gives us with that an 8kHz cycle\\u003cbr\\u003e\\nTCCR1B = 0B00001010;  // sets CS11 and WGM12\\u003cbr\\u003e\\nTCCR1A = 0B00000001;  // Sets WGM10\\u003cbr\\u003e\\nPCICR |= 0b00000001; // Enables Ports B Pin Change Interrupts\\u003cbr\\u003e\\nPCMSK0 |= (_motor == 10) ? 0b00000010 : 0b00000100; // PCINT1 or 2 - pin 9 and 10\\u003cbr\\u003e\\nTIMSK1 != 0b00000110; // set mask for both\\u003cbr\\u003e\\nsei();\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n// read Limit switches and set position if the pin = -1 (disabled) switch is set to 0\\u003cbr\\u003e\\nvoid BTS7960_D::GetLS () {\\u003cbr\\u003e\\nif (_ls1 \\u0026gt;= 0) {\\u003cbr\\u003e\\nif (digitalRead(_ls1)) {\\u003cbr\\u003e\\nbitSet(flags, F_LS1);\\u003cbr\\u003e\\n} else {\\u003cbr\\u003e\\nbitClear(flags, F_LS1);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n} else {\\u003cbr\\u003e\\nbitClear(flags, F_LS1);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nif (_ls2 \\u0026gt;= 0) {\\u003cbr\\u003e\\nif (digitalRead(_ls2)) {\\u003cbr\\u003e\\nbitSet(flags, F_LS2);\\u003cbr\\u003e\\n} else {\\u003cbr\\u003e\\nbitClear(flags, F_LS2);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n} else {\\u003cbr\\u003e\\nbitClear(flags, F_LS2);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n// see if its time to read the CS note that it will read aprox. every 10 ms or longer depending on how busy the system is\\u003cbr\\u003e\\nvoid BTS7960_D::CheckCS() {\\u003cbr\\u003e\\nuint32_t m = millis();\\u003cbr\\u003e\\nif (m \\u0026lt; 10 || m - 10 \\u0026gt; last_cs_read) {\\u003cbr\\u003e\\nbitSet(flags, F_CS_NOW);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nvoid BTS7960_D::Update() {\\u003cbr\\u003e\\n//if we hit the limitswitch and the limitswitch is active then stop the motor\\u003cbr\\u003e\\n//  if (bitRead(flags, F_ENABLE_LS1) == 1) {\\u003cbr\\u003e\\n//    if (bitRead(flags, F_LS_OPEN) != digitalRead(_ls1)) {\\u003cbr\\u003e\\n//      this-\\u0026gt;Brake();\\u003cbr\\u003e\\n//    }\\u003cbr\\u003e\\n//  }\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n//reverse motor direction\\u003cbr\\u003e\\nvoid BTS7960_D::Reverse() {\\u003cbr\\u003e\\nbitWrite(flags, F_REVERSE, 1);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n/\\u003c/em\\u003e\\u003cbr\\u003e\\nUse currentcontrol\\u003cbr\\u003e\\n\\u003cem\\u003e/\\u003cbr\\u003e\\nvoid BTS7960_D::Enable_CS() {\\u003cbr\\u003e\\n_cs = (_motor == 1) ? P_M1_CS : P_M2_CS;\\u003cbr\\u003e\\nbitWrite(flags, F_ENABLE_CS, 1);\\u003cbr\\u003e\\nbitWrite(flags, F_CS_NOW, 1);\\u003cbr\\u003e\\nlast_cs = 0;\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n/\\u003c/em\\u003e\\u003cbr\\u003e\\nDisable Current Sense\\u003cbr\\u003e\\n*/\\u003cbr\\u003e\\nvoid BTS7960_D::Disable_CS() {\\u003cbr\\u003e\\nbitWrite(flags, F_ENABLE_CS, 0);\\u003cbr\\u003e\\nbitWrite(flags, F_CS_NOW, 0);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nvoid BTS7960_D::Set_ls(uint8_t ls1, uint8_t ls2, uint8_t open) {\\u003c/p\\u003e\\n\\u003cp\\u003e}\\u003cbr\\u003e\\n/*\\u003cbr\\u003e\\nget statusflags\\u003cbr\\u003e\\n\\u003cem\\u003e/\\u003cbr\\u003e\\nuint16_t BTS7960_D::getStatus() {\\u003cbr\\u003e\\nreturn flags;\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n/\\u003c/em\\u003e\\u003cbr\\u003e\\nPut motor in coast by disabling the unit\\u003cbr\\u003e\\n\\u003cem\\u003e/\\u003cbr\\u003e\\nvoid BTS7960_D::Coast() {\\u003cbr\\u003e\\nanalogWrite(_pwm, 0); // will set the pin to 0\\u003cbr\\u003e\\nlast_Speed = curr_Speed;\\u003cbr\\u003e\\ncurr_Speed = 0;\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n/\\u003c/em\\u003e\\u003cbr\\u003e\\nPut the motor in Brake by turning both lower ends on and the upper ones off\\u003cbr\\u003e\\n*/\\u003cbr\\u003e\\nvoid BTS7960_D::Brake() {\\u003cbr\\u003e\\nanalogWrite(_pwm, 255); // will set the pin to 1\\u003cbr\\u003e\\ndigitalWrite(_in1, 0);\\u003cbr\\u003e\\ndigitalWrite(_in2, 0);\\u003cbr\\u003e\\nlast_Speed = curr_Speed;\\u003cbr\\u003e\\ncurr_Speed = 0;\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n//Drive the motor positive = FWD negative = reverse\\u003cbr\\u003e\\nbool BTS7960_D::Drive(int16_t mspeed) {\\u003cbr\\u003e\\nif (bitRead(flags, F_REVERSE) != 0) {\\u003cbr\\u003e\\nmspeed = 0 - mspeed; // reverse it\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nif (mspeed == 0) {\\u003cbr\\u003e\\nanalogWrite(_pwm, mspeed); // leave flags alone\\u003cbr\\u003e\\n} else {\\u003cbr\\u003e\\nif (mspeed \\u0026gt; 0) // forward\\u003cbr\\u003e\\n{\\u003cbr\\u003e\\nif (bitRead(flags, F_DIRECTION) != 1) {\\u003cbr\\u003e\\nthis-\\u0026gt;Brake();\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nbitWrite(flags, F_DIRECTION, 1); //Set direction\\u003cbr\\u003e\\ndigitalWrite(_in1, 1);\\u003cbr\\u003e\\ndigitalWrite(_in2, 0);\\u003cbr\\u003e\\nmspeed = (mspeed \\u0026lt; 10) ? 10 : (mspeed \\u0026gt; 245) ? 245 : mspeed;\\u003cbr\\u003e\\nanalogWrite(_pwm, mspeed);\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nelse {\\u003cbr\\u003e\\nif (bitRead(flags, F_DIRECTION) != 0) {\\u003cbr\\u003e\\nthis-\\u0026gt;Brake();\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nbitWrite(flags, F_DIRECTION, 0);\\u003cbr\\u003e\\ndigitalWrite(_in1, 0);\\u003cbr\\u003e\\ndigitalWrite(_in2, 1);\\u003cbr\\u003e\\nmspeed = (mspeed \\u0026gt; -10) ? -10 : (mspeed \\u0026lt; -245) ? -245 : mspeed;\\u003cbr\\u003e\\nanalogWrite(_pwm, abs(mspeed));\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nlast_Speed = curr_Speed;\\u003cbr\\u003e\\ncurr_Speed = mspeed;\\u003cbr\\u003e\\nreturn true;\\u003cbr\\u003e\\n}\\u003c/p\\u003e\\n\\u003cp\\u003e// define motors\\u003cbr\\u003e\\nBTS7960_D motor1(1);\\u003cbr\\u003e\\nBTS7960_D motor2(2);\\u003c/p\\u003e\\n\\u003cp\\u003e/*\\u003cbr\\u003e\\nOn the wire there are always a set of  bytes transmiteed\\u003cbr\\u003e\\nbyte 1 = number of bytes in transmission after this  1-255\\u003cbr\\u003e\\nbyte 2 = Command 1-255 - needs at least 1 command byte 0 would be NOP can be used as a heartbeat and will require a 0 back\\u003cbr\\u003e\\nbyte 3-n parameters of command\\u003cbr\\u003e\\nReplies with either the required # of bytes or 0 = ok 1 = error\\u003cbr\\u003e\\nIf it receives a command 1 (error) then it will reset the communication and expect a command next sending multiple 1 is ok\\u003cbr\\u003e\\n*/\\u003cbr\\u003e\\n\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e WIRE_ID 1 // wire id of this device - change if you use multiple in a system\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cspan class=\\\"hashtag\\\"\\u003e#define\\u003c/span\\u003e WIRE_BUFF 4     // \\u003ca class=\\\"hashtag\\\" href=\\\"https://www.chiefdelphi.com/tag/of\\\"\\u003e#\\u003cspan\\u003eof\\u003c/span\\u003e\\u003c/a\\u003e bytes in data buffer\\u003cbr\\u003e\\nuint8_t wire_state = 0; // 0 = waiting for transmission 1 = count 2 cmd received 3 = parameters resets to 0 at end\\u003cbr\\u003e\\nuint8_t wire_wcnt = 0; // wait count of bytes still to be received currently limit to up to 4\\u003cbr\\u003e\\nuint8_t curr_cmd = 0;\\u003cbr\\u003e\\nuint8_t wbuff[WIRE_BUFF];\\u003c/p\\u003e\\n\\u003cp\\u003evoid clear_wbuff() {\\u003cbr\\u003e\\nfor (uint8_t i = 0; i \\u0026lt; WIRE_BUFF; i++) {\\u003cbr\\u003e\\nwbuff[i] = 0;\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\n}\\u003c/p\\u003e\\n\\u003cp\\u003evoid receiveEvent(int howMany)\\u003cbr\\u003e\\n{\\u003cbr\\u003e\\nwhile (0 \\u0026lt; Wire.available()) // loop through all but the last\\u003cbr\\u003e\\n{\\u003cbr\\u003e\\nuint8_t c = Wire.read(); // receive byte as a character\\u003cbr\\u003e\\nswitch (wire_state) {\\u003cbr\\u003e\\ncase 0: // byte is count\\u003cbr\\u003e\\nwire_wcnt = c;\\u003cbr\\u003e\\nwire_state++;\\u003cbr\\u003e\\nbreak;\\u003cbr\\u003e\\ncase 1 : // command\\u003cbr\\u003e\\nwire_state = (–wire_wcnt == 0) ? 0 : wire_state++;\\u003cbr\\u003e\\ncurr_cmd = c;\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003e    if (wire_wcnt \\u0026lt;= 0) // no data\\n    {\\n      wire_state = 0; //make sure all flags are set properly\\n      wire_wcnt = 0;\\n      uint8_t *p; //pointer\\n      switch (c) {\\n        case 0: // heartbeat\\n          Wire.write(0);\\n          break;\\n        case 1: // heartbeat\\n          Wire.write(0);\\n          break;\\n        case 2: // get amp M1\\n          p = (byte *)motor1.last_cs;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          break;\\n        case 3: // get amp M2\\n          p = (byte *)motor2.last_cs;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          break;\\n        case 4: // get speed M1\\n          p = (byte *)motor1.curr_Speed;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          break;\\n        case 5: // get speed M2\\n          p = (byte *)motor2.curr_Speed;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          break;\\n        case 6: // get enc M1\\n          p = (byte *)motor1.enc_pos;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          Wire.write(*(p + 2));\\n          Wire.write(*(p+3));\\n          break;\\n        case 7: // get enc M2\\n          p = (byte *)motor2.enc_pos;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          Wire.write(*(p + 2));\\n          Wire.write(*(p+3));\\n          break;\\n        case 8: // get flags / LS M1\\n          motor1.GetLS(); // read limit switches\\n          p = (byte *)motor1.flags;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          break;\\n        case 9: // get  flags / LS M2\\n          motor2.GetLS(); // read limit switches\\n          p = (byte *)motor2.flags;\\n          Wire.write(*p);\\n          Wire.write(*(p+1));\\n          break;\\n      }\\n\\n    }\\n  case 2: // data\\n    wire_state = (--wire_wcnt == 0) ? 0 : wire_state++;\\n    break;\\n  default:\\n    wire_wcnt--;\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003e}\\u003cbr\\u003e\\n}\\u003c/p\\u003e\\n\\u003cp\\u003evoid setup() {\\u003cbr\\u003e\\nmotor1.Start();\\u003cbr\\u003e\\nmotor2.Start();\\u003cbr\\u003e\\nWire.begin(WIRE_ID); // join i2c bus with address \\u003ca class=\\\"hashtag\\\" href=\\\"https://www.chiefdelphi.com/tag/4\\\"\\u003e#\\u003cspan\\u003e4\\u003c/span\\u003e\\u003c/a\\u003e\\u003cbr\\u003e\\nWire.onReceive(receiveEvent); // register event\\u003cbr\\u003e\\nuint32_t test = 0x11223344;\\u003cbr\\u003e\\nSerial.begin(115200);\\u003cbr\\u003e\\nuint8_t *p = (byte *)\\u0026amp;test;\\u003cbr\\u003e\\n//  uint8_t a = *p++ ;\\u003cbr\\u003e\\n//  uint8_t b = *p++;\\u003cbr\\u003e\\n//  uint8_t c = *p++;\\u003cbr\\u003e\\n//  uint8_t d = *p++;\\u003cbr\\u003e\\nsnprintf_P(pbuff, sizeof(pbuff), PSTR(“BTS79860 Test Boot up %i %i”), *p, *(p+1));\\u003cbr\\u003e\\nSerial.println(pbuff);\\u003cbr\\u003e\\nsnprintf_P(pbuff, sizeof(pbuff), PSTR(“TCCR1A %i TCCR1B %i H/L %i  %i”), TCCR1A, TCCR1B, *(p+2), *(p+3));\\u003cbr\\u003e\\nSerial.println(pbuff);\\u003cbr\\u003e\\nmotor1.Drive(64);\\u003cbr\\u003e\\nmotor2.Drive(145);\\u003cbr\\u003e\\n}\\u003c/p\\u003e\\n\\u003cp\\u003eISR(PCINT1_vect)\\u003cbr\\u003e\\n{\\u003c/p\\u003e\\n\\u003cp\\u003e}\\u003cbr\\u003e\\nISR(PCINT2_vect)\\u003cbr\\u003e\\n{\\u003c/p\\u003e\\n\\u003cp\\u003e}\\u003cbr\\u003e\\n// interrupt for PCINT0 pins 8-12  OPTIMIZE!!! if possible\\u003cbr\\u003e\\nISR(PCINT0_vect)\\u003cbr\\u003e\\n{\\u003cbr\\u003e\\nuint8_t sreg;\\u003cbr\\u003e\\nuint16_t tcnt; // tcnt = 16 bit for timer 1\\u003cbr\\u003e\\nuint8_t i ;\\u003cbr\\u003e\\n// if we dont do CS_NOW on either motor return right away - assumes both motors initialized\\u003cbr\\u003e\\nif ((motor1.flags | motor2.flags) \\u0026amp; 1 \\u0026lt;\\u0026lt; F_CS_NOW) {\\u003cbr\\u003e\\n/* Save global interrupt flag \\u003cem\\u003e/\\u003cbr\\u003e\\nsreg = SREG;\\u003cbr\\u003e\\n/\\u003c/em\\u003e Disable interrupts \\u003cem\\u003e/\\u003cbr\\u003e\\ncli();\\u003cbr\\u003e\\n/\\u003c/em\\u003e Read TCNT1 into tcnt \\u003cem\\u003e/\\u003cbr\\u003e\\ntcnt = TCNT1;\\u003cbr\\u003e\\n/\\u003c/em\\u003e Restore global interrupt flag */\\u003cbr\\u003e\\nSREG = sreg;\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode\\u003eif (bitRead(motor1.flags, F_CS_NOW)) {\\n  if (tcnt \\u0026lt; OCR1A) {\\n    motor1.last_cs = analogRead(P_M1_CS);\\n    motor1.last_cs_read = millis(); //probably too slow TEST IT\\n    bitClear(motor1.flags, F_CS_NOW); // we read it so lets clear it\\n  }\\n}\\nif (bitRead(motor2.flags, F_CS_NOW)) {\\n  if (tcnt \\u0026lt; OCR1B) {\\n    motor2.last_cs = analogRead(P_M2_CS);\\n    motor2.last_cs_read = millis();\\n    bitClear(motor2.flags, F_CS_NOW); // we read it so lets clear it\\n  }\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003e}\\u003cbr\\u003e\\n}\\u003cbr\\u003e\\nvoid loop() {\\u003cbr\\u003e\\n// put your main code here, to run repeatedly:\\u003cbr\\u003e\\n//    snprintf_P(pbuff, sizeof(pbuff), PSTR(\\\"%i  =  %i\\\"), millis(), cnt);\\u003cbr\\u003e\\n// check if we do CS and if its time\\u003cbr\\u003e\\nmotor1.CheckCS();\\u003cbr\\u003e\\nmotor2.CheckCS();\\u003cbr\\u003e\\n}\\u003c/p\\u003e\",\"post_number\":10,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-14T01:21:37.398Z\",\"reply_count\":1,\"reply_to_post_number\":9,\"quote_count\":0,\"incoming_link_count\":7,\"reads\":46,\"readers_count\":45,\"score\":64.2,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Martin Pirringer\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://www.chiefdelphi.com/tag/of\",\"internal\":true,\"reflection\":false,\"clicks\":0},{\"url\":\"https://www.chiefdelphi.com/tag/4\",\"internal\":true,\"reflection\":false,\"clicks\":0}],\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":21715,\"username\":\"asid61\",\"name\":\"Anand Rajamani\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/asid61/{size}/7179_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":24690,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Mentor \"},\"post_url\":\"/t/arduino-micros-question/412626/10\",\"custom_user_title\":\"Mentor \",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3069029,\"name\":\"Martin Pirringer\",\"username\":\"mpirringer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mpirringer/{size}/124489_2.png\",\"created_at\":\"2022-06-14T01:28:33.399Z\",\"cooked\":\"\\u003cp\\u003eLook at the ISR routines. The current only shows when the PWM signal is high so I got a pin interrupt on the PWM pin and if one of the 2PWM pins go high I read the current (hopefully)\\u003c/p\\u003e\\n\\u003cp\\u003eIts work in progress RN I am printing a setup that allows me to use a CIM as a balast and another one to drive and use the gearing to adjust the current. When that is complete then I can control both motors and have adjustable Load on the motor and gears (could become a 3DP gear tester) but RN I am interested mainly to make a controller as described above and use it for the wormgear project\\u003c/p\\u003e\",\"post_number\":11,\"post_type\":1,\"posts_count\":11,\"updated_at\":\"2022-06-14T01:28:33.399Z\",\"reply_count\":0,\"reply_to_post_number\":10,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":34,\"readers_count\":33,\"score\":41.8,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"Martin Pirringer\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":24690,\"username\":\"mpirringer\",\"name\":\"Martin Pirringer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mpirringer/{size}/124489_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":2}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":24690,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Mentor \"},\"post_url\":\"/t/arduino-micros-question/412626/11\",\"custom_user_title\":\"Mentor \",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2}],\"current_user_reaction\":null,\"reaction_users_count\":2,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3214145,\"name\":\"system\",\"username\":\"system\",\"avatar_template\":\"/uploads/default/original/4X/9/3/2/93234578e69f55873c63fc00fe2d0d85f23bce55.png\",\"created_at\":\"2023-06-14T01:28:35.768Z\",\"cooked\":\"\\u003cp\\u003eThis topic was automatically closed 365 days after the last reply. New replies are no longer allowed.\\u003c/p\\u003e\",\"post_number\":12,\"post_type\":3,\"posts_count\":11,\"updated_at\":\"2023-06-14T01:28:35.768Z\",\"reply_count\":0,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":2,\"readers_count\":1,\"score\":0.4,\"yours\":false,\"topic_id\":412626,\"topic_slug\":\"arduino-micros-question\",\"display_username\":\"system\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":true,\"admin\":true,\"staff\":true,\"user_id\":-1,\"hidden\":false,\"trust_level\":4,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"action_code\":\"autoclosed.enabled\",\"post_url\":\"/t/arduino-micros-question/412626/12\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true}],\"stream\":[3068285,3068288,3068291,3068896,3068965,3068975,3068987,3068999,3069028,3069029,3214145]},\"timeline_lookup\":[[1,1221],[4,1217],[6,1216],[11,851]],\"suggested_topics\":[{\"fancy_title\":\"Magicbot injection error\",\"id\":483278,\"title\":\"Magicbot injection error\",\"slug\":\"magicbot-injection-error\",\"posts_count\":1,\"reply_count\":0,\"highest_post_number\":1,\"image_url\":null,\"created_at\":\"2025-01-23T22:40:42.532Z\",\"last_posted_at\":\"2025-01-23T22:40:42.615Z\",\"bumped\":true,\"bumped_at\":\"2025-01-23T22:40:42.615Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"I’m having an issue where magic bot isn’t injecting a motor into the elevator. My code is in this repo on the feat/elevator. I am trying to get elevatorMotor1 into Elevator.py. Below is the error log …\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[],\"tags_descriptions\":{},\"like_count\":0,\"views\":56,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3491094,\"topic_post_liked\":false,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":false,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":71420,\"username\":\"Kredcool\",\"name\":null,\"avatar_template\":\"/letter_avatar_proxy/v4/letter/k/5daacb/{size}.png\"},\"posters\":[{\"extras\":\"latest single\",\"description\":\"Original Poster, Most Recent Poster\",\"user\":{\"id\":71420,\"username\":\"Kredcool\",\"name\":null,\"avatar_template\":\"/letter_avatar_proxy/v4/letter/k/5daacb/{size}.png\",\"trust_level\":1}}]},{\"fancy_title\":\"Logging Commands\",\"id\":475631,\"title\":\"Logging Commands\",\"slug\":\"logging-commands\",\"posts_count\":18,\"reply_count\":11,\"highest_post_number\":18,\"image_url\":null,\"created_at\":\"2024-11-26T17:53:26.777Z\",\"last_posted_at\":\"2024-11-30T14:26:02.824Z\",\"bumped\":true,\"bumped_at\":\"2024-11-30T14:26:02.824Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"As our team continues to mature and utilize logging more, we are looking at logging the execution of all of Commands. We believe this will help give us insight into determining what’s happening, when…\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[],\"tags_descriptions\":{},\"like_count\":14,\"views\":661,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3452084,\"topic_post_liked\":false,\"topic_post_like_count\":5,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":true,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":37016,\"username\":\"rjbell4\",\"name\":\"Bob Bell\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/r/8c91f0/{size}.png\"},\"posters\":[{\"extras\":null,\"description\":\"Original Poster\",\"user\":{\"id\":37016,\"username\":\"rjbell4\",\"name\":\"Bob Bell\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/r/8c91f0/{size}.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":25916,\"username\":\"SamCarlberg\",\"name\":\"Sam Carlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":56324,\"username\":\"Daniel1464\",\"name\":\"Daniel C.\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/d/6bbea6/{size}.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":33946,\"username\":\"Amicus1\",\"name\":\"Amicus1\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/a/a9adbd/{size}.png\",\"trust_level\":2}},{\"extras\":\"latest\",\"description\":\"Most Recent Poster\",\"user\":{\"id\":24594,\"username\":\"SLAB-Mr.Thomas\",\"name\":\"SLAB-Mr.Thomas\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/slab-mr.thomas/{size}/182153_2.png\",\"trust_level\":2}}]},{\"fancy_title\":\"MotionMagic Arm/Cosine\",\"id\":491504,\"title\":\"MotionMagic Arm/Cosine\",\"slug\":\"motionmagic-arm-cosine\",\"posts_count\":4,\"reply_count\":1,\"highest_post_number\":4,\"image_url\":null,\"created_at\":\"2025-02-13T08:52:22.464Z\",\"last_posted_at\":\"2025-02-13T16:25:37.526Z\",\"bumped\":true,\"bumped_at\":\"2025-02-13T16:25:37.526Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"It should be 0 at horizontal and 1/4 at vertically.\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[],\"tags_descriptions\":{},\"like_count\":0,\"views\":245,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":true,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3525884,\"topic_post_liked\":false,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":false,\"topic_post_is_current_users\":null,\"topic_post_number\":2,\"topic_post_user\":{\"id\":62573,\"username\":\"KfirNeuman\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/k/d07c76/{size}.png\"},\"posters\":[{\"extras\":\"latest\",\"description\":\"Original Poster, Most Recent Poster\",\"user\":{\"id\":64351,\"username\":\"GronkBaby\",\"name\":\"Emil\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/g/ba8739/{size}.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster, Accepted Answer\",\"user\":{\"id\":62573,\"username\":\"KfirNeuman\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/k/d07c76/{size}.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":48146,\"username\":\"bhall-ctre\",\"name\":\"Benjamin Hall\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/bhall-ctre/{size}/198180_2.png\",\"primary_group_name\":\"CTRE\",\"flair_name\":\"CTRE\",\"flair_url\":\"/uploads/default/original/3X/1/b/1bd2b430e1bb6427d1c6504ff6abcd31de851a6d.png\",\"flair_group_id\":57,\"trust_level\":2}}]},{\"fancy_title\":\"YAGSL Driving in Wrong Direction when Rotated\",\"id\":492618,\"title\":\"YAGSL Driving in Wrong Direction when Rotated\",\"slug\":\"yagsl-driving-in-wrong-direction-when-rotated\",\"posts_count\":9,\"reply_count\":7,\"highest_post_number\":9,\"image_url\":null,\"created_at\":\"2025-02-21T20:09:38.242Z\",\"last_posted_at\":\"2025-02-27T21:49:01.668Z\",\"bumped\":true,\"bumped_at\":\"2025-02-27T21:49:01.668Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"It could be either. Go through the eight steps again if you can\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[\"swerve\",\"swervedrive\",\"yagsl\"],\"tags_descriptions\":{},\"like_count\":4,\"views\":181,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":true,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3535867,\"topic_post_liked\":false,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":false,\"topic_post_is_current_users\":null,\"topic_post_number\":4,\"topic_post_user\":{\"id\":51887,\"username\":\"nstrike\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/nstrike/{size}/167038_2.png\"},\"posters\":[{\"extras\":null,\"description\":\"Original Poster\",\"user\":{\"id\":63873,\"username\":\"9636Programmer\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/9/90db22/{size}.png\",\"trust_level\":1}},{\"extras\":null,\"description\":\"Frequent Poster, Accepted Answer\",\"user\":{\"id\":51887,\"username\":\"nstrike\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/nstrike/{size}/167038_2.png\",\"trust_level\":2}},{\"extras\":\"latest\",\"description\":\"Most Recent Poster\",\"user\":{\"id\":51771,\"username\":\"jsjohn2000\",\"name\":\"Jason Johnson\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/a88e57/{size}.png\",\"trust_level\":2}}]},{\"fancy_title\":\"Periodic in autonomous help\",\"id\":493601,\"title\":\"Periodic in autonomous help\",\"slug\":\"periodic-in-autonomous-help\",\"posts_count\":5,\"reply_count\":2,\"highest_post_number\":5,\"image_url\":null,\"created_at\":\"2025-02-28T09:08:16.900Z\",\"last_posted_at\":\"2025-02-28T22:35:29.290Z\",\"bumped\":true,\"bumped_at\":\"2025-02-28T22:55:04.107Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"Hi, sorry if this is a silly question, but I faced a lot of trouble with it last year and was hoping for some insight. Does periodic run during the autonomous period? Or is that what AutonomousPeriodi…\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[],\"tags_descriptions\":{},\"like_count\":0,\"views\":138,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3543324,\"topic_post_liked\":false,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":true,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":55039,\"username\":\"AndriesCMfgA\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/a/3ab097/{size}.png\"},\"posters\":[{\"extras\":null,\"description\":\"Original Poster\",\"user\":{\"id\":55039,\"username\":\"AndriesCMfgA\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/a/3ab097/{size}.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":28240,\"username\":\"icemannie\",\"name\":\"icemannie\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/i/bc79bd/{size}.png\",\"trust_level\":2}},{\"extras\":\"latest\",\"description\":\"Most Recent Poster\",\"user\":{\"id\":63596,\"username\":\"Otter502\",\"name\":\"Val\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/otter502/{size}/245799_2.png\",\"trust_level\":2}}]}],\"tags\":[],\"tags_descriptions\":{},\"fancy_title\":\"Arduino Micros() Question\",\"id\":412626,\"title\":\"Arduino Micros() Question\",\"posts_count\":11,\"created_at\":\"2022-06-08T20:26:29.134Z\",\"views\":1161,\"reply_count\":6,\"like_count\":15,\"last_posted_at\":\"2023-06-14T01:28:35.768Z\",\"visible\":true,\"closed\":true,\"archived\":false,\"has_summary\":false,\"archetype\":\"regular\",\"slug\":\"arduino-micros-question\",\"category_id\":30,\"word_count\":3090,\"deleted_at\":null,\"user_id\":38287,\"featured_link\":null,\"pinned_globally\":false,\"pinned_at\":null,\"pinned_until\":null,\"image_url\":\"https://www.chiefdelphi.com/uploads/default/optimized/3X/a/9/a99f52371bd4899350b08174ed626eaf9220e241_2_1023x241.png\",\"slow_mode_seconds\":0,\"draft\":null,\"draft_key\":\"topic_412626\",\"draft_sequence\":null,\"unpinned\":null,\"pinned\":false,\"current_post_number\":1,\"highest_post_number\":12,\"deleted_by\":null,\"actions_summary\":[{\"id\":4,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":8,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":10,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":7,\"count\":0,\"hidden\":false,\"can_act\":false}],\"chunk_size\":20,\"bookmarked\":false,\"topic_timer\":null,\"message_bus_last_id\":0,\"participant_count\":4,\"show_read_indicator\":false,\"thumbnails\":[{\"max_width\":null,\"max_height\":null,\"width\":1183,\"height\":279,\"url\":\"https://www.chiefdelphi.com/uploads/default/original/3X/a/9/a99f52371bd4899350b08174ed626eaf9220e241.png\"},{\"max_width\":1024,\"max_height\":1024,\"width\":1023,\"height\":241,\"url\":\"https://www.chiefdelphi.com/uploads/default/optimized/3X/a/9/a99f52371bd4899350b08174ed626eaf9220e241_2_1023x241.png\"}],\"slow_mode_enabled_until\":null,\"valid_reactions\":[\"heart\",\"laughing\",\"point_up\",\"+1\",\"-1\",\"100\",\"open_mouth\",\"cry\",\"question\",\"thinking\",\"call_me_hand\",\"hugs\",\"angry\"],\"accepted_answer\":{\"post_number\":2,\"username\":\"Owen_Busler\",\"name\":null,\"excerpt\":\"Take a look at the arduino reference for millis() : \\u003ca href=\\\"https://www.arduino.cc/reference/en/language/functions/time/micros/\\\" class=\\\"inline-onebox\\\"\\u003emicros() - Arduino Reference\\u003c/a\\u003e \\nIt returns an unsigned long which will still overflow after about 70 minutes. \\nHere is the reference for unsigned long: \\u003ca href=\\\"https://www.arduino.cc/reference/en/language/variables/data-types/unsignedlong/\\\" class=\\\"inline-onebox\\\"\\u003eunsigned long - Arduino Reference\\u003c/a\\u003e \\nIf you want, you can add some logic which tracks rollovers when\\u0026hellip;\",\"accepter_name\":null},\"user_chosen_thumbnail_url\":null,\"sidecar_installed\":true,\"can_vote\":false,\"vote_count\":0,\"user_voted\":false,\"discourse_zendesk_plugin_zendesk_id\":null,\"discourse_zendesk_plugin_zendesk_url\":\"https://your-url.zendesk.com/agent/tickets/\",\"details\":{\"can_edit\":false,\"notification_level\":1,\"participants\":[{\"id\":24690,\"username\":\"mpirringer\",\"name\":\"Martin Pirringer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mpirringer/{size}/124489_2.png\",\"post_count\":4,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":38287,\"username\":\"Radiator72\",\"name\":\"Noah Bistline\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/radiator72/{size}/112761_2.png\",\"post_count\":3,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":21715,\"username\":\"asid61\",\"name\":\"Anand Rajamani\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/asid61/{size}/7179_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":23320,\"username\":\"Owen_Busler\",\"name\":\"Owen Busler\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/owen_busler/{size}/7684_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2}],\"created_by\":{\"id\":38287,\"username\":\"Radiator72\",\"name\":\"Noah Bistline\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/radiator72/{size}/112761_2.png\"},\"last_poster\":{\"id\":-1,\"username\":\"system\",\"name\":\"system\",\"avatar_template\":\"/uploads/default/original/4X/9/3/2/93234578e69f55873c63fc00fe2d0d85f23bce55.png\"},\"links\":[{\"url\":\"https://www.arduino.cc/reference/en/language/functions/time/micros/\",\"title\":\"micros() - Arduino Reference\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":9,\"user_id\":23320,\"domain\":\"www.arduino.cc\",\"root_domain\":\"arduino.cc\"},{\"url\":\"https://www.arduino.cc/reference/en/language/variables/data-types/int/\",\"title\":\"int - Arduino Reference\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":2,\"user_id\":23320,\"domain\":\"www.arduino.cc\",\"root_domain\":\"arduino.cc\"},{\"url\":\"https://www.arduino.cc/reference/en/language/variables/data-types/unsignedlong/\",\"title\":\"unsigned long - Arduino Reference\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":2,\"user_id\":23320,\"domain\":\"www.arduino.cc\",\"root_domain\":\"arduino.cc\"}]},\"bookmarks\":[]}"}
