{"data":"{\"post_stream\":{\"posts\":[{\"id\":3234659,\"name\":\"\",\"username\":\"Jelatinone\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\",\"created_at\":\"2023-09-24T11:12:00.119Z\",\"cooked\":\"\\u003cp\\u003eHello! \\u003cimg src=\\\"https://www.chiefdelphi.com/images/emoji/google/smiley.png?v=12\\\" title=\\\":smiley:\\\" class=\\\"emoji\\\" alt=\\\":smiley:\\\" loading=\\\"lazy\\\" width=\\\"20\\\" height=\\\"20\\\"\\u003e I’m working on a project utilizing \\u003ca href=\\\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.html\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eLQR\\u003c/a\\u003e to achieve accurate positions for Swerve Module azimuths. as a proof of concept that it could possibly be a better approach in season as opposed to my team’s tradition approach of \\u003ca href=\\\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/controller/PIDController.html\\\" rel=\\\"noopener nofollow ugc\\\"\\u003ePID control\\u003c/a\\u003e (Which cost us a lot of time this season). I’ve built my Module class around a pre-defined \\u003ca href=\\\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/system/LinearSystemLoop.html\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eLinear System Loop\\u003c/a\\u003e. However, my error originates in constants, where each module is defined when the Modules are created.\\u003c/p\\u003e\\n\\u003cp\\u003eHere’s what the Constants file which defines the Module(s) and where the error originates from looks like:\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003epublic static final class FL_Module {\\n\\n          public static final class Values {\\n            public static final Double MAXIMUM_AZIMUTH_ACCELERATION = (Math.PI*2);    \\n            public static final Double AZIMUTH_ENCODER_POSITION_OFFSET = (-313.006);\\n            public static final Double MAXIMUM_AZIMUTH_VOLTAGE = (12.0);            \\n            public static final Double MAXIMUM_AZIMUTH_VELOCITY = (5.4);\\n            public static final Double MAXIMUM_LINEAR_VELOCITY = (5.4);\\n            public static final Double ACCELERATION_GAIN = (1.0); //TODO \\u0026lt;---- Find Acceleration Gain (kA) of Linear Position System, Volts/(Units/Sec^2), DO NOT DEPLOY THIS UNTIL FOUND\\n            public static final Double VELOCITY_GAIN = (1.0); //TODO \\u0026lt;---- Find Velocity Gain (kV) of Linear Position System, Volts/(Units/Sec), DO NOT DEPLOY THIS UNTIL FOUND\\n\\n            public static final Double LINEAR_ENCODER_SENSITIVITY = (2048.0);     \\n            public static final Double ENCODER_SENSITIVITY = (4096.0);   \\n\\n            public static final Double MODEL_VELOCITY_ACCURACY_DEGREES = (7e-5);\\n            public static final Double MODEL_POSITION_ACCURACY_RPM = (2.5e-4);\\n            public static final Double DISCRETIZATION_TIMESTEP = (1/50.0);\\n\\n            public static final Integer AZIMUTH_ID = (21);                       \\n            public static final Integer LINEAR_ID = (11);    \\n            public static final Integer SENSOR_ID = (4);\\n          }\\n\\n          public static final class Components {\\n            public static final WPI_CANCoder AZIMUTH_SENSOR = DrivebaseModule.configureRotationEncoder((new WPI_CANCoder(Values.SENSOR_ID)), Values.AZIMUTH_ENCODER_POSITION_OFFSET);\\n            public static final WPI_TalonFX LINEAR_CONTROLLER = DrivebaseModule.configureTranslationController(new WPI_TalonFX(Values.LINEAR_ID), Constants.Values.ComponentData.DRIVE_CURRENT_LIMIT);            \\n            public static final WPI_TalonFX AZIMUTH_CONTROLLER = DrivebaseModule.configureRotationController(new WPI_TalonFX(Values.AZIMUTH_ID), AZIMUTH_SENSOR, Constants.Values.ComponentData.AZIMUTH_CURRENT_LIMIT, Constants.Values.ComponentData.AZIMUTH_DEADBAND);                                 \\n            public static final Supplier\\u0026lt;SwerveModuleState\\u0026gt; STATE_SENSOR = () -\\u0026gt; new SwerveModuleState(\\n              (2.0)*(((LINEAR_CONTROLLER.getSelectedSensorVelocity() / Values.LINEAR_ENCODER_SENSITIVITY) * (10)) / Constants.Values.Chassis.DRIVETRAIN_GEAR_RATIO) * Math.PI * Constants.Values.Chassis.WHEEL_DIAMETER,\\n              new Rotation2d(AZIMUTH_SENSOR.getAbsolutePosition()));            \\n            public static final DrivebaseModule MODULE = new DrivebaseModule(new MotorControllerGroup(AZIMUTH_CONTROLLER), new MotorControllerGroup(AZIMUTH_CONTROLLER), STATE_SENSOR, () -\\u0026gt; Values.MAXIMUM_LINEAR_VELOCITY, () -\\u0026gt; Control.CONSTRAINTS, Control.CONTROL_LOOP);\\n          }\\n      \\n\\n          public static final class Control {\\n            public static final TrapezoidProfile.Constraints CONSTRAINTS = new TrapezoidProfile.Constraints(Values.MAXIMUM_AZIMUTH_VELOCITY, Values.MAXIMUM_AZIMUTH_ACCELERATION);\\n            public static final LinearSystem\\u0026lt;N2,N1,N1\\u0026gt; PLANT = LinearSystemId.identifyPositionSystem(Values.VELOCITY_GAIN, Values.ACCELERATION_GAIN);        \\n            public static final LinearSystemLoop\\u0026lt;N2,N1,N1\\u0026gt; CONTROL_LOOP = new LinearSystemLoop\\u0026lt;\\u0026gt;(\\n              PLANT,\\n              new LinearQuadraticRegulator\\u0026lt;\\u0026gt;(\\n                PLANT,\\n                VecBuilder.fill(Units.degreesToRadians(Components.AZIMUTH_SENSOR.getAbsolutePosition()), Units.rotationsPerMinuteToRadiansPerSecond(Components.AZIMUTH_SENSOR.getVelocity())), //\\u0026lt;---- Controller error weight, how much we want to conserve controller error, or how accurate we want to be, increased time to target\\n                VecBuilder.fill(Values.MAXIMUM_AZIMUTH_VOLTAGE), //\\u0026lt;---- Controller effort weight, how much we want to conserve controller expenditure or how fast we want to be; increased state error\\n                Values.DISCRETIZATION_TIMESTEP),\\n              new KalmanFilter\\u0026lt;\\u0026gt;(\\n                  Nat.N2(),\\n                  Nat.N1(),\\n                  PLANT,\\n                  VecBuilder.fill(Units.degreesToRadians(Values.MODEL_VELOCITY_ACCURACY_DEGREES), Units.rotationsPerMinuteToRadiansPerSecond(Values.MODEL_POSITION_ACCURACY_RPM)), //\\u0026lt;---- How accurate we think our models are\\n                  VecBuilder.fill(Units.rotationsPerMinuteToRadiansPerSecond(1 / Values.ENCODER_SENSITIVITY)), //\\u0026lt;---- How accurate we think our encoders are \\n                  Values.DISCRETIZATION_TIMESTEP),\\n              Values.MAXIMUM_AZIMUTH_VOLTAGE,\\n              Values.DISCRETIZATION_TIMESTEP);\\n          }\\n        }\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eFor some additional context, I’m also trying to utilize \\u003ca href=\\\"https://github.com/Mechanical-Advantage/AdvantageKit\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eAdvantage Kit\\u003c/a\\u003e for the replay and logging features it has, but I can’t get much use out of it so far considering nothing can be logged if it crashed prior to logging starting.\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cstrong\\u003eThis is what the console looks like:\\u003c/strong\\u003e\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003e********** Robot program starting **********\\nNT: Listening on NT3 port 1735, NT4 port 5810\\nDataLog: Logging to 'src\\\\main\\\\java\\\\frc\\\\deploy\\\\logs\\\\Log_f8b5b944bd570ad7.wpilog'\\n[phoenix] CANbus Connected: sim\\n[phoenix] CANbus Network Up: sim\\nCTR: CAN frame not received/too-stale.\\n        CANCoder 4 GetAbsolutePosition\\nCTR: CAN frame not received/too-stale.\\n        CANCoder 4 GetAbsolutePosition\\nabort: Failure at D:\\\\a\\\\allwpilib\\\\allwpilib\\\\wpimath\\\\src\\\\main\\\\native\\\\thirdparty\\\\drake\\\\src\\\\math\\\\discrete_algebraic_riccati_equation.cpp:417 in DiscreteAlgebraicRiccatiEquation(): condition 'is_approx_equal_abstol(Q, Q.transpose(), 1e-10)' failed.\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eMy initial solution was to remove all references to special values such as Double.NaN and Infinity as per this: \\u003ca href=\\\"https://github.wpilib.org/allwpilib/docs/release/cpp/namespacedrake.html#a3cd8151cc95b5b95de9a9b882e27ed84\\\" rel=\\\"noopener nofollow ugc\\\"\\u003edrake Namespace Reference\\u003c/a\\u003e, and \\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/issues/5339\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eGithub Issue\\u003c/a\\u003e.\\u003c/p\\u003e\\n\\u003cp\\u003eAt some point during my debugging session, I was able to yield a different (Much more revealing) error, (With a stacktrace!):\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003e********** Robot program starting **********\\nNT: Listening on NT3 port 1735, NT4 port 5810\\nDataLog: Logging to 'src\\\\main\\\\java\\\\frc\\\\deploy\\\\logs\\\\Log_9ed21a554a9f2c61.wpilog'\\n[phoenix] CANbus Connected: sim\\n[phoenix] CANbus Network Up: sim\\nCTR: CAN frame not received/too-stale.\\n        CANCoder 4 GetAbsolutePosition\\nCTR: CAN frame not received/too-stale.\\n        CANCoder 4 GetAbsolutePosition\\nError at frc.robot.subsystems.drivebase.Constants$Hardware$Modules$FL_Module$Control.\\u0026lt;clinit\\u0026gt;(Constants.java:109): Unhandled exception: java.lang.RuntimeException: Failure at D:\\\\a\\\\allwpilib\\\\allwpilib\\\\wpimath\\\\src\\\\main\\\\native\\\\thirdparty\\\\drake\\\\src\\\\math\\\\discrete_algebraic_riccati_equation.cpp:420 in DiscreteAlgebraicRiccatiEquation(): condition 'es.eigenvalues()[i] \\u0026gt;= 0' failed.\\n        at edu.wpi.first.math.WPIMathJNI.discreteAlgebraicRiccatiEquation(Native Method)\\n        at edu.wpi.first.math.Drake.discreteAlgebraicRiccatiEquation(Drake.java:24)\\n        at edu.wpi.first.math.Drake.discreteAlgebraicRiccatiEquation(Drake.java:53)\\n        at edu.wpi.first.math.controller.LinearQuadraticRegulator.\\u0026lt;init\\u0026gt;(LinearQuadraticRegulator.java:114)\\n        at edu.wpi.first.math.controller.LinearQuadraticRegulator.\\u0026lt;init\\u0026gt;(LinearQuadraticRegulator.java:49)\\n        at frc.robot.subsystems.drivebase.Constants$Hardware$Modules$FL_Module$Control.\\u0026lt;clinit\\u0026gt;(Constants.java:109)\\n        at frc.robot.subsystems.drivebase.Constants$Hardware$Modules$FL_Module$Components.\\u0026lt;clinit\\u0026gt;(Constants.java:100)\\n        at frc.robot.subsystems.drivebase.DrivebaseSubsystem.\\u0026lt;clinit\\u0026gt;(DrivebaseSubsystem.java:59)\\n        at frc.robot.Constants$Subsystems.\\u0026lt;clinit\\u0026gt;(Constants.java:14)\\n        at frc.robot.RobotContainer.\\u0026lt;init\\u0026gt;(RobotContainer.java:16)\\n        at frc.robot.RobotContainer.getInstance(RobotContainer.java:33)\\n        at frc.robot.Robot.robotInit(Robot.java:68)\\n        at org.littletonrobotics.junction.LoggedRobot.startCompetition(LoggedRobot.java:59)\\n        at edu.wpi.first.wpilibj.RobotBase.runRobot(RobotBase.java:358)\\n        at edu.wpi.first.wpilibj.RobotBase.lambda$startRobot$0(RobotBase.java:431)\\n        at java.base/java.lang.Thread.run(Thread.java:833)\\n\\nWarning at edu.wpi.first.wpilibj.RobotBase.runRobot(RobotBase.java:373): The robot program quit unexpectedly. This is usually due to a code error.\\n  The above stacktrace can help determine where the error occurred.\\n  See https://wpilib.org/stacktrace for more information.\\nError at edu.wpi.first.wpilibj.RobotBase.runRobot(RobotBase.java:380): The startCompetition() method (or methods called by it) should have handled the exception above.      \\n[phoenix-diagnostics] Server shutdown cleanly. (dur:0)\\n\\n[phoenix] Library shutdown cleanly\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eUnfortunately, I have since gone back to the original error message, which isn’t very helpful for debugging my system. Looking at those two issues since then again, I tried removing any references to negative Qelms and Relms, but I don’t actually have any when defining LinearSystemLoop or in my Constants (Where the modules are defined) as a whole. The only place they could appear is getting simulated encoder Absolute values, or From Joystick Inputs (Which wouldn’t make sense because the Joystick isn’t reference yet or even plugged in for that matter).\\u003c/p\\u003e\\n\\u003cp\\u003eTherefore, as my last option and not making any progress for the last 3 hours, I have posted here. \\u003cstrong\\u003eAnybody have any suggestions? Is this just limited to Simulated code because of something to do with the JNI?\\u003c/strong\\u003e\\u003c/p\\u003e\",\"post_number\":1,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-24T11:12:00.119Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":109,\"reads\":291,\"readers_count\":290,\"score\":608.2,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.html\",\"internal\":false,\"reflection\":false,\"title\":\"LinearQuadraticRegulator (WPILib API 2023.4.3)\",\"clicks\":48},{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/system/LinearSystemLoop.html\",\"internal\":false,\"reflection\":false,\"title\":\"LinearSystemLoop (WPILib API 2023.4.3)\",\"clicks\":8},{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/controller/PIDController.html\",\"internal\":false,\"reflection\":false,\"title\":\"PIDController (WPILib API 2023.4.3)\",\"clicks\":4},{\"url\":\"https://github.com/wpilibsuite/allwpilib/issues/5339\",\"internal\":false,\"reflection\":false,\"title\":\"Discretization.discretizeAQTaylor() is inaccurate · Issue #5339 · wpilibsuite/allwpilib · GitHub\",\"clicks\":1},{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/cpp/namespacedrake.html#a3cd8151cc95b5b95de9a9b882e27ed84\",\"internal\":false,\"reflection\":false,\"title\":\"WPILibC++: drake Namespace Reference\",\"clicks\":1},{\"url\":\"https://github.com/Mechanical-Advantage/AdvantageKit\",\"internal\":false,\"reflection\":false,\"title\":\"GitHub - Mechanical-Advantage/AdvantageKit: Monorepo for robot framework and tools\",\"clicks\":0}],\"read\":true,\"user_title\":null,\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":58184,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"World's 'Greatest' Programmer\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/1\",\"custom_user_title\":\"World's 'Greatest' Programmer\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true,\"can_vote\":false},{\"id\":3234665,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2023-09-24T12:57:20.901Z\",\"cooked\":\"\\u003cp\\u003eFor a simple linear system, LQR is going to be equivalent to PID with properly-tuned gains.  The main reason to use LQR is for conceptual clarity and to keep your code in more interpretable units, rather than for performance.  I don’t mean to discourage you from pursuing LQR; I just want to make sure you have realistic expectations about how it’s likely to function.\\u003c/p\\u003e\\n\\u003cp\\u003eThe LinearSystemLoop abstraction is, in my opinion, a little bit overwrought and I think you might have better luck using the Kalman filter and LQR objects directly with your own plumbing.\\u003c/p\\u003e\",\"post_number\":2,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-24T13:18:08.088Z\",\"reply_count\":2,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":224,\"readers_count\":223,\"score\":54.8,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/2\",\"custom_user_title\":\"Robot apartments! invisible suburbs! skeleton treasuries!\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3234671,\"name\":\"\",\"username\":\"yotam201410\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/y/f9ae1b/{size}.png\",\"created_at\":\"2023-09-24T14:17:38.651Z\",\"cooked\":\"\\u003cp\\u003eIn addition, keep in mind that robot Rio is very limited and has a hard time processing a lot of LQR loops and with it being a loop per module it can really take a lot of memory and processing power from the rest of the robot\\u003c/p\\u003e\",\"post_number\":3,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-24T14:18:12.689Z\",\"reply_count\":1,\"reply_to_post_number\":2,\"quote_count\":0,\"incoming_link_count\":2,\"reads\":213,\"readers_count\":212,\"score\":72.6,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":51413,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/3\",\"custom_user_title\":null,\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3234698,\"name\":\"Tyler Veness\",\"username\":\"calcmogul\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/calcmogul/{size}/128045_2.png\",\"created_at\":\"2023-09-24T17:39:15.594Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"Jelatinone\\\" data-post=\\\"1\\\" data-topic=\\\"441379\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/j/f475e1/48.png\\\" class=\\\"avatar\\\"\\u003e Jelatinone:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003e              new LinearQuadraticRegulator\\u0026lt;\\u0026gt;(\\n                PLANT,\\n                VecBuilder.fill(Units.degreesToRadians(Components.AZIMUTH_SENSOR.getAbsolutePosition()), Units.rotationsPerMinuteToRadiansPerSecond(Components.AZIMUTH_SENSOR.getVelocity())), //\\u0026lt;---- Controller error weight, how much we want to conserve controller error, or how accurate we want to be, increased time to target\\n                VecBuilder.fill(Values.MAXIMUM_AZIMUTH_VOLTAGE), //\\u0026lt;---- Controller effort weight, how much we want to conserve controller expenditure or how fast we want to be; increased state error\\n                Values.DISCRETIZATION_TIMESTEP),\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eYou should be passing positive constants to the VecBuilder.fill() calls. The encoder getters can return negative values, which would throw the second exception you saw.\\u003c/p\\u003e\\n\\u003cp\\u003eThe first one is from Q not being symmetric. It should be symmetric by construction though with the LQR overload you used.\\u003c/p\\u003e\\n\\u003cp\\u003eBy the way, we rewrote our DARE solver for 2024, and it will have better error messages than Drake’s (we call the C++ solver in JNI, which forwards the exception messages to Java).\\u003c/p\\u003e\\u003caside class=\\\"onebox githubblob\\\" data-onebox-src=\\\"https://github.com/wpilibsuite/allwpilib/blob/main/wpimath/src/main/native/include/frc/DARE.h#L45-L94\\\"\\u003e\\n  \\u003cheader class=\\\"source\\\"\\u003e\\n\\n      \\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/blob/main/wpimath/src/main/native/include/frc/DARE.h#L45-L94\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003egithub.com\\u003c/a\\u003e\\n  \\u003c/header\\u003e\\n\\n  \\u003carticle class=\\\"onebox-body\\\"\\u003e\\n    \\u003ch4\\u003e\\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/blob/main/wpimath/src/main/native/include/frc/DARE.h#L45-L94\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003ewpilibsuite/allwpilib/blob/main/wpimath/src/main/native/include/frc/DARE.h#L45-L94\\u003c/a\\u003e\\u003c/h4\\u003e\\n\\n\\n\\n    \\u003cpre class=\\\"onebox\\\"\\u003e\\u003ccode class=\\\"lang-h\\\"\\u003e\\n      \\u003col class=\\\"start lines\\\" start=\\\"45\\\" style=\\\"counter-reset: li-counter 44 ;\\\"\\u003e\\n          \\u003cli\\u003e// Require Q be symmetric\\u003c/li\\u003e\\n          \\u003cli\\u003eif ((Q - Q.transpose()).norm() \\u0026gt; 1e-10) {\\u003c/li\\u003e\\n          \\u003cli\\u003e  std::string msg = fmt::format(\\\"Q isn't symmetric!\\\\n\\\\nQ =\\\\n{}\\\\n\\\", Q);\\u003c/li\\u003e\\n          \\u003cli\\u003e  throw std::invalid_argument(msg);\\u003c/li\\u003e\\n          \\u003cli\\u003e}\\u003c/li\\u003e\\n          \\u003cli\\u003e\\u003c/li\\u003e\\n          \\u003cli\\u003e// Require Q be positive semidefinite\\u003c/li\\u003e\\n          \\u003cli\\u003e//\\u003c/li\\u003e\\n          \\u003cli\\u003e// If Q is a symmetric matrix with a decomposition LDLᵀ, the number of\\u003c/li\\u003e\\n          \\u003cli\\u003e// positive, negative, and zero diagonal entries in D equals the number of\\u003c/li\\u003e\\n          \\u003cli\\u003e// positive, negative, and zero eigenvalues respectively in Q (see\\u003c/li\\u003e\\n          \\u003cli\\u003e// https://en.wikipedia.org/wiki/Sylvester's_law_of_inertia).\\u003c/li\\u003e\\n          \\u003cli\\u003e//\\u003c/li\\u003e\\n          \\u003cli\\u003e// Therefore, D having no negative diagonal entries is sufficient to prove Q\\u003c/li\\u003e\\n          \\u003cli\\u003e// is positive semidefinite.\\u003c/li\\u003e\\n          \\u003cli\\u003eauto Q_ldlt = Q.ldlt();\\u003c/li\\u003e\\n          \\u003cli\\u003eif (Q_ldlt.info() != Eigen::Success ||\\u003c/li\\u003e\\n          \\u003cli\\u003e    (Q_ldlt.vectorD().array() \\u0026lt; 0.0).any()) {\\u003c/li\\u003e\\n          \\u003cli\\u003e  std::string msg =\\u003c/li\\u003e\\n          \\u003cli\\u003e      fmt::format(\\\"Q isn't positive semidefinite!\\\\n\\\\nQ =\\\\n{}\\\\n\\\", Q);\\u003c/li\\u003e\\n      \\u003c/ol\\u003e\\n    \\u003c/code\\u003e\\u003c/pre\\u003e\\n\\n\\n  This file has been truncated. \\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/blob/main/wpimath/src/main/native/include/frc/DARE.h#L45-L94\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eshow original\\u003c/a\\u003e\\n\\n  \\u003c/article\\u003e\\n\\n  \\u003cdiv class=\\\"onebox-metadata\\\"\\u003e\\n    \\n    \\n  \\u003c/div\\u003e\\n\\n  \\u003cdiv style=\\\"clear: both\\\"\\u003e\\u003c/div\\u003e\\n\\u003c/aside\\u003e\\n\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"yotam201410\\\" data-post=\\\"3\\\" data-topic=\\\"441379\\\" data-full=\\\"true\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/y/f9ae1b/48.png\\\" class=\\\"avatar\\\"\\u003e yotam201410:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eIn addition, keep in mind that robot Rio is very limited and has a hard time processing a lot of LQR loops and with it being a loop per module it can really take a lot of memory and processing power from the rest of the robot\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eI disagree with this. There’s construction cost from solving the DARE, but that should only happen at boot. After, that, it’s just a few floating point multiplies and adds in calculate() called every loop. Granted, EJML adds some intermediate matrix object allocations in there too, because Java doesn’t let us have nice things; C++ doesn’t have this overhead.\\u003c/p\\u003e\\u003caside class=\\\"onebox githubblob\\\" data-onebox-src=\\\"https://github.com/wpilibsuite/allwpilib/blob/v2023.4.3/wpimath/src/main/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.java#L229-L232\\\"\\u003e\\n  \\u003cheader class=\\\"source\\\"\\u003e\\n\\n      \\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/blob/v2023.4.3/wpimath/src/main/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.java#L229-L232\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003egithub.com\\u003c/a\\u003e\\n  \\u003c/header\\u003e\\n\\n  \\u003carticle class=\\\"onebox-body\\\"\\u003e\\n    \\u003ch4\\u003e\\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/blob/v2023.4.3/wpimath/src/main/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.java#L229-L232\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003ewpilibsuite/allwpilib/blob/v2023.4.3/wpimath/src/main/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.java#L229-L232\\u003c/a\\u003e\\u003c/h4\\u003e\\n\\n\\n\\n    \\u003cpre class=\\\"onebox\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003e\\n      \\u003col class=\\\"start lines\\\" start=\\\"229\\\" style=\\\"counter-reset: li-counter 228 ;\\\"\\u003e\\n          \\u003cli\\u003epublic Matrix\\u0026lt;Inputs, N1\\u0026gt; calculate(Matrix\\u0026lt;States, N1\\u0026gt; x) {\\u003c/li\\u003e\\n          \\u003cli\\u003e  m_u = m_K.times(m_r.minus(x));\\u003c/li\\u003e\\n          \\u003cli\\u003e  return m_u;\\u003c/li\\u003e\\n          \\u003cli\\u003e}\\u003c/li\\u003e\\n      \\u003c/ol\\u003e\\n    \\u003c/code\\u003e\\u003c/pre\\u003e\\n\\n\\n\\n  \\u003c/article\\u003e\\n\\n  \\u003cdiv class=\\\"onebox-metadata\\\"\\u003e\\n    \\n    \\n  \\u003c/div\\u003e\\n\\n  \\u003cdiv style=\\\"clear: both\\\"\\u003e\\u003c/div\\u003e\\n\\u003c/aside\\u003e\\n\\n\\u003cp\\u003eTo make snippets of code like that more performant, we could rewrite it to use free functions on \\u003ccode\\u003edouble[]\\u003c/code\\u003e instances (would be way less readable), or make the Java classes JNI wrappers around the C++ versions (would be a lot more boilerplate in the backend).\\u003c/p\\u003e\\n\\u003cp\\u003eIn any case, the first rule of performance is to measure. Once someone demonstrates it’s a performance bottleneck in a benchmark, we’\\u003cspan class=\\\"abbreviation\\\"\\u003ell\\u003ctemplate class=\\\"tooltiptext\\\"\\u003eLimelight, an integrated vision coprocessor\\u003c/template\\u003e\\u003c/span\\u003e optimize it.\\u003cbr\\u003e\\nRotation3d.rotateBy() was a recent instance of this; it was being called hundreds of times per loop, and we sped it up by 100x by replacing EJML vector operations in the underlying quaternion object with raw doubles.\\u003c/p\\u003e\",\"post_number\":4,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-24T18:00:40.364Z\",\"reply_count\":2,\"reply_to_post_number\":null,\"quote_count\":2,\"incoming_link_count\":1,\"reads\":191,\"readers_count\":190,\"score\":68.2,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"Tyler Veness\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":4,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://github.com/wpilibsuite/allwpilib/blob/main/wpimath/src/main/native/include/frc/DARE.h#L45-L94\",\"internal\":false,\"reflection\":false,\"clicks\":1},{\"url\":\"https://github.com/wpilibsuite/allwpilib/blob/v2023.4.3/wpimath/src/main/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.java#L229-L232\",\"internal\":false,\"reflection\":false,\"clicks\":0},{\"url\":\"https://www.chiefdelphi.com/t/usefulness-of-model-predictive-control-for-frc/442330\",\"internal\":true,\"reflection\":true,\"title\":\"Usefulness of Model Predictive Control for FRC\",\"clicks\":1}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16846,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"WPILib controls | Choreo optimizer backend\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/4\",\"custom_user_title\":\"WPILib controls | Choreo optimizer backend\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":true,\"topic_accepted_answer\":true},{\"id\":3234738,\"name\":\"\",\"username\":\"Jelatinone\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\",\"created_at\":\"2023-09-24T21:52:02.382Z\",\"cooked\":\"\\u003cp\\u003eI tried this last night too actually, did it like this:\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003e            public static final Double AZIMUTH_EPSILON_POSITION = Components.AZIMUTH_SENSOR.getAbsolutePosition();\\n            public static final Double AZIMUTH_EPSILON_VELOCITY = Components.AZIMUTH_SENSOR.getVelocity();\\n            public static final TrapezoidProfile.Constraints CONSTRAINTS = new TrapezoidProfile.Constraints(Values.MAXIMUM_AZIMUTH_VELOCITY, Values.MAXIMUM_AZIMUTH_ACCELERATION);\\n            public static final LinearSystem\\u0026lt;N2,N1,N1\\u0026gt; PLANT = LinearSystemId.identifyPositionSystem(Values.VELOCITY_GAIN, Values.ACCELERATION_GAIN);        \\n            public static final LinearSystemLoop\\u0026lt;N2,N1,N1\\u0026gt; CONTROL_LOOP = new LinearSystemLoop\\u0026lt;\\u0026gt;(\\n              PLANT,\\n              new LinearQuadraticRegulator\\u0026lt;\\u0026gt;(\\n                PLANT,\\n                VecBuilder.fill(Units.degreesToRadians((AZIMUTH_EPSILON_POSITION \\u0026gt;= 0)? (AZIMUTH_EPSILON_POSITION): (1.0)), Units.rotationsPerMinuteToRadiansPerSecond((AZIMUTH_EPSILON_VELOCITY \\u0026gt;= 0)? (AZIMUTH_EPSILON_VELOCITY): (1.0))), //\\u0026lt;---- Controller error weight, how much we want to conserve controller error, or how accurate we want to be, increased time to target\\n                VecBuilder.fill(Values.MAXIMUM_AZIMUTH_VOLTAGE), //\\u0026lt;---- Controller effort weight, how much we want to conserve controller expenditure or how fast we want to be; increased state error\\n                Values.DISCRETIZATION_TIMESTEP),\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eStill got the same error, but I just realized something, it should be \\u003ccode\\u003e\\u0026gt;\\u003c/code\\u003e not \\u003ccode\\u003e\\u0026gt;=\\u003c/code\\u003e, I think one of the errors about eigenvalues that I had read said \\u003ccode\\u003e\\u0026gt;= 0\\u003c/code\\u003e and that’s where I got this notion from. So used \\u0026gt; and set the default to 1 radian, \\u003cstrong\\u003eand good news it now simulates!\\u003c/strong\\u003e\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003e              new LinearQuadraticRegulator\\u0026lt;\\u0026gt;(\\n                PLANT,\\n                VecBuilder.fill(Units.degreesToRadians((AZIMUTH_EPSILON_POSITION \\u0026gt; 0)? (AZIMUTH_EPSILON_POSITION): (1.0)), Units.rotationsPerMinuteToRadiansPerSecond((AZIMUTH_EPSILON_VELOCITY \\u0026gt; 0)? (AZIMUTH_EPSILON_VELOCITY): (1.0))),\\n                VecBuilder.fill(Values.MAXIMUM_AZIMUTH_VOLTAGE), \\n                Values.DISCRETIZATION_TIMESTEP),\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003e\\u003cstrong\\u003eBut now I have a new question, what should the actual value defaults be since they cannot be less than or equal to 0, \\u003ccode\\u003eMath.abs()\\u003c/code\\u003e or change the CANCoder configurations to do .setPosition(0.0) as opposed to setAbsolutePosition()?\\u003c/strong\\u003e\\u003c/p\\u003e\",\"post_number\":5,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-24T21:52:02.382Z\",\"reply_count\":1,\"reply_to_post_number\":4,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":128,\"readers_count\":127,\"score\":30.6,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":16846,\"username\":\"calcmogul\",\"name\":\"Tyler Veness\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/calcmogul/{size}/128045_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":58184,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"World's 'Greatest' Programmer\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/5\",\"custom_user_title\":\"World's 'Greatest' Programmer\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3234742,\"name\":\"\",\"username\":\"Jelatinone\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\",\"created_at\":\"2023-09-24T22:11:02.543Z\",\"cooked\":\"\\u003cp\\u003eI will admit i’m not the greatest when it comes to math (I’m only in Pre-calc), so I can only really understand LQR from the videos i’ve watched, and I don’t fully understand the underlying equations, \\u003cstrong\\u003ebut I do understand how it works from a programming perspective, and tuning it.\\u003c/strong\\u003e, But wouldn’t LQR be easier to tune in theory given that you only need to tune for Qelms and Relms?\\u003c/p\\u003e\",\"post_number\":6,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-24T22:11:02.543Z\",\"reply_count\":1,\"reply_to_post_number\":2,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":116,\"readers_count\":115,\"score\":28.2,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":58184,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"World's 'Greatest' Programmer\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/6\",\"custom_user_title\":\"World's 'Greatest' Programmer\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3234743,\"name\":\"Tyler Veness\",\"username\":\"calcmogul\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/calcmogul/{size}/128045_2.png\",\"created_at\":\"2023-09-24T22:11:40.729Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"Jelatinone\\\" data-post=\\\"5\\\" data-topic=\\\"441379\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/j/f475e1/48.png\\\" class=\\\"avatar\\\"\\u003e Jelatinone:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eStill got the same error, but I just realized something, it should be \\u003ccode\\u003e\\u0026gt;\\u003c/code\\u003e not \\u003ccode\\u003e\\u0026gt;=\\u003c/code\\u003e, I think one of the errors about eigenvalues that I had read said \\u003ccode\\u003e\\u0026gt;= 0\\u003c/code\\u003e\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eThe vector constructor overload does the following to compute Q and R (with ρ = 1):\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cdiv class=\\\"lightbox-wrapper\\\"\\u003e\\u003ca class=\\\"lightbox\\\" href=\\\"https://www.chiefdelphi.com/uploads/default/original/3X/0/f/0fa0710ab2ead2415fa12e3542fcfc8cab599c0e.png\\\" data-download-href=\\\"https://www.chiefdelphi.com/uploads/default/0fa0710ab2ead2415fa12e3542fcfc8cab599c0e\\\" title=\\\"Screenshot_20230924_150824\\\"\\u003e\\u003cimg src=\\\"https://www.chiefdelphi.com/uploads/default/optimized/3X/0/f/0fa0710ab2ead2415fa12e3542fcfc8cab599c0e_2_690x215.png\\\" alt=\\\"Screenshot_20230924_150824\\\" data-base62-sha1=\\\"2eeUcIrTgG6L629gVqkk0VRAIGy\\\" width=\\\"690\\\" height=\\\"215\\\" srcset=\\\"https://www.chiefdelphi.com/uploads/default/optimized/3X/0/f/0fa0710ab2ead2415fa12e3542fcfc8cab599c0e_2_690x215.png, https://www.chiefdelphi.com/uploads/default/optimized/3X/0/f/0fa0710ab2ead2415fa12e3542fcfc8cab599c0e_2_1035x322.png 1.5x, https://www.chiefdelphi.com/uploads/default/original/3X/0/f/0fa0710ab2ead2415fa12e3542fcfc8cab599c0e.png 2x\\\" data-dominant-color=\\\"EDEDED\\\"\\u003e\\u003cdiv class=\\\"meta\\\"\\u003e\\u003csvg class=\\\"fa d-icon d-icon-far-image svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#far-image\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003cspan class=\\\"filename\\\"\\u003eScreenshot_20230924_150824\\u003c/span\\u003e\\u003cspan class=\\\"informations\\\"\\u003e1177×367 45.7 KB\\u003c/span\\u003e\\u003csvg class=\\\"fa d-icon d-icon-discourse-expand svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#discourse-expand\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003c/div\\u003e\\u003c/a\\u003e\\u003c/div\\u003e\\u003cbr\\u003e\\n\\u003cem\\u003efrom section 7.7 of \\u003ca href=\\\"https://file.tavsys.net/control/controls-engineering-in-frc.pdf\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eControls Engineering in \\u003cspan class=\\\"abbreviation\\\"\\u003eFRC\\u003ctemplate class=\\\"tooltiptext\\\"\\u003eFIRST Robotics Competition\\u003c/template\\u003e\\u003c/span\\u003e\\u003c/a\\u003e\\u003c/em\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003ePassing infinity results in a zero entry in Q, which means the state doesn’t contribute to the sum squared cost (this is a valid thing to be able to do). Passing zero results in an infinity in Q, which is numerically unstable (i.e., not valid).\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"Jelatinone\\\" data-post=\\\"5\\\" data-topic=\\\"441379\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/j/f475e1/48.png\\\" class=\\\"avatar\\\"\\u003e Jelatinone:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eBut now I have a new question, what should the actual value defaults be since they cannot be less than or equal to 0\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eThis explains how to pick the constants:\\u003c/p\\u003e\\u003caside class=\\\"onebox allowlistedgeneric\\\" data-onebox-src=\\\"https://docs.wpilib.org/en/stable/docs/software/advanced-controls/state-space/state-space-intro.html#lqr-tuning\\\"\\u003e\\n  \\u003cheader class=\\\"source\\\"\\u003e\\n      \\u003cimg src=\\\"https://docs.wpilib.org/en/stable/_static/FIRSTicon_RGB_withTM.ico\\\" class=\\\"site-icon\\\" width=\\\"\\\" height=\\\"\\\"\\u003e\\n\\n      \\u003ca href=\\\"https://docs.wpilib.org/en/stable/docs/software/advanced-controls/state-space/state-space-intro.html#lqr-tuning\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eFIRST Robotics Competition Documentation\\u003c/a\\u003e\\n  \\u003c/header\\u003e\\n\\n  \\u003carticle class=\\\"onebox-body\\\"\\u003e\\n    \\u003cimg width=\\\"128\\\" height=\\\"128\\\" src=\\\"https://raw.githubusercontent.com/wpilibsuite/branding/main/png/wpilib-128.png\\\" class=\\\"thumbnail onebox-avatar\\\"\\u003e\\n\\n\\u003ch3\\u003e\\u003ca href=\\\"https://docs.wpilib.org/en/stable/docs/software/advanced-controls/state-space/state-space-intro.html#lqr-tuning\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eIntroduction to State-Space Control\\u003c/a\\u003e\\u003c/h3\\u003e\\n\\n  \\u003cp\\u003eFrom PID to Model-Based Control: When tuning PID controllers, we focus on fiddling with controller parameters relating to the current, past, and future error(P, I and D terms) rather than the under...\\u003c/p\\u003e\\n\\n\\n  \\u003c/article\\u003e\\n\\n  \\u003cdiv class=\\\"onebox-metadata\\\"\\u003e\\n    \\n    \\n  \\u003c/div\\u003e\\n\\n  \\u003cdiv style=\\\"clear: both\\\"\\u003e\\u003c/div\\u003e\\n\\u003c/aside\\u003e\\n\",\"post_number\":7,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-24T22:17:52.258Z\",\"reply_count\":0,\"reply_to_post_number\":5,\"quote_count\":1,\"incoming_link_count\":1,\"reads\":126,\"readers_count\":125,\"score\":45.2,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"Tyler Veness\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://docs.wpilib.org/en/stable/docs/software/advanced-controls/state-space/state-space-intro.html#lqr-tuning\",\"internal\":false,\"reflection\":false,\"title\":\"Introduction to State-Space Control — FIRST Robotics Competition documentation\",\"clicks\":13},{\"url\":\"https://file.tavsys.net/control/controls-engineering-in-frc.pdf\",\"internal\":false,\"reflection\":false,\"clicks\":7},{\"url\":\"https://www.chiefdelphi.com/uploads/default/original/3X/0/f/0fa0710ab2ead2415fa12e3542fcfc8cab599c0e.png\",\"internal\":true,\"reflection\":false,\"clicks\":0}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":16846,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"WPILib controls | Choreo optimizer backend\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/7\",\"custom_user_title\":\"WPILib controls | Choreo optimizer backend\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3234794,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2023-09-25T12:25:55.024Z\",\"cooked\":\"\\u003cp\\u003eIt’ll be easier to tune in the sense that the tuning handles are way more sensible, yeah.  That’s the primary reason to use LQR.\\u003c/p\\u003e\",\"post_number\":8,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-09-25T12:25:55.024Z\",\"reply_count\":0,\"reply_to_post_number\":6,\"quote_count\":0,\"incoming_link_count\":2,\"reads\":96,\"readers_count\":95,\"score\":29.2,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":58184,\"username\":\"Jelatinone\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/8\",\"custom_user_title\":\"Robot apartments! invisible suburbs! skeleton treasuries!\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3244927,\"name\":\"\",\"username\":\"Jelatinone\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\",\"created_at\":\"2023-10-25T03:24:09.963Z\",\"cooked\":\"\\u003cp\\u003eAlso I would like to note that I was using the wrong constants here, I was under the assumption that the Qelms and Relms should be the initial position of the robots, I assumed ‘epsilon’ meant starting position when observing the constructor for an LQR-based Single jointed arm from \\u003ca href=\\\"https://github.com/frc5024/lib5k/blob/master/lib5k/src/main/java/io/github/frc5024/lib5k/control_loops/statespace/wrappers/SingleJointedArmController.java\\\" rel=\\\"noopener nofollow ugc\\\"\\u003elib5k\\u003c/a\\u003e.\\u003c/p\\u003e\",\"post_number\":9,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-10-25T03:24:09.963Z\",\"reply_count\":0,\"reply_to_post_number\":4,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":74,\"readers_count\":73,\"score\":19.8,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://github.com/frc5024/lib5k/blob/master/lib5k/src/main/java/io/github/frc5024/lib5k/control_loops/statespace/wrappers/SingleJointedArmController.java\",\"internal\":false,\"reflection\":false,\"clicks\":1}],\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":16846,\"username\":\"calcmogul\",\"name\":\"Tyler Veness\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/calcmogul/{size}/128045_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":58184,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"World's 'Greatest' Programmer\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/9\",\"custom_user_title\":\"World's 'Greatest' Programmer\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3244997,\"name\":\"Adam Nativ\",\"username\":\"Admlvntv\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/admlvntv/{size}/191412_2.png\",\"created_at\":\"2023-10-25T12:55:30.164Z\",\"cooked\":\"\\u003cp\\u003e\\u003ca class=\\\"mention\\\" href=\\\"/u/jelatinone\\\"\\u003e@Jelatinone\\u003c/a\\u003e do you have a link to your teams code? I’d like to check out something like this\\u003c/p\\u003e\",\"post_number\":10,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-10-25T12:55:30.164Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":62,\"readers_count\":61,\"score\":22.4,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"Adam Nativ\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":51231,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"467 Programming Lead\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/10\",\"custom_user_title\":\"467 Programming Lead\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3245045,\"name\":\"\",\"username\":\"Jelatinone\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\",\"created_at\":\"2023-10-25T14:28:02.010Z\",\"cooked\":\"\\u003cp\\u003eOf course, Here’s the whole \\u003ca href=\\\"https://github.com/FRC5411/System-Main-LQR-Drivebase\\\" rel=\\\"noopener nofollow ugc\\\"\\u003erepository\\u003c/a\\u003e, more specifically \\u003ca href=\\\"https://github.com/FRC5411/System-Main-LQR-Drivebase/blob/main/src/main/java/frc/lib/motion/control/LinearSystemModule.java\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eLinearSystemModule.java\\u003c/a\\u003e contains all of the code to control a swerve module using LinearSystems, but the LQR, Kalman Filter, and Feedback, and LinearSystem itself is all created in the drivebase susbystem folder’s \\u003ca href=\\\"https://github.com/FRC5411/System-Main-LQR-Drivebase/blob/main/src/main/java/frc/robot/subsystems/drivebase/Constants.java\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eConstants.java\\u003c/a\\u003e It was done this way so that I could be as abstracted as possible at the time, but i’ve moved to a new approach with modularly implementing LinearSystem based code using matrices which will soon be on the Rework branch.\\u003c/p\\u003e\\n\\u003cp\\u003eA forewarning though, on the main code i’m trying to fix and issue where the CANCoders on the azimuths dont report the angles, and when we around a perfect 45 degree angle on the azimuths they seem to get stuck switching back and forth when using the integrated encoders on the CANSparkMax.\\u003c/p\\u003e\\n\\u003cp\\u003eGood news is it works in simulation using WPILib’s FlywheelSim Classes:\\u003cbr\\u003e\\n\\u003cimg src=\\\"https://www.chiefdelphi.com/uploads/default/original/3X/3/0/30228d961c633160ed2ced639cf5773745dcab58.gif\\\" alt=\\\"Working LQRgif\\\" data-base62-sha1=\\\"6ROWMRKj7CK7oycIKXQkxoaV7tu\\\" width=\\\"690\\\" height=\\\"388\\\" class=\\\"animated\\\"\\u003e\\u003c/p\\u003e\",\"post_number\":11,\"post_type\":1,\"posts_count\":12,\"updated_at\":\"2023-10-25T15:05:44.733Z\",\"reply_count\":0,\"reply_to_post_number\":10,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":51,\"readers_count\":50,\"score\":15.2,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":5,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://github.com/FRC5411/System-Main-LQR-Drivebase/blob/main/src/main/java/frc/lib/motion/control/LinearSystemModule.java\",\"internal\":false,\"reflection\":false,\"clicks\":4},{\"url\":\"https://github.com/FRC5411/System-Main-LQR-Drivebase\",\"internal\":false,\"reflection\":false,\"title\":\"GitHub - FRC5411/System-Main-LQR-Drivebase: 'Working' implementation of LQR, Linear Quadratic Regulator, based Swerve drivetrain.\",\"clicks\":3},{\"url\":\"https://github.com/FRC5411/System-Main-LQR-Drivebase/blob/main/src/main/java/frc/robot/subsystems/drivebase/Constants.java\",\"internal\":false,\"reflection\":false,\"clicks\":0}],\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":51231,\"username\":\"Admlvntv\",\"name\":\"Adam Nativ\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/admlvntv/{size}/191412_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":58184,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"World's 'Greatest' Programmer\"},\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/11\",\"custom_user_title\":\"World's 'Greatest' Programmer\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true},{\"id\":3438623,\"name\":\"system\",\"username\":\"system\",\"avatar_template\":\"/uploads/default/original/4X/9/3/2/93234578e69f55873c63fc00fe2d0d85f23bce55.png\",\"created_at\":\"2024-10-24T14:28:32.287Z\",\"cooked\":\"\\u003cp\\u003eThis topic was automatically closed 365 days after the last reply. New replies are no longer allowed.\\u003c/p\\u003e\",\"post_number\":12,\"post_type\":3,\"posts_count\":12,\"updated_at\":\"2024-10-24T14:28:32.287Z\",\"reply_count\":0,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":4,\"readers_count\":3,\"score\":0.8,\"yours\":false,\"topic_id\":441379,\"topic_slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"display_username\":\"system\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":true,\"admin\":true,\"staff\":true,\"user_id\":-1,\"hidden\":false,\"trust_level\":4,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"action_code\":\"autoclosed.enabled\",\"post_url\":\"/t/lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided/441379/12\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":true}],\"stream\":[3234659,3234665,3234671,3234698,3234738,3234742,3234743,3234794,3244927,3244997,3245045,3438623]},\"timeline_lookup\":[[1,749],[3,748],[9,718],[11,717],[12,352]],\"suggested_topics\":[{\"fancy_title\":\"Limelights in autonomous?\",\"id\":498718,\"title\":\"Limelights in autonomous?\",\"slug\":\"limelights-in-autonomous\",\"posts_count\":9,\"reply_count\":5,\"highest_post_number\":10,\"image_url\":null,\"created_at\":\"2025-04-10T19:45:29.776Z\",\"last_posted_at\":\"2025-04-10T21:03:47.378Z\",\"bumped\":true,\"bumped_at\":\"2025-04-10T21:03:47.378Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"Hello. I am a coder for team 1350, and we wish to iterate on our code from the 2025 season to use our limelight’s during autonomous mode. Currently we have code for using our 2 cameras (Limelight 4’s)…\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[],\"tags_descriptions\":{},\"like_count\":3,\"views\":406,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3587174,\"topic_post_liked\":false,\"topic_post_like_count\":1,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":true,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":63366,\"username\":\"washington_tea\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/w/87869e/{size}.png\"},\"posters\":[{\"extras\":null,\"description\":\"Original Poster\",\"user\":{\"id\":63366,\"username\":\"washington_tea\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/w/87869e/{size}.png\",\"trust_level\":1}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":3782,\"username\":\"JamesCH95\",\"name\":\"JamesCH95\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jamesch95/{size}/1200_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":62175,\"username\":\"sdas\",\"name\":\"Sreyan Das\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/sdas/{size}/267974_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":24594,\"username\":\"SLAB-Mr.Thomas\",\"name\":\"SLAB-Mr.Thomas\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/slab-mr.thomas/{size}/182153_2.png\",\"trust_level\":2}},{\"extras\":\"latest\",\"description\":\"Most Recent Poster\",\"user\":{\"id\":55818,\"username\":\"Crafter\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/c/77aa72/{size}.png\",\"trust_level\":2}}]},{\"fancy_title\":\"Rev through bore \\u0026amp; CANdi reporting bad values\",\"id\":492306,\"title\":\"Rev through bore \\u0026 CANdi reporting bad values\",\"slug\":\"rev-through-bore-candi-reporting-bad-values\",\"posts_count\":14,\"reply_count\":9,\"highest_post_number\":14,\"image_url\":null,\"created_at\":\"2025-02-19T14:53:59.367Z\",\"last_posted_at\":\"2025-02-21T04:16:26.490Z\",\"bumped\":true,\"bumped_at\":\"2025-02-21T04:16:26.490Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"We currently have a rev through bore encoder which is wired into a Candi. The Candi is then set as a remote encoder source for our pivot motor. Sometimes when we turn on the robot the value reports 1+…\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[\"ctre\",\"rev\"],\"tags_descriptions\":{},\"like_count\":1,\"views\":332,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3532803,\"topic_post_liked\":false,\"topic_post_like_count\":1,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":false,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":57204,\"username\":\"Prince\",\"name\":\"Prince\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/p/ba9def/{size}.png\"},\"posters\":[{\"extras\":null,\"description\":\"Original Poster\",\"user\":{\"id\":57204,\"username\":\"Prince\",\"name\":\"Prince\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/p/ba9def/{size}.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":44380,\"username\":\"gdefender\",\"name\":\"Andy Gasser\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/gdefender/{size}/168507_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":48146,\"username\":\"bhall-ctre\",\"name\":\"Benjamin Hall\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/bhall-ctre/{size}/198180_2.png\",\"primary_group_name\":\"CTRE\",\"flair_name\":\"CTRE\",\"flair_url\":\"/uploads/default/original/3X/1/b/1bd2b430e1bb6427d1c6504ff6abcd31de851a6d.png\",\"flair_group_id\":57,\"trust_level\":2}},{\"extras\":\"latest\",\"description\":\"Most Recent Poster\",\"user\":{\"id\":51814,\"username\":\"mpulte\",\"name\":\"Marc Pulte\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/m/8c91f0/{size}.png\",\"trust_level\":1}}]},{\"fancy_title\":\"Swerve wheels oscillating (YAGSL 2025 issue)\",\"id\":492930,\"title\":\"Swerve wheels oscillating (YAGSL 2025 issue)\",\"slug\":\"swerve-wheels-oscillating-yagsl-2025-issue\",\"posts_count\":12,\"reply_count\":6,\"highest_post_number\":12,\"image_url\":null,\"created_at\":\"2025-02-24T12:43:19.322Z\",\"last_posted_at\":\"2025-02-26T15:52:43.667Z\",\"bumped\":true,\"bumped_at\":\"2025-02-26T15:52:43.667Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"We are using the MK4i modules, L3 gearing, NEO motors on SparkMAXes for both drive and turn, and Thrifty absolute encoders. We are programming with YAGSL 2025. We got a swerve drive working in the f…\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[],\"tags_descriptions\":{},\"like_count\":11,\"views\":290,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3537827,\"topic_post_liked\":false,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":false,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":5678,\"username\":\"Taylor\",\"name\":\"Mike Taylor (he/him)\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/taylor/{size}/232955_2.png\"},\"posters\":[{\"extras\":null,\"description\":\"Original Poster\",\"user\":{\"id\":5678,\"username\":\"Taylor\",\"name\":\"Mike Taylor (he/him)\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/taylor/{size}/232955_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":29982,\"username\":\"UnofficialForth\",\"name\":\"UnofficialForth\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/unofficialforth/{size}/167902_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":51887,\"username\":\"nstrike\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/nstrike/{size}/167038_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":32089,\"username\":\"BlueEpiphone\",\"name\":\"Curt Rozeboom\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/blueepiphone/{size}/197122_2.png\",\"trust_level\":2}},{\"extras\":\"latest\",\"description\":\"Most Recent Poster\",\"user\":{\"id\":73827,\"username\":\"kcwang\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/k/edb3f5/{size}.png\",\"trust_level\":1}}]},{\"fancy_title\":\"Swerve Problem\",\"id\":481732,\"title\":\"Swerve Problem\",\"slug\":\"swerve-problem\",\"posts_count\":2,\"reply_count\":0,\"highest_post_number\":2,\"image_url\":null,\"created_at\":\"2025-01-14T21:13:08.144Z\",\"last_posted_at\":\"2025-01-14T22:28:38.678Z\",\"bumped\":true,\"bumped_at\":\"2025-01-14T22:28:38.678Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"Hello guys, I have two problems with the swerve, one of them is related to when we accelerate very quickly the front of the robot moves even when facing the arena, we place our pigeon on top of the pd…\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[\"swerve\"],\"tags_descriptions\":{},\"like_count\":0,\"views\":85,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3482544,\"topic_post_liked\":false,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":false,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":69880,\"username\":\"henriquedsn\",\"name\":\"Henrique de Sousa Neves\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/h/4af34b/{size}.png\"},\"posters\":[{\"extras\":null,\"description\":\"Original Poster\",\"user\":{\"id\":69880,\"username\":\"henriquedsn\",\"name\":\"Henrique de Sousa Neves\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/h/4af34b/{size}.png\",\"trust_level\":2}},{\"extras\":\"latest\",\"description\":\"Most Recent Poster\",\"user\":{\"id\":33353,\"username\":\"dasevo\",\"name\":\"dasevo\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/d/898d66/{size}.png\",\"trust_level\":2}}]},{\"fancy_title\":\"Upgrade your Tank Drive\",\"id\":501736,\"title\":\"Upgrade your Tank Drive\",\"slug\":\"upgrade-your-tank-drive\",\"posts_count\":9,\"reply_count\":5,\"highest_post_number\":10,\"image_url\":null,\"created_at\":\"2025-05-14T20:07:37.720Z\",\"last_posted_at\":\"2025-05-15T14:28:01.346Z\",\"bumped\":true,\"bumped_at\":\"2025-05-15T14:28:01.346Z\",\"archetype\":\"regular\",\"unseen\":false,\"pinned\":false,\"unpinned\":null,\"excerpt\":\"just found this code i wrote couple years ago that makes a tank drivetrain sort of behave like a swerve drive. basically instead of controlling the tank’s rotation manually, you just point the joysti…\",\"visible\":true,\"closed\":false,\"archived\":false,\"bookmarked\":null,\"liked\":null,\"tags\":[\"software\",\"tank\",\"tankdrive\"],\"tags_descriptions\":{},\"like_count\":22,\"views\":804,\"category_id\":30,\"featured_link\":null,\"has_accepted_answer\":false,\"sidecar_installed\":true,\"include_dominant_colour\":false,\"topic_post_id\":3624658,\"topic_post_liked\":false,\"topic_post_like_count\":18,\"topic_post_can_like\":false,\"topic_post_can_unlike\":false,\"topic_post_bookmarked\":true,\"topic_post_is_current_users\":null,\"topic_post_number\":1,\"topic_post_user\":{\"id\":50638,\"username\":\"TapChap\",\"name\":\"Shai\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/tapchap/{size}/222492_2.png\"},\"posters\":[{\"extras\":\"latest\",\"description\":\"Original Poster, Most Recent Poster\",\"user\":{\"id\":50638,\"username\":\"TapChap\",\"name\":\"Shai\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/tapchap/{size}/222492_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":63359,\"username\":\"predobrega\",\"name\":\"Pedro Braga\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/predobrega/{size}/211207_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":68890,\"username\":\"Mako\",\"name\":\"M\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mako/{size}/270886_2.png\",\"trust_level\":3}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":73488,\"username\":\"Zakk_J\",\"name\":\"Zakk Jackson\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/zakk_j/{size}/268534_2.png\",\"trust_level\":2}},{\"extras\":null,\"description\":\"Frequent Poster\",\"user\":{\"id\":68826,\"username\":\"0_gottogo_0\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/0_gottogo_0/{size}/235858_2.png\",\"trust_level\":2}}]}],\"tags\":[\"help\",\"controls\",\"swervemodule\",\"error\"],\"tags_descriptions\":{},\"fancy_title\":\"LQR-based Swerve Module; Ambiguous Error, No Stacktrace Provided\",\"id\":441379,\"title\":\"LQR-based Swerve Module; Ambiguous Error, No Stacktrace Provided\",\"posts_count\":12,\"created_at\":\"2023-09-24T11:12:00.024Z\",\"views\":1225,\"reply_count\":7,\"like_count\":3,\"last_posted_at\":\"2024-10-24T14:28:32.287Z\",\"visible\":true,\"closed\":true,\"archived\":false,\"has_summary\":false,\"archetype\":\"regular\",\"slug\":\"lqr-based-swerve-module-ambiguous-error-no-stacktrace-provided\",\"category_id\":30,\"word_count\":2626,\"deleted_at\":null,\"user_id\":58184,\"featured_link\":null,\"pinned_globally\":false,\"pinned_at\":null,\"pinned_until\":null,\"image_url\":null,\"slow_mode_seconds\":0,\"draft\":null,\"draft_key\":\"topic_441379\",\"draft_sequence\":null,\"unpinned\":null,\"pinned\":false,\"current_post_number\":1,\"highest_post_number\":12,\"deleted_by\":null,\"actions_summary\":[{\"id\":4,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":8,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":10,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":7,\"count\":0,\"hidden\":false,\"can_act\":false}],\"chunk_size\":20,\"bookmarked\":false,\"topic_timer\":null,\"message_bus_last_id\":0,\"participant_count\":5,\"show_read_indicator\":false,\"thumbnails\":null,\"slow_mode_enabled_until\":null,\"valid_reactions\":[\"heart\",\"laughing\",\"point_up\",\"+1\",\"-1\",\"100\",\"open_mouth\",\"cry\",\"question\",\"thinking\",\"call_me_hand\",\"hugs\",\"angry\"],\"accepted_answer\":{\"post_number\":4,\"username\":\"calcmogul\",\"name\":null,\"excerpt\":\"You should be passing positive constants to the VecBuilder.fill() calls. The encoder getters can return negative values, which would throw the second exception you saw. \\nThe first one is from Q not being symmetric. It should be symmetric by construction though with the LQR overload you used. \\nBy th\\u0026hellip;\",\"accepter_name\":null},\"user_chosen_thumbnail_url\":null,\"sidecar_installed\":true,\"can_vote\":false,\"vote_count\":0,\"user_voted\":false,\"discourse_zendesk_plugin_zendesk_id\":null,\"discourse_zendesk_plugin_zendesk_url\":\"https://your-url.zendesk.com/agent/tickets/\",\"details\":{\"can_edit\":false,\"notification_level\":1,\"participants\":[{\"id\":58184,\"username\":\"Jelatinone\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\",\"post_count\":5,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":1},{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":16846,\"username\":\"calcmogul\",\"name\":\"Tyler Veness\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/calcmogul/{size}/128045_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":51231,\"username\":\"Admlvntv\",\"name\":\"Adam Nativ\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/admlvntv/{size}/191412_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":51413,\"username\":\"yotam201410\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/y/f9ae1b/{size}.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2}],\"created_by\":{\"id\":58184,\"username\":\"Jelatinone\",\"name\":\"\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/j/f475e1/{size}.png\"},\"last_poster\":{\"id\":-1,\"username\":\"system\",\"name\":\"system\",\"avatar_template\":\"/uploads/default/original/4X/9/3/2/93234578e69f55873c63fc00fe2d0d85f23bce55.png\"},\"links\":[{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/controller/LinearQuadraticRegulator.html\",\"title\":\"LinearQuadraticRegulator (WPILib API 2023.4.3)\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":48,\"user_id\":58184,\"domain\":\"github.wpilib.org\",\"root_domain\":\"wpilib.org\"},{\"url\":\"https://docs.wpilib.org/en/stable/docs/software/advanced-controls/state-space/state-space-intro.html#lqr-tuning\",\"title\":\"Introduction to State-Space Control — FIRST Robotics Competition documentation\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":13,\"user_id\":16846,\"domain\":\"docs.wpilib.org\",\"root_domain\":\"wpilib.org\"},{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/system/LinearSystemLoop.html\",\"title\":\"LinearSystemLoop (WPILib API 2023.4.3)\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":8,\"user_id\":58184,\"domain\":\"github.wpilib.org\",\"root_domain\":\"wpilib.org\"},{\"url\":\"https://file.tavsys.net/control/controls-engineering-in-frc.pdf\",\"title\":null,\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":7,\"user_id\":16846,\"domain\":\"file.tavsys.net\",\"root_domain\":\"tavsys.net\"},{\"url\":\"https://github.com/FRC5411/System-Main-LQR-Drivebase/blob/main/src/main/java/frc/lib/motion/control/LinearSystemModule.java\",\"title\":null,\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":4,\"user_id\":58184,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/controller/PIDController.html\",\"title\":\"PIDController (WPILib API 2023.4.3)\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":4,\"user_id\":58184,\"domain\":\"github.wpilib.org\",\"root_domain\":\"wpilib.org\"},{\"url\":\"https://github.com/FRC5411/System-Main-LQR-Drivebase\",\"title\":\"GitHub - FRC5411/System-Main-LQR-Drivebase: 'Working' implementation of LQR, Linear Quadratic Regulator, based Swerve drivetrain.\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":3,\"user_id\":58184,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://www.chiefdelphi.com/t/usefulness-of-model-predictive-control-for-frc/442330\",\"title\":\"Usefulness of Model Predictive Control for FRC\",\"internal\":true,\"attachment\":false,\"reflection\":true,\"clicks\":1,\"user_id\":58184,\"domain\":\"www.chiefdelphi.com\",\"root_domain\":\"chiefdelphi.com\"},{\"url\":\"https://github.com/frc5024/lib5k/blob/master/lib5k/src/main/java/io/github/frc5024/lib5k/control_loops/statespace/wrappers/SingleJointedArmController.java\",\"title\":null,\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":1,\"user_id\":58184,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://github.com/wpilibsuite/allwpilib/blob/main/wpimath/src/main/native/include/frc/DARE.h#L45-L94\",\"title\":null,\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":1,\"user_id\":16846,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://github.com/wpilibsuite/allwpilib/issues/5339\",\"title\":\"Discretization.discretizeAQTaylor() is inaccurate · Issue #5339 · wpilibsuite/allwpilib · GitHub\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":1,\"user_id\":58184,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://github.wpilib.org/allwpilib/docs/release/cpp/namespacedrake.html#a3cd8151cc95b5b95de9a9b882e27ed84\",\"title\":\"WPILibC++: drake Namespace Reference\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":1,\"user_id\":58184,\"domain\":\"github.wpilib.org\",\"root_domain\":\"wpilib.org\"}]},\"bookmarks\":[]}"}
