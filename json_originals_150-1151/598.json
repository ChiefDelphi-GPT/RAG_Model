{"data":"{\"post_stream\":{\"posts\":[{\"id\":3605444,\"name\":\"Sam Carlberg\",\"username\":\"SamCarlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"created_at\":\"2025-04-28T01:12:38.640Z\",\"cooked\":\"\\u003cp\\u003e\\u003cem\\u003eHeads up: this is coming for 2027, since it requires \\u003cspan class=\\\"abbreviation\\\"\\u003eJVM\\u003ctemplate class=\\\"tooltiptext\\\" data-text=\\\"Java Virtual Machine\\\"\\u003e\\u003c/template\\u003e\\u003c/span\\u003e features unavailable for the roboRIO.\\u003c/em\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eIt’s still a work in progress, but the API is mostly solidified at this point. Comments and feedback are welcome, either here or on the pull request!\\u003c/p\\u003e\\n\\u003chr\\u003e\\n\\u003caside class=\\\"onebox githubpullrequest\\\" data-onebox-src=\\\"https://github.com/wpilibsuite/allwpilib/pull/6518\\\"\\u003e\\n  \\u003cheader class=\\\"source\\\"\\u003e\\n\\n      \\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/pull/6518\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003egithub.com/wpilibsuite/allwpilib\\u003c/a\\u003e\\n  \\u003c/header\\u003e\\n\\n  \\u003carticle class=\\\"onebox-body\\\"\\u003e\\n    \\u003cdiv class=\\\"github-row\\\" data-github-private-repo=\\\"false\\\"\\u003e\\n\\n\\n\\n    \\u003cdiv class=\\\"github-icon-container\\\" title=\\\"Pull Request\\\"\\u003e\\n      \\u003csvg width=\\\"60\\\" height=\\\"60\\\" class=\\\"github-icon\\\" viewBox=\\\"0 0 12 16\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cpath fill-rule=\\\"evenodd\\\" d=\\\"M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z\\\"\\u003e\\u003c/path\\u003e\\u003c/svg\\u003e\\n    \\u003c/div\\u003e\\n\\n  \\u003cdiv class=\\\"github-info-container\\\"\\u003e\\n\\n\\n\\n      \\u003ch4\\u003e\\n        \\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/pull/6518\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003e[DRAFT] Commands v3 framework\\u003c/a\\u003e\\n      \\u003c/h4\\u003e\\n\\n    \\u003cdiv class=\\\"branches\\\"\\u003e\\n      \\u003ccode\\u003ewpilibsuite:2027\\u003c/code\\u003e ← \\u003ccode\\u003eSamCarlberg:better-async-commands\\u003c/code\\u003e\\n    \\u003c/div\\u003e\\n\\n      \\u003cdiv class=\\\"github-info\\\"\\u003e\\n        \\u003cdiv class=\\\"date\\\"\\u003e\\n          opened \\u003cspan class=\\\"discourse-local-date\\\" data-format=\\\"ll\\\" data-date=\\\"2024-04-17\\\" data-time=\\\"00:41:10\\\" data-timezone=\\\"UTC\\\"\\u003e12:41AM - 17 Apr 24 UTC\\u003c/span\\u003e\\n        \\u003c/div\\u003e\\n\\n        \\u003cdiv class=\\\"user\\\"\\u003e\\n          \\u003ca href=\\\"https://github.com/SamCarlberg\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003e\\n            \\u003cimg alt=\\\"SamCarlberg\\\" src=\\\"https://avatars.githubusercontent.com/u/6320992?v=4\\\" class=\\\"onebox-avatar-inline\\\" width=\\\"20\\\" height=\\\"20\\\"\\u003e\\n            SamCarlberg\\n          \\u003c/a\\u003e\\n        \\u003c/div\\u003e\\n\\n        \\u003cdiv class=\\\"lines\\\" title=\\\"18 commits changed 62 files with 8986 additions and 7 deletions\\\"\\u003e\\n          \\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/pull/6518/files\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003e\\n            \\u003cspan class=\\\"added\\\"\\u003e+8986\\u003c/span\\u003e\\n            \\u003cspan class=\\\"removed\\\"\\u003e-7\\u003c/span\\u003e\\n          \\u003c/a\\u003e\\n        \\u003c/div\\u003e\\n      \\u003c/div\\u003e\\n  \\u003c/div\\u003e\\n\\u003c/div\\u003e\\n\\n  \\u003cdiv class=\\\"github-row\\\"\\u003e\\n    \\u003cp class=\\\"github-body-container\\\"\\u003eThe framework fundamentally relies on the continuation API added in Java 21 (whi\\u003cspan class=\\\"show-more-container\\\"\\u003e\\u003ca href=\\\"https://github.com/wpilibsuite/allwpilib/pull/6518\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\" class=\\\"show-more\\\"\\u003e…\\u003c/a\\u003e\\u003c/span\\u003e\\u003cspan class=\\\"excerpt hidden\\\"\\u003ech is currently internal to the JDK). Continuations allow for call stacks to be saved to the heap and resumed later.  **This cannot run on the roborio due to continuations not being implemented for 32-bit ARM platforms in OpenJDK.** The 2027 MRC will use a CPU with a 64-bit ARM architecture, which is supported by continuations.\\n\\nThe async framework allows command bodies to be written in an imperative style:\\n\\n```java\\nRequireableResource drivetrain = new Drivetrain();\\n\\nCommand driveTenFeet =\\n  drivetrain.run(coroutine -\\u0026gt; {\\n    drivetrain.resetEncoders();\\n    while (drivetrain.getDistance() \\u0026lt; 10) {\\n      coroutine.yield(); // \\u0026lt;- note the yield call!\\n      drivetrain.tankDrive(1, 1);\\n    }\\n    drivetrain.stop();\\n  }).named(\\\"Drive Ten Feet\\\");\\n```\\n\\nWhich would look something like this using the current functional framework:\\n\\n```java\\nSubsystem drivetrain = new Drivetrain();\\n\\nComand driveTenFeet =\\n  drivetrain.runOnce(drivetrain::resetEncoders)\\n    .andThen(driveTrain.run(() -\\u0026gt; drivetrain.tankDrive(1, 1))\\n    .until(() -\\u0026gt; drivetrain.getDistance() \\u0026lt; 10)\\n    .finallyDo(drivetrain::stop)\\n    .withName(\\\"Drive Ten Feet\\\");\\n```\\n\\nCommands could be written as thin wrappers around regular imperative methods:\\n\\n```java\\nclass Drivetrain extends HardwareResource {\\n  void driveDistance(Coroutine coroutine, Distance distance) {\\n    encoders.reset();\\n    while (getDistance().lt(distance)) {\\n      coroutine.yield();\\n      tankDrive(1, 1);\\n    }\\n    stop();\\n  }\\n\\n  Command driveDistanceCommand(Distance distance) {\\n    return run(coroutine -\\u0026gt; driveDistance(coroutine, distance)).named(\\\"Drive \\\" + distance.toLongString());\\n  }\\n}\\n```\\n\\nHowever, an async command *will* need to be *actively* cooperative and periodically call `coroutine.yield()` in loops to yield control back to the command scheduler to let it process other commands.\\n\\nThere are also some other additions like priority levels (as opposed to a blanket yes/no for ignoring incoming commands), factories requiring names be provided for commands, and the scheduler tracking all running commands and not just the highest-level groups. However, those changes aren't unique to an async framework, and could just as easily be used in a traditional command framework.\\n\\nLinks:\\n[JEP 425 - Virtual Threads](https://openjdk.org/jeps/425)\\n[JEP 453 - Structured Concurrency](https://openjdk.org/jeps/453)\\n[The async version of the rapid react example project](https://github.com/SamCarlberg/allwpilib/tree/better-async-commands/wpilibjExamples/src/main/java/edu/wpi/first/wpilibj/examples/coroutines)\\n[Scheduler.java](https://github.com/SamCarlberg/allwpilib/blob/better-async-commands/commandsv3/src/main/java/edu/wpi/first/wpilibj/commandsv3/Scheduler.java)\\n[ParallelGroup.java](https://github.com/SamCarlberg/allwpilib/blob/better-async-commands/commandsv3/src/main/java/edu/wpi/first/wpilibj/commandsv3/ParallelGroup.java)\\n[Sequence.java](https://github.com/SamCarlberg/allwpilib/blob/better-async-commands/commandsv3/src/main/java/edu/wpi/first/wpilibj/commandsv3/Sequence.java)\\u003c/span\\u003e\\u003c/p\\u003e\\n  \\u003c/div\\u003e\\n\\n  \\u003c/article\\u003e\\n\\n  \\u003cdiv class=\\\"onebox-metadata\\\"\\u003e\\n    \\n    \\n  \\u003c/div\\u003e\\n\\n  \\u003cdiv style=\\\"clear: both\\\"\\u003e\\u003c/div\\u003e\\n\\u003c/aside\\u003e\\n\\n\\u003cp\\u003e\\u003ca href=\\\"https://github.com/samcarlberg/allwpilib/blob/better-async-commands/design-docs/commands-v3.md\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eDetailed design document \\u0026amp; specification\\u003c/a\\u003e\\u003c/p\\u003e\\n\\u003ch2\\u003e\\u003ca name=\\\"p-3605444-coroutines-and-asyncawait-1\\\" class=\\\"anchor\\\" href=\\\"#p-3605444-coroutines-and-asyncawait-1\\\"\\u003e\\u003c/a\\u003eCoroutines and async/await\\u003c/h2\\u003e\\n\\u003cp\\u003eJava 21 added virtual threads, which is a feature that fundamentally relies on \\u003cspan class=\\\"abbreviation\\\"\\u003eJVM\\u003ctemplate class=\\\"tooltiptext\\\" data-text=\\\"Java Virtual Machine\\\"\\u003e\\u003c/template\\u003e\\u003c/span\\u003e functionality that allows for call stacks to be paused, unmounted, and remounted. We can use that functionality ourselves - without needing all the virtual thread stuff - and use it to implement coroutines and async/await functionality for a command based framework.\\u003c/p\\u003e\\n\\u003cp\\u003eBasically, it allows for commands to written \\u003cem\\u003ealmost\\u003c/em\\u003e like a normal function - standard Java control flow like \\u003ccode\\u003eif\\u003c/code\\u003e statements and \\u003ccode\\u003ewhile\\u003c/code\\u003e loops are possible \\u003cem\\u003eand\\u003c/em\\u003e encouraged.\\u003c/p\\u003e\\n\\u003cp\\u003eFor example, a simple command in v2 that sets a motor until some setpoint target is reached, then turns off the motor would look like this:\\u003c/p\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003e// V2\\npublic Command example() {\\n  return run(() -\\u0026gt; motor.setVoltage(12))\\n    .until(this::atTarget)\\n    .finallyDo((interrupted) -\\u0026gt; {\\n      if (!interrupted) {\\n        motor.setVoltage(0);\\n      }\\n    })\\n    .withName(\\\"Example\\\");\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eWhich needs knowledge of how command functions are handled (init, execute, end condition, completion/cleanup) and the DSL methods to do so.\\u003c/p\\u003e\\n\\u003cp\\u003eIn v3, the same command would just use a normal \\u003ccode\\u003ewhile\\u003c/code\\u003e loop with a coroutine to manage pausing and resuming - it must be cooperative multitasking - but otherwise is just normal Java code.\\u003c/p\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003e// V3\\npublic Command example() {\\n  return run(coroutine -\\u0026gt; {\\n    while (!atTarget()) {\\n      motor.setVoltage(12);\\n      coroutine.yield(); // \\u0026lt;-- This line is very important!\\n    }\\n    motor.setVoltage(0);\\n  }).named(\\\"Example\\\");\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003ch2\\u003e\\u003ca name=\\\"p-3605444-examples-2\\\" class=\\\"anchor\\\" href=\\\"#p-3605444-examples-2\\\"\\u003e\\u003c/a\\u003eExamples\\u003c/h2\\u003e\\n\\u003ch3\\u003e\\u003ca name=\\\"p-3605444-swerve-driving-3\\\" class=\\\"anchor\\\" href=\\\"#p-3605444-swerve-driving-3\\\"\\u003e\\u003c/a\\u003eSwerve Driving\\u003c/h3\\u003e\\n\\u003cp\\u003eThis is fairly similar between both frameworks because all the logic is in a periodic function. The only change is that V3 moves the logic to an explicit \\u003ccode\\u003ewhile\\u003c/code\\u003e loop with a yield call, while V2 relies on the scheduler running its body once per robot loop.\\u003c/p\\u003e\\n\\u003cdetails\\u003e\\n\\u003csummary\\u003e\\nV2\\u003c/summary\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003e// V2\\npublic Command driveWithJoysticks(Supplier\\u0026lt;LinearVelocity\\u0026gt; x, Supplier\\u0026lt;LinearVelocity\\u0026gt; y, Supplier\\u0026lt;AngularVelocity\\u0026gt; omega) {\\n  return run(() -\\u0026gt; {\\n    var speeds = ChassisSpeeds.fromFieldRelativeSpeeds(x.get(), y.get(), omega.get(), io.getHeading());\\n    var states = DriveConstants.driveKinematics.toSwerveModuleStates(speeds);\\n    io.setDesiredModuleStates(states);\\n  }).withName(\\\"Drive With Joysticks\\\");\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/details\\u003e\\n\\u003cdetails\\u003e\\n\\u003csummary\\u003e\\nV3\\u003c/summary\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003epublic Command driveWithJoysticks(Supplier\\u0026lt;LinearVelocity\\u0026gt; x, Supplier\\u0026lt;LinearVelocity\\u0026gt; y, Supplier\\u0026lt;AngularVelocity\\u0026gt; omega) {\\n  return run(coroutine -\\u0026gt; {\\n    while (true) {\\n      var speeds = ChassisSpeeds.fromFieldRelativeSpeeds(x.get(), y.get(), omega.get(), io.getHeading());\\n      var states = DriveConstants.driveKinematics.toSwerveModuleStates(speeds);\\n      io.setDesiredModuleStates(states);\\n      coroutine.yield();\\n    }\\n  }).named(\\\"Drive With Joysticks\\\");\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/details\\u003e\\n\\u003ch3\\u003e\\u003ca name=\\\"p-3605444-reef-scoring-4\\\" class=\\\"anchor\\\" href=\\\"#p-3605444-reef-scoring-4\\\"\\u003e\\u003c/a\\u003eReef Scoring\\u003c/h3\\u003e\\n\\u003cp\\u003eMoving an elevator to a specific reef level, then scoring a piece of coral. Note how v2 needs to make use of multiple proxies in an awkward parallel group at the start of the command, while v3 can just use the coroutine to fork them in a single function body. This is because the v3 scheduler keeps track of every running command, instead of having parallel and sequential groups manage their commands internally, allowing the scheduler to prevent inner commands from interrupting their parents.\\u003c/p\\u003e\\n\\u003cdetails\\u003e\\n\\u003csummary\\u003e\\nV2\\u003c/summary\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003epublic Command score(ReefLevel level) {\\n  return sequence(\\n      parallel(\\n          coral.stow().asProxy(),\\n          elevator.moveToAndHold(level).asProxy()\\n      ),\\n      waitUntil(elevator::atTargetHeight),\\n      coral.scoreAtLevel(level).asProxy()\\n  ).withName(\\\"Score \\\" + level.name());\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/details\\u003e\\n\\u003cdetails\\u003e\\n\\u003csummary\\u003e\\nV3\\u003c/summary\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003epublic Command score(ReefLevel level) {\\n  return Command.noRequirements(coroutine -\\u0026gt; {\\n    coroutine.fork(coral.stow());\\n    coroutine.fork(elevator.moveToAndHold(level));\\n\\n    while (!elevator.atTargetHeight()) {\\n      coroutine.yield();\\n    }\\n\\n    coroutine.await(coral.scoreAt(level));\\n  }).named(\\\"Score \\\" + level.name());\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/details\\u003e\",\"post_number\":1,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T01:12:38.640Z\",\"reply_count\":3,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":244,\"reads\":899,\"readers_count\":898,\"score\":2234.8,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Sam Carlberg\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://github.com/wpilibsuite/allwpilib/pull/6518\",\"internal\":false,\"reflection\":false,\"title\":\"[DRAFT] Commands v3 framework by SamCarlberg · Pull Request #6518 · wpilibsuite/allwpilib · GitHub\",\"clicks\":93},{\"url\":\"https://github.com/samcarlberg/allwpilib/blob/better-async-commands/design-docs/commands-v3.md\",\"internal\":false,\"reflection\":false,\"title\":\"allwpilib/design-docs/commands-v3.md at better-async-commands · SamCarlberg/allwpilib · GitHub\",\"clicks\":38}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":55}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":25916,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"2084 Lead Mentor | WPILib Developer\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/1\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":55},{\"id\":\"thinking\",\"type\":\"emoji\",\"count\":2}],\"current_user_reaction\":null,\"reaction_users_count\":57,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605762,\"name\":\"sam liu\",\"username\":\"catrix\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/c/dbc845/{size}.png\",\"created_at\":\"2025-04-28T10:37:34.617Z\",\"cooked\":\"\\u003cp\\u003eI want to start by saying that I deeply appreciate all the efforts the WPILib contributors have put into the 2027 WPILib updates. \\u003cimg src=\\\"https://www.chiefdelphi.com/images/emoji/google/hugs.png?v=12\\\" title=\\\":hugs:\\\" class=\\\"emoji\\\" alt=\\\":hugs:\\\" loading=\\\"lazy\\\" width=\\\"20\\\" height=\\\"20\\\"\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eBut I have to be honest: I’m not a fan of this new coroutine system.\\u003c/p\\u003e\\n\\u003cp\\u003eThe biggest issue is the forced call of \\u003ccode\\u003ecoroutine.yield()\\u003c/code\\u003e in every loop. It feels wrong to require adding something to my code \\u003cstrong\\u003ethat has no actual meaning\\u003c/strong\\u003e in terms of the command’s logic. What’s even worse is that \\u003cstrong\\u003eif I somehow forget to add this single line, MY ROBOT WILL EXPLODE\\u003c/strong\\u003e. And I get absolutely zero warning or error about it during compile or deploy.\\u003c/p\\u003e\\n\\u003cp\\u003eIt’s also very hard to explain \\u003ccode\\u003ecoroutine.fork()\\u003c/code\\u003e and \\u003ccode\\u003ecoroutine.yield()\\u003c/code\\u003e to a junior programmer without giving them a big lecture about signals and threading. The new API forces students to always add something that they don’t truly understand to their code, and missing it leads to catastrophic consequences.\\u003c/p\\u003e\\n\\u003cp\\u003eAnd frankly, I don’t see the upside.\\u003c/p\\u003e\\n\\u003cp\\u003eYou said that the V2 Commands library requires students to understand\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"SamCarlberg\\\" data-post=\\\"1\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/samcarlberg/48/207684_2.png\\\" class=\\\"avatar\\\"\\u003e SamCarlberg:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003ehow command functions are handled\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003e, but those concepts are simple; I can teach them to new team members in 5 minutes.\\u003c/p\\u003e\\n\\u003cp\\u003eAnd composing command logic in CommandsV2 can be elegant and clean.\\u003c/p\\u003e\\n\\u003cp\\u003eThe scoring command that you’ve mentioned can be written as:\\u003c/p\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003epublic Command score(ReefLevel level) {\\n  return elevator.moveToAndHold(level)\\n      .until(elevator::atTargetHeight)\\n      .deadlineFor(coral.stow())\\n      .andThen(coral.scoreAtLevel(level))\\n      .withName(\\\"Score \\\" + level.name());\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eSuch code just looks so beautiful and reads like natural language.\\u003c/p\\u003e\\n\\u003cp\\u003eIf the advantage of the new API is simply allowing the use of native \\u003ccode\\u003eif\\u003c/code\\u003e and \\u003ccode\\u003ewhile\\u003c/code\\u003e inside commands, it feels like not worth its price.\\u003c/p\\u003e\",\"post_number\":2,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T10:37:34.617Z\",\"reply_count\":4,\"reply_to_post_number\":null,\"quote_count\":1,\"incoming_link_count\":13,\"reads\":749,\"readers_count\":748,\"score\":1194.8,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"sam liu\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":62}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":60033,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"CE Student @ UWaterloo | 5516 Alum \"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/2\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":55},{\"id\":\"100\",\"type\":\"emoji\",\"count\":7}],\"current_user_reaction\":null,\"reaction_users_count\":62,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605811,\"name\":\"Sam Carlberg\",\"username\":\"SamCarlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"created_at\":\"2025-04-28T11:30:22.518Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"catrix\\\" data-post=\\\"2\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/c/dbc845/48.png\\\" class=\\\"avatar\\\"\\u003e catrix:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eWhat’s even worse is that \\u003cstrong\\u003eif I somehow forget to add this single line, MY ROBOT WILL EXPLODE\\u003c/strong\\u003e. And I get absolutely zero warning or error about it during compile or deploy.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eYep. That’s the glaring footgun with the coroutine-first approach; there’s no way to check at compile time so it’s up to the programmer to be aware of it. A watchdog will be necessary to detect misbehaving commands and throw an exception if one is taking too much time before yielding (continuations aren’t threadsafe, so I don’t think it’s possible to do something like forcibly unmounting a running command from a different thread, though future Java updates might change that).\\u003c/p\\u003e\\n\\u003cp\\u003eMaybe it’s useful if you consider \\u003ccode\\u003ecoroutine.yield()\\u003c/code\\u003e to be analogous to \\u003ccode\\u003eThread.sleep(20)\\u003c/code\\u003e\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"catrix\\\" data-post=\\\"2\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/c/dbc845/48.png\\\" class=\\\"avatar\\\"\\u003e catrix:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eThe scoring command that you’ve mentioned can be written as:\\u003c/p\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003epublic Command score(ReefLevel level) {\\n  return elevator.moveToAndHold(level)\\n      .until(elevator::atTargetHeight)\\n      .deadlineFor(coral.stow())\\n      .andThen(coral.scoreAtLevel(level))\\n      .withName(\\\"Score \\\" + level.name());\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eNot quite - the elevator is uncommanded during the coral scoring command at the end. If you use onboard motor control, then the elevator could sag (you’d have to use something like \\u003ccode\\u003ecoral.scoreAtLevel(level).deadlineFor(elevator.holdLastKnownSetpoint())\\u003c/code\\u003e, which isn’t obvious).\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"catrix\\\" data-post=\\\"2\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/c/dbc845/48.png\\\" class=\\\"avatar\\\"\\u003e catrix:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eSuch code just looks so beautiful and reads like natural language.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eThat’s if you’re used to the DSL - but I generally agree that it’s better to express intent in your code than implementation (ie, declarative programming \\u0026gt; imperative programming). The issue with DSLs, though, is that there’s a learning curve to the syntax and framework behavior, and that’s not always easy.\\u003c/p\\u003e\\n\\u003cp\\u003eThere will still be DSL-like decorators and builders in v3 like \\u003ccode\\u003euntil\\u003c/code\\u003e, \\u003ccode\\u003ewithTimeout\\u003c/code\\u003e, \\u003ccode\\u003ealongWith\\u003c/code\\u003e, etc, and - because they’re a higher-level part of the framework - don’t particularly care about how commands are implemented at a lower level.\\u003c/p\\u003e\\n\\u003cp\\u003eIt’s pretty easy to add a v2-like shim layer if you really want (see below); though I’m not yet convinced that we’d want something like this included in the library. Convenience factories for simple looping commands (eg \\u003ccode\\u003eCommand.loop(Runnable)\\u003c/code\\u003e I think would be good fits, but if you’re doing something more complicated - that’s where coroutines are more powerful\\u003c/p\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003eCommandBuilder v2Shim(\\n    Runnable init,\\n    Runnable execute,\\n    BooleanSupplier isFinished,\\n    BooleanConsumer onExit) {\\n\\n  return run(coroutine -\\u0026gt; {\\n    init.run();\\n\\n    while (!isFinished.getAsBoolean()) {\\n      execute.run();\\n      coroutine.yield();\\n    }\\n\\n    onExit.accept(false);\\n  }).whenCanceled(() -\\u0026gt; onExit.accept(true));\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\",\"post_number\":3,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T11:30:22.518Z\",\"reply_count\":1,\"reply_to_post_number\":2,\"quote_count\":1,\"incoming_link_count\":2,\"reads\":695,\"readers_count\":694,\"score\":229.0,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Sam Carlberg\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":5}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":25916,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"2084 Lead Mentor | WPILib Developer\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/3\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":5}],\"current_user_reaction\":null,\"reaction_users_count\":5,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605829,\"name\":\"Sam Carlberg\",\"username\":\"SamCarlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"created_at\":\"2025-04-28T11:37:09.920Z\",\"cooked\":\"\\u003cp\\u003eFor a crunchier example of a slightly more complex command, here’s a homing command that \\u003ca class=\\\"mention\\\" href=\\\"/u/bankst\\\"\\u003e@bankst\\u003c/a\\u003e shared in the unofficial discord server last week:\\u003c/p\\u003e\\n\\u003cdetails\\u003e\\n\\u003csummary\\u003e\\nV2\\u003c/summary\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003epublic Command currentSenseHoming() {\\n    Runnable init = () -\\u0026gt; {\\n        System.out.println(\\\"Elevator Zero INIT\\\");\\n        m_frontMotor.getConfigurator().apply(kSoftLimitSwitchDisabledConfig);\\n        m_frontMotor.setControl(m_voltageCtrlReq.withOutput(-1));\\n    };\\n    Runnable execute = () -\\u0026gt; {};\\n    Consumer\\u0026lt;Boolean\\u0026gt; onEnd = (Boolean interrupted) -\\u0026gt; {\\n        if (interrupted) {\\n            System.out.println(\\\"Elevator homing INTERRUPTED!\\\");\\n            return;\\n        }\\n        m_frontMotor.setPosition(0);\\n        m_frontMotor.setControl(m_voltageCtrlReq.withOutput(0));\\n        removeDefaultCommand();\\n        m_isHomed = true;\\n        m_frontMotor.getConfigurator().apply(kSoftwareLimitConfigs);\\n        System.out.println(\\\"Zeroed Elevator!!!\\\");\\n    };\\n\\n    return new FunctionalCommand(init, execute, onEnd, notMoving(m_homingCurrSpike), this);\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/details\\u003e\\n\\u003cp\\u003eWhich, in a 1-to-1 translation to v3, would look like this:\\u003c/p\\u003e\\n\\u003cdetails\\u003e\\n\\u003csummary\\u003e\\nV3\\u003c/summary\\u003e\\n\\u003cpre data-code-wrap=\\\"java\\\"\\u003e\\u003ccode class=\\\"lang-java\\\"\\u003epublic Command currentSenseHoming() {\\n  return run(coroutine -\\u0026gt; {\\n    System.out.println(\\\"Elevator Zero INIT\\\");\\n    m_frontMotor.getConfigurator().apply(kSoftLimitSwitchDisabledConfig);\\n    m_frontMotor.setControl(m_voltageCtrlReq.withOutput(-1));\\n\\n    var detection = notMoving(m_homingCurrSpike);\\n    while (!detection.getAsBoolean()) {\\n      coroutine.yield();\\n    }\\n\\n    m_frontMotor.setPosition(0);\\n    m_frontMotor.setControl(m_voltageCtrlReq.withOutput(0));\\n    removeDefaultCommand();\\n    m_isHomed = true;\\n    m_frontMotor.getConfigurator().apply(kSoftwareLimitConfigs);\\n    System.out.println(\\\"Zeroed Elevator!!!\\\");\\n  })\\n  .whenCancelled(() -\\u0026gt; System.out.println(\\\"Elevator homing INTERRUPTED!\\\")\\n  .named(\\\"Elevator Homing\\\");\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003c/details\\u003e\",\"post_number\":4,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T11:37:09.920Z\",\"reply_count\":0,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":624,\"readers_count\":623,\"score\":189.8,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Sam Carlberg\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":4}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":25916,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"2084 Lead Mentor | WPILib Developer\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/4\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":4}],\"current_user_reaction\":null,\"reaction_users_count\":4,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605842,\"name\":\"Drew Williams\",\"username\":\"jreneew2\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jreneew2/{size}/135239_2.png\",\"created_at\":\"2025-04-28T11:49:15.813Z\",\"cooked\":\"\\u003cp\\u003eWill C++ and python get matching support for this? It would be nice for those languages to stay in sync since they are officially supported.\\u003c/p\\u003e\",\"post_number\":5,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T11:49:15.813Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":618,\"readers_count\":617,\"score\":143.6,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Drew Williams\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":21777,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\" 2053 Head Mentor \"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/5\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605851,\"name\":\"Sam Carlberg\",\"username\":\"SamCarlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"created_at\":\"2025-04-28T11:54:25.177Z\",\"cooked\":\"\\u003cp\\u003eC++ doesn’t have production ready coroutines yet (maybe 5+ years out? they seem to be moving pretty slowly) and won’t be getting v3. I think \\u003ca class=\\\"mention\\\" href=\\\"/u/vasista\\\"\\u003e@Vasista\\u003c/a\\u003e is interested in implementing something similar for python, though because that language has true first-party coroutine support I expect the robotpy version will look different from the Java API\\u003c/p\\u003e\",\"post_number\":6,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T11:54:25.177Z\",\"reply_count\":1,\"reply_to_post_number\":5,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":615,\"readers_count\":614,\"score\":178.0,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Sam Carlberg\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":21777,\"username\":\"jreneew2\",\"name\":\"Drew Williams\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jreneew2/{size}/135239_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":3}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":25916,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"2084 Lead Mentor | WPILib Developer\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/6\",\"reactions\":[{\"id\":\"cry\",\"type\":\"emoji\",\"count\":3},{\"id\":\"heart\",\"type\":\"emoji\",\"count\":3}],\"current_user_reaction\":null,\"reaction_users_count\":6,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605856,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2025-04-28T11:57:52.035Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"catrix\\\" data-post=\\\"2\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/letter_avatar_proxy/v4/letter/c/dbc845/48.png\\\" class=\\\"avatar\\\"\\u003e catrix:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eIf the advantage of the new API is simply allowing the use of native \\u003ccode\\u003eif\\u003c/code\\u003e and \\u003ccode\\u003ewhile\\u003c/code\\u003e inside commands, it feels like not worth its price.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eAs Sam mentioned, if you want to write v2-style fluent commands without yielding, you’ll still be able to do that!  Transitioning from a v2 project should be easy and safe.\\u003c/p\\u003e\\n\\u003cp\\u003eThink of the new coroutine syntax as a more expressive alternative to the current ProxyCommand.  It lets you write code that is somewhat more-granular, at the cost of sharper edges.\\u003c/p\\u003e\\n\\u003cp\\u003eThe relation between continuation/coroutine-style commands and fluent/decorator-style commands is similar to the relationship between async/await and promise-chaining.  Typically you want to be able to do both, since they’re good at different things.\\u003c/p\\u003e\",\"post_number\":7,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T11:59:39.205Z\",\"reply_count\":0,\"reply_to_post_number\":2,\"quote_count\":1,\"incoming_link_count\":2,\"reads\":608,\"readers_count\":607,\"score\":296.6,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":9}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/7\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":9}],\"current_user_reaction\":null,\"reaction_users_count\":9,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605875,\"name\":\"Carter Ryba\",\"username\":\"10219Ryba\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/10219ryba/{size}/248339_2.png\",\"created_at\":\"2025-04-28T12:20:30.361Z\",\"cooked\":\"\\u003cp\\u003eIs the coroutine.yield() basically just saying other commands can be run at the same time or am I understanding it wrong?\\u003c/p\\u003e\",\"post_number\":8,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T12:20:30.361Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":574,\"readers_count\":573,\"score\":124.8,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Carter Ryba\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":65624,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"9764, 10219\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/8\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3605892,\"name\":\"Sam Carlberg\",\"username\":\"SamCarlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"created_at\":\"2025-04-28T12:35:04.404Z\",\"cooked\":\"\\u003cp\\u003eBasically, \\u003ccode\\u003ecoroutine.yield()\\u003c/code\\u003e is the command indicating that it’s reached a point where it can safely be paused. Then the scheduler can pause it and start another command, which will run until \\u003cem\\u003eit\\u003c/em\\u003e reaches a \\u003ccode\\u003ecoroutine.yield()\\u003c/code\\u003e point… and so on until every command has been processed. Then it runs all over again the next time you call \\u003ccode\\u003eScheduler.run()\\u003c/code\\u003e, typically in a function like \\u003ccode\\u003erobotPeriodic()\\u003c/code\\u003e just like you’d use the v2 command scheduler\\u003c/p\\u003e\",\"post_number\":9,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T12:43:26.394Z\",\"reply_count\":1,\"reply_to_post_number\":8,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":568,\"readers_count\":567,\"score\":163.6,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Sam Carlberg\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":65624,\"username\":\"10219Ryba\",\"name\":\"Carter Ryba\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/10219ryba/{size}/248339_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":3}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":25916,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"2084 Lead Mentor | WPILib Developer\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/9\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2},{\"id\":\"+1\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":3,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606070,\"name\":\"\",\"username\":\"Vasista\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/v/ccd318/{size}.png\",\"created_at\":\"2025-04-28T14:25:30.338Z\",\"cooked\":\"\\u003caside class=\\\"onebox githubpullrequest\\\" data-onebox-src=\\\"https://github.com/robotpy/robotpy-commands-v2/pull/12\\\"\\u003e\\n  \\u003cheader class=\\\"source\\\"\\u003e\\n\\n      \\u003ca href=\\\"https://github.com/robotpy/robotpy-commands-v2/pull/12\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003egithub.com/robotpy/robotpy-commands-v2\\u003c/a\\u003e\\n  \\u003c/header\\u003e\\n\\n  \\u003carticle class=\\\"onebox-body\\\"\\u003e\\n    \\u003cdiv class=\\\"github-row\\\" data-github-private-repo=\\\"false\\\"\\u003e\\n\\n\\n\\n    \\u003cdiv class=\\\"github-icon-container\\\" title=\\\"Pull Request\\\"\\u003e\\n      \\u003csvg width=\\\"60\\\" height=\\\"60\\\" class=\\\"github-icon\\\" viewBox=\\\"0 0 12 16\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cpath fill-rule=\\\"evenodd\\\" d=\\\"M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z\\\"\\u003e\\u003c/path\\u003e\\u003c/svg\\u003e\\n    \\u003c/div\\u003e\\n\\n  \\u003cdiv class=\\\"github-info-container\\\"\\u003e\\n\\n\\n\\n      \\u003ch4\\u003e\\n        \\u003ca href=\\\"https://github.com/robotpy/robotpy-commands-v2/pull/12\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003eAdd coroutine command support\\u003c/a\\u003e\\n      \\u003c/h4\\u003e\\n\\n    \\u003cdiv class=\\\"branches\\\"\\u003e\\n      \\u003ccode\\u003erobotpy:main\\u003c/code\\u003e ← \\u003ccode\\u003eTheTripleV:hotchocolate\\u003c/code\\u003e\\n    \\u003c/div\\u003e\\n\\n      \\u003cdiv class=\\\"github-info\\\"\\u003e\\n        \\u003cdiv class=\\\"date\\\"\\u003e\\n          opened \\u003cspan class=\\\"discourse-local-date\\\" data-format=\\\"ll\\\" data-date=\\\"2022-04-22\\\" data-time=\\\"11:24:14\\\" data-timezone=\\\"UTC\\\"\\u003e11:24AM - 22 Apr 22 UTC\\u003c/span\\u003e\\n        \\u003c/div\\u003e\\n\\n        \\u003cdiv class=\\\"user\\\"\\u003e\\n          \\u003ca href=\\\"https://github.com/TheTripleV\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003e\\n            \\u003cimg alt=\\\"TheTripleV\\\" src=\\\"https://avatars.githubusercontent.com/u/11065157?v=4\\\" class=\\\"onebox-avatar-inline\\\" width=\\\"20\\\" height=\\\"20\\\"\\u003e\\n            TheTripleV\\n          \\u003c/a\\u003e\\n        \\u003c/div\\u003e\\n\\n        \\u003cdiv class=\\\"lines\\\" title=\\\"30 commits changed 18 files with 1497 additions and 13 deletions\\\"\\u003e\\n          \\u003ca href=\\\"https://github.com/robotpy/robotpy-commands-v2/pull/12/files\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\"\\u003e\\n            \\u003cspan class=\\\"added\\\"\\u003e+1497\\u003c/span\\u003e\\n            \\u003cspan class=\\\"removed\\\"\\u003e-13\\u003c/span\\u003e\\n          \\u003c/a\\u003e\\n        \\u003c/div\\u003e\\n      \\u003c/div\\u003e\\n  \\u003c/div\\u003e\\n\\u003c/div\\u003e\\n\\n  \\u003cdiv class=\\\"github-row\\\"\\u003e\\n    \\u003cp class=\\\"github-body-container\\\"\\u003eStill todo\\n- [x] Add support for `runsWhenDisabled` in the constructor\\n- [ ] A\\u003cspan class=\\\"show-more-container\\\"\\u003e\\u003ca href=\\\"https://github.com/robotpy/robotpy-commands-v2/pull/12\\\" target=\\\"_blank\\\" rel=\\\"noopener nofollow ugc\\\" class=\\\"show-more\\\"\\u003e…\\u003c/a\\u003e\\u003c/span\\u003e\\u003cspan class=\\\"excerpt hidden\\\"\\u003eccept coroutines in helper functions (`.andThen`, etc.) and `Subsystem.setDefaultCommand`? These currently must be manually wrapped in `CoroutineCommand`s\\n- [ ] Tests\\n- [ ] Docs\\n\\n## Overview\\n\\nAdd support for coroutines into commands2. These coroutines are compatible with commands. Coroutines can be converted to Commands and Commands can be converted to coroutines.\\n\\nNote: \\\"Coroutine\\\" in this PR and impl act as coroutines for the purposes of FRC but are actually generators. This PR does **not** add support for any async/await. Coroutines have been implemented as generators so they can run synchronously with robot code and can be managed by the CommandScheduler loop (instead of asyncio).\\n\\n## Usage\\n\\n### Buttons/Triggers\\nButtons and Triggers currently accept `Command`s and functions (`Callable[[], None]`). This has been expanded to accept generators and generator functions.\\n\\nButtons have been moved to a Python implementation and `Trigger` has been partially moved (the exposed `Trigger` is Python that encapsulates the c++ `Trigger`) to facilitate this. This is because most of `Trigger`'s methods have to have multiple return types to support both decorator and non-decorator forms. \\n\\n#### Generator\\n```py\\nb: Button\\n\\ndef generator_command():\\n\\twhile True:\\n\\t\\tprint(i)\\n\\t\\tyield\\n\\ng = generator_command()\\n\\nb.whenPressed(g)\\n```\\nWarning: While this is supported, it is not recommended. Python does not allow for generators to be copied. The workaround, `tee` can potentially use infinite memory. Because of this, coroutines bound this way can only be used once. The above snippet would only work the first time the button is pressed.\\n\\n#### Generator Function\\n\\n```py\\nb: Button\\n\\ndef generator_command():\\n\\twhile True:\\n\\t\\tprint(i)\\n\\t\\tyield\\n\\nb.whenPressed(generator_command)\\n```\\nThis is the recommended way to pass in generators in the non-decorator style. Using a function with no params (`Callable[[], Generator[None, None, None]`) that builds the generator. The internally used `CoroutineCommand` saves this function and rebuilds the generator each time `.initialize()` is called.\\n\\n### Buttons/Trigger as decorators\\nAll `Callables` accepted by buttons and triggers can also be passed in by using it as a decorator. This style is how flask, fastapi, and Swift (Trailing Closure Syntax) do things.\\n\\n#### Functions\\n```py\\nb: Button\\n\\n# Ex 1\\n@b.whenPressed\\ndef _():\\n\\tprint(1)\\n\\n# Ex 2\\n@b.whenPressed()\\ndef _():\\n\\tprint(2)\\n\\n# Ex 3\\n@b.whenPressed(interruptible=False)\\ndef _():\\n\\tprint(3)\\n\\n# Ex 4\\n@b.whenPressed(requirements=[robot.drivetrain])\\ndef _():\\n\\tprint(4)\\n```\\n\\n#### Generator Functions\\nAll 4 example arguments as above work but only the \\\"Ex 1\\\" form is shown.\\n\\n```py\\nb: Button\\n\\n@b.whenPressed\\ndef _():\\n\\twhile True:\\n\\t\\tprint(i)\\n\\t\\tyield\\n```\\n\\n[Simple Example in 2022 Robot Code](https://github.com/CtrlZ-FRC4096/Robot-2022-Public/blob/main/robot/oi.py#L167-L169)\\n[Complex Example in 2022 Robot Code](https://github.com/CtrlZ-FRC4096/Robot-2022-Public/blob/main/robot/oi.py#L123-L134)\\n\\n### Composing Coroutines\\nIn the current command framework, commands are composed using extra classes (`ParallelCommandGroup`, `SequentialCommandGroup`, etc.) or using helper functions (`.andThen(...)`, etc.). \\nCoroutines aren't natively supported by these constructors (yet?) and must be wrapped in `CoroutineCommand` to enable this.\\n\\nBut, coroutines can be composed within themselves using `yield from`.\\n```py\\ndef a():\\n\\tfor i in range(10):\\n\\t\\tyield\\n\\ndef b():\\n\\tprint(1)\\n\\tyield\\n\\tprint(2)\\n\\tyield from a() # this runs a until it's complete (each yield in a() still applies of course)\\n```\\nFurthermore, since coroutines are generators with no input, they can be used as iterables.\\n```py\\nyield from a()\\n```\\nis equivalent to\\n```py\\nfor _ in a():\\n\\tyield\\n```\\nfor the purposes of this framework.\\n\\n[Very Complex Example in 2022 Robot Code (Untested)](https://github.com/CtrlZ-FRC4096/Robot-2022-Public/blob/main/robot/oi.py#L265-L336)\\n\\nSo, to run coroutines in parallel and move on when any one command finishes:\\n```py\\ndef c():\\n\\tfor _ in zip(a(), b()):\\n\\t\\tyield\\n```\\n\\n### Converting Coroutines to Commands\\n#### commandify\\nThe `@commandify` decorator lets commands be written as coroutines and be exposed as commands currently are.\\n\\n```py\\n@commandify\\ndef MyCommand(i, j):\\n\\tprint(i)\\n\\tyield\\n\\tprint(j)\\n```\\n\\nThe signature of MyCommand is now `(i, j) -\\u0026gt; CoroutineCommand`\\n\\n```py\\ncommand: CoroutineCommand = MyCommand(1,2)\\n```\\n\\nRequirements can be passed into `commandify` as\\n```py\\n@commandify(requirements = [robot.climber])\\n```\\n\\nNote that the access time of requirements has changed.\\nIn the new style (above), requirements are saved when the file is parsed.\\nIn the old style, requirements are saved when the command is constructed:\\n```py\\nclass C(CommandBase):\\n\\tdef __init__(self):\\n\\t\\tself.addRequirements(...)\\n```\\n\\nBecause of this, commands with requirements created using `commandify` must be defined in a scope where the robot object has already been created (in the subsystem object for example).\\n\\n#### CoroutineCommand\\nThe `CoroutineCommand` class's constructor can be used to convert coroutines to commands. This way, coroutine functions defined in code stay as coroutine functions can be converted to commands as needed.\\n```py\\ndef coro_no_params():\\n\\tprint(1)\\n\\tyield\\n\\ndef coro_params(i, j):\\n\\tprint(i)\\n\\tyield\\n\\tprint(j)\\n\\n# Ex 1\\ncmd = CoroutineCommand(coro_no_params())\\n# Not Recommended. A generator has been passed. This command cannot be reused.\\n\\n# Ex 2\\ncmd = CoroutineCommand(coro_no_params)\\n# Recommended. A generator function has been passed. This command can be reused.\\n\\n# Ex 3\\ncmd = CoroutineCommand(coro_params(1, 2))\\n# Not recommended. A generator has been passed. This command cannot be reused.\\n\\n# Ex 4\\ncmd = CoroutineCommand(lambda: coro_params(1,2))\\n# Recommended. A generator function has been passed. This command can be reused.\\n```\\n\\n### Converting Commands to Coroutines\\nAll `Command` and it's subclasses are now iterable. Calling `command_obj.__iter__()` returns an iterable that will only exhaust when the command's `isFinished` returns `True`.\\nA coroutine is created with `command_obj.__iter__()`.\\nA coroutine function is created with `command_obj.__iter__`.\\n\\n### Using `Command`s *in* coroutines\\n#### Manual calls\\n`Command`'s initialize, execute, and isFinished can be manually called.\\n```py\\ndef a():\\n\\tcmd = MyCommand()\\n\\tcmd.initialize()\\n\\twhile not cmd.isFinished():\\n\\t\\tcmd.execute()\\n\\t\\tyield\\n```\\n#### Yield from\\nVia the `__iter__` added to `Command`, `Command`s can be yielded from in coroutines.\\n```py\\ndef a():\\n\\tcmd = MyCommand()\\n\\tyield from cmd\\n\\n# OR\\n\\ndef a():\\n\\tyield from MyCommand() # todo: make sure the command isn't destroyed by c++ before it finishes.\\n```\\u003c/span\\u003e\\u003c/p\\u003e\\n  \\u003c/div\\u003e\\n\\n  \\u003c/article\\u003e\\n\\n  \\u003cdiv class=\\\"onebox-metadata\\\"\\u003e\\n    \\n    \\n  \\u003c/div\\u003e\\n\\n  \\u003cdiv style=\\\"clear: both\\\"\\u003e\\u003c/div\\u003e\\n\\u003c/aside\\u003e\\n\\n\\u003cp\\u003eYeah it’s been on my backburner for 3 years now. But there’s most of the impl and overview docs\\u003c/p\\u003e\",\"post_number\":10,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T14:25:30.338Z\",\"reply_count\":0,\"reply_to_post_number\":6,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":553,\"readers_count\":552,\"score\":205.6,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://github.com/robotpy/robotpy-commands-v2/pull/12\",\"internal\":false,\"reflection\":false,\"title\":\"Add coroutine command support by TheTripleV · Pull Request #12 · robotpy/robotpy-commands-v2 · GitHub\",\"clicks\":12}],\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":25916,\"username\":\"SamCarlberg\",\"name\":\"Sam Carlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":6}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":39370,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"5940 | 4096 | WPILib and Robotpy Developer\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/10\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":6}],\"current_user_reaction\":null,\"reaction_users_count\":6,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606210,\"name\":\"Gavin Matthews\",\"username\":\"bovlb\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/bovlb/{size}/167232_2.png\",\"created_at\":\"2025-04-28T16:07:09.672Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"SamCarlberg\\\" data-post=\\\"3\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/samcarlberg/48/207684_2.png\\\" class=\\\"avatar\\\"\\u003e SamCarlberg:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eMaybe it’s useful if you consider \\u003ccode\\u003ecoroutine.yield()\\u003c/code\\u003e to be analogous to \\u003ccode\\u003eThread.sleep(20)\\u003c/code\\u003e\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"SamCarlberg\\\" data-post=\\\"9\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/samcarlberg/48/207684_2.png\\\" class=\\\"avatar\\\"\\u003e SamCarlberg:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eBasically, \\u003ccode\\u003ecoroutine.yield()\\u003c/code\\u003e is the command indicating that it’s reached a point where it can safely be paused.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eThis is interesting stuff. I’m more accustomed to using coroutines in a non-real-time context, where the constraints are somewhat different.\\u003c/p\\u003e\\n\\u003cp\\u003eAre we likely to see an end to the assumption that all commands run on the same (currently 20ms) cycle? Could there be a case for multiple yields in a command’s main loop? Will long-running tasks (e.g. the dreaded LiveWindows update) get extra yields?\\u003c/p\\u003e\",\"post_number\":11,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T16:19:04.637Z\",\"reply_count\":2,\"reply_to_post_number\":9,\"quote_count\":2,\"incoming_link_count\":0,\"reads\":523,\"readers_count\":522,\"score\":114.6,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Gavin Matthews\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":38743,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Programming mentor, Team 2102, RI, CSA (he/him)\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/11\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606212,\"name\":\"Jimmy McCosker\",\"username\":\"Jimmyy\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jimmyy/{size}/199505_2.png\",\"created_at\":\"2025-04-28T16:09:26.737Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"bovlb\\\" data-post=\\\"11\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/bovlb/48/167232_2.png\\\" class=\\\"avatar\\\"\\u003e bovlb:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eAre we likely to see an end to the assumption that all commands run on the same 20ms cycle?\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eI am going to assume since this is slated for 2027, it is going to be for systemcore, and presumably (hopefully) run more than 20ms loop cycles\\u003c/p\\u003e\",\"post_number\":12,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T16:09:26.737Z\",\"reply_count\":0,\"reply_to_post_number\":11,\"quote_count\":1,\"incoming_link_count\":0,\"reads\":510,\"readers_count\":509,\"score\":147.0,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Jimmy McCosker\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":3}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":52943,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"9496AM | Programming, Electrical, Strategy\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/12\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2},{\"id\":\"point_up\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":3,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606236,\"name\":\"Eric Ward\",\"username\":\"bathtubed\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/bathtubed/{size}/220364_2.png\",\"created_at\":\"2025-04-28T16:37:28.548Z\",\"cooked\":\"\\u003cp\\u003eMy first question when seeing this transformation is how will interruption be handled?\\u003c/p\\u003e\\n\\u003cp\\u003eThat’s a pretty fundamental part of commands v2, especially as we write a lot of commands using StartEnd which we compose with unique end conditions (Untils) in other commands.\\u003c/p\\u003e\\n\\u003cp\\u003eHow would I write this in v3?\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003eCommand turnColorWheel() {\\n  return StartEnd(\\n    () -\\u0026gt; m_colorMotor.Set(0.5),\\n    () -\\u0026gt; m_colorMotor.Set(0.0));\\n}\\n\\nCommand setWheelGreen() {\\n  return turnColorWheel().Until(() -\\u0026gt; getColorSensor() == GREEN);\\n}\\n\\nCommand turnWheelFiveTimes() {\\n  return turnColorWheel().Until(() -\\u0026gt; getRotations() \\u0026gt; 5);\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eThe natural, built-in language solution might be to have yield throw an InterruptedException which could be caught by the command coroutine if it wants to handle some sort of cleanup, but if uncaught, then the scheduler just catches it and quietly discards it.\\u003cbr\\u003e\\nAs for one command cancelling another, well there would need to be some handle to do so explicitly.\\u003c/p\\u003e\",\"post_number\":13,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T16:37:28.548Z\",\"reply_count\":2,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":501,\"readers_count\":500,\"score\":125.2,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Eric Ward\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":35208,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"3637 Mentor\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/13\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606251,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2025-04-28T16:47:28.259Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"bathtubed\\\" data-post=\\\"13\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/bathtubed/48/220364_2.png\\\" class=\\\"avatar\\\"\\u003e bathtubed:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eMy first question when seeing this transformation is how will interruption be handled?\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eWith decorators, same as in v2.  There are some fundamental problems with piping interruptions back as exceptions, unfortunately.\\u003c/p\\u003e\",\"post_number\":14,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T16:47:28.259Z\",\"reply_count\":0,\"reply_to_post_number\":13,\"quote_count\":1,\"incoming_link_count\":0,\"reads\":476,\"readers_count\":475,\"score\":110.2,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/14\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606281,\"name\":\"Sam Carlberg\",\"username\":\"SamCarlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"created_at\":\"2025-04-28T17:07:23.197Z\",\"cooked\":\"\\u003cp\\u003eIt will still be a single-threaded model where each command is updated periodically. That ultimately looks like placing a call to Scheduler.update() in robotPeriodic(), so all commands will run at whatever rate you call that at (defaults to 50Hz on the roboRIO, but systemcore will be able to handle much higher rates).\\u003c/p\\u003e\\n\\u003cp\\u003eYou can fudge lower frequencies by calling coroutine.yield() multiple times in a row in certain commands, but ultimately all timing is dictated by your main loop period.\\u003c/p\\u003e\",\"post_number\":15,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T17:07:23.197Z\",\"reply_count\":0,\"reply_to_post_number\":11,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":472,\"readers_count\":471,\"score\":94.4,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Sam Carlberg\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":38743,\"username\":\"bovlb\",\"name\":\"Gavin Matthews\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/bovlb/{size}/167232_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":25916,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"2084 Lead Mentor | WPILib Developer\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/15\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606284,\"name\":\"Tetsuya Cox\",\"username\":\"Tetsu\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/t/41988e/{size}.png\",\"created_at\":\"2025-04-28T17:13:38.423Z\",\"cooked\":\"\\u003cp\\u003eIs there a benefit to having\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003eWhile (!elevatorInPosition) ...\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003einstead of the loop just running things?\\u003cbr\\u003e\\nAnd what do we need to put into the while loop?\\u003c/p\\u003e\",\"post_number\":16,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T17:13:38.423Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":466,\"readers_count\":465,\"score\":98.2,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Tetsuya Cox\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":64095,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/16\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606289,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2025-04-28T17:22:23.737Z\",\"cooked\":\"\\u003cp\\u003eThe yielding \\u003ccode\\u003ewhile\\u003c/code\\u003e loop is essentially equivalent to sequencing with a \\u003ccode\\u003eCommands.waitUntil(elevator::inPosition)\\u003c/code\\u003e.\\u003c/p\\u003e\",\"post_number\":17,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T17:22:23.737Z\",\"reply_count\":0,\"reply_to_post_number\":16,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":462,\"readers_count\":461,\"score\":137.4,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":64095,\"username\":\"Tetsu\",\"name\":\"Tetsuya Cox\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/t/41988e/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":3}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/17\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2},{\"id\":\"+1\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":3,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606293,\"name\":\"Jared Russell\",\"username\":\"Jared_Russell\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jared_russell/{size}/399_2.png\",\"created_at\":\"2025-04-28T17:26:37.702Z\",\"cooked\":\"\\u003cp\\u003eI’m still searching for a compelling answer to the question “why?”\\u003c/p\\u003e\\n\\u003cp\\u003eNone of the examples posted in this thread convince me.\\u003c/p\\u003e\\n\\u003cp\\u003eThe problem statement in the detailed design says:\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\"\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eProgrammers unfamiliar with the command framework commonly run into a problem where they write a while loop inside their command’s execute() function, thus stalling the scheduler (and, by extension, the entire robot program) by never ceding control until its end condition is met.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eSure, I’ve seen this be a “day 1 of programming a robot for the first time” problem with students before. But I have found that teaching the “your Runnable will be looped for you” paradigm is not hard compared to all the other things you need to teach to code a functional robot.\\u003c/p\\u003e\\n\\u003cp\\u003eI \\u003cstrong\\u003emuch\\u003c/strong\\u003e prefer the world where there’s consistent, compile-time enforced control by default as opposed to expecting students to remember to thoughtfully place coroutine.yield() calls inside mandatory for/while loops.\\u003c/p\\u003e\\n\\u003cp\\u003eI am sure there are some complex cases where having more fine-grained control over Command flow may be beneficial (we rolled our own composite commands this year for precisely this purpose), but switching the default seems to me like it’s handing out semi-automatic footguns for little benefit.\\u003c/p\\u003e\\n\\u003cp\\u003e(Note that other V3 improvements like asProxy-by-default and improved telemetry sound great to me)\\u003c/p\\u003e\",\"post_number\":18,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T17:26:37.702Z\",\"reply_count\":3,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":2,\"reads\":467,\"readers_count\":466,\"score\":1033.4,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Jared Russell\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":59}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":1267,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Oh so close\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/18\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":51},{\"id\":\"point_up\",\"type\":\"emoji\",\"count\":6},{\"id\":\"+1\",\"type\":\"emoji\",\"count\":1},{\"id\":\"100\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":59,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606301,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2025-04-28T17:38:02.984Z\",\"cooked\":\"\\u003cp\\u003eI had a similar reaction at first, but after considering it for a while I now think that most of the change is in the architecture of the scheduler, not in the user code.  This change \\u003cem\\u003egreatly\\u003c/em\\u003e simplifies most of the decorator definitions, and bypasses a lot of uglier edge-cases of the object-oriented scheduler model.\\u003c/p\\u003e\\n\\u003caside class=\\\"quote no-group\\\" data-username=\\\"Jared_Russell\\\" data-post=\\\"18\\\" data-topic=\\\"500699\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/jared_russell/48/399_2.png\\\" class=\\\"avatar\\\"\\u003e Jared_Russell:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eI \\u003cstrong\\u003emuch\\u003c/strong\\u003e prefer the world where there’s consistent, compile-time enforced control by default as opposed to expecting students to remember to thoughtfully place coroutine.yield() calls inside mandatory for/while loops.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eI think the ideal we’re looking for is to still be in this world, but to allow imperative-style continuations for users who want to express things that the current composition model doesn’t state very cleanly.\\u003c/p\\u003e\\n\\u003cp\\u003eIf we really want, we could even shim in support for subclassed commands (I am not sure this would be good for teams on the whole, but it’s doable).\\u003c/p\\u003e\",\"post_number\":19,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T17:39:53.696Z\",\"reply_count\":0,\"reply_to_post_number\":18,\"quote_count\":1,\"incoming_link_count\":2,\"reads\":459,\"readers_count\":458,\"score\":281.8,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":10}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/19\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":9},{\"id\":\"+1\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":10,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3606326,\"name\":\"Eric Ward\",\"username\":\"bathtubed\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/bathtubed/{size}/220364_2.png\",\"created_at\":\"2025-04-28T17:59:08.513Z\",\"cooked\":\"\\u003cp\\u003eI agree with others that the \\u003ccode\\u003ewhile(condition) yield\\u003c/code\\u003e pattern seems ugly both in terms of code aesthetic and footgun potential, but I think this can be alleviated with decorators and other helper APIs that bring Commands closer to async/await paradigms outside of \\u003cspan class=\\\"abbreviation\\\"\\u003eFRC\\u003ctemplate class=\\\"tooltiptext\\\" data-text=\\\"FIRST Robotics Competition\\\"\\u003e\\u003c/template\\u003e\\u003c/span\\u003e.\\u003c/p\\u003e\\n\\u003cp\\u003eI’d love to be writing code like this:\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003emotor.Set(0.5)\\nawait WaitFor(this::pieceDetected)\\nmotor.Set(0.0)\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eMy understanding is that we’ll be able to do this, where WaitFor is a command (which under the hood is doing the \\u003ccode\\u003ewhile(condition) yield\\u003c/code\\u003e thing)\\u003c/p\\u003e\\n\\u003cp\\u003eor like this\\u003c/p\\u003e\\n\\u003cpre\\u003e\\u003ccode class=\\\"lang-auto\\\"\\u003eSwerveRoutine(twistSupplier) {\\n  async for (twist in twistSupplier) \\n    m_swerve.apply(twist);\\n}\\n\\u003c/code\\u003e\\u003c/pre\\u003e\\n\\u003cp\\u003eWhere \\u003ccode\\u003etwistSupplier\\u003c/code\\u003e is a generator coroutine that handles the yielding. It can be a feedback controller or joystick inputs, but either way it awaits the scheduler loop time than yields a value.\\u003c/p\\u003e\\n\\u003cp\\u003eI’m under the impression however that the latter here might not be possible with java coroutines, I know it’s possible in Python and cpp (theoretically).\\u003c/p\\u003e\",\"post_number\":20,\"post_type\":1,\"posts_count\":97,\"updated_at\":\"2025-04-28T17:59:08.513Z\",\"reply_count\":2,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":460,\"readers_count\":459,\"score\":151.8,\"yours\":false,\"topic_id\":500699,\"topic_slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"display_username\":\"Eric Ward\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":3}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":35208,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"3637 Mentor\"},\"post_url\":\"/t/wpilib-commands-v3-imperative-function-bodies-with-coroutines/500699/20\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":2},{\"id\":\"100\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":3,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null}],\"stream\":[3605444,3605762,3605811,3605829,3605842,3605851,3605856,3605875,3605892,3606070,3606210,3606212,3606236,3606251,3606281,3606284,3606289,3606293,3606301,3606326,3606342,3606351,3606358,3606361,3606362,3606395,3606412,3606427,3606436,3606449,3606477,3606486,3606489,3606494,3606513,3606518,3606523,3606600,3606633,3606642,3606651,3606670,3606672,3606708,3606719,3606723,3606728,3606752,3606768,3606782,3606785,3606793,3606799,3606855,3606871,3607004,3607021,3607022,3607032,3607248,3607255,3607259,3607281,3607840,3607885,3607886,3607931,3608000,3608009,3608019,3608022,3608042,3608105,3608111,3608260,3608282,3608296,3608298,3608303,3608304,3608318,3608319,3608328,3608342,3608345,3608347,3608379,3608465,3608466,3608471,3608650,3608651,3608653,3608975,3609182,3609194,3609598]},\"timeline_lookup\":[[1,98],[2,97],[56,96],[68,95],[93,94],[97,93]],\"tags\":[],\"tags_descriptions\":{},\"id\":500699,\"title\":\"WPILib Commands V3 - Imperative function bodies with coroutines\",\"fancy_title\":\"WPILib Commands V3 - Imperative function bodies with coroutines\",\"posts_count\":97,\"created_at\":\"2025-04-28T01:12:38.579Z\",\"views\":3467,\"reply_count\":76,\"like_count\":469,\"last_posted_at\":\"2025-05-02T13:57:39.772Z\",\"visible\":true,\"closed\":false,\"archived\":false,\"has_summary\":true,\"archetype\":\"regular\",\"slug\":\"wpilib-commands-v3-imperative-function-bodies-with-coroutines\",\"category_id\":30,\"word_count\":11536,\"deleted_at\":null,\"user_id\":25916,\"featured_link\":null,\"pinned_globally\":false,\"pinned_at\":null,\"pinned_until\":null,\"image_url\":null,\"slow_mode_seconds\":0,\"draft\":null,\"draft_key\":\"topic_500699\",\"draft_sequence\":null,\"unpinned\":null,\"pinned\":false,\"current_post_number\":1,\"highest_post_number\":97,\"deleted_by\":null,\"actions_summary\":[{\"id\":4,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":8,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":10,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":7,\"count\":0,\"hidden\":false,\"can_act\":false}],\"chunk_size\":20,\"bookmarked\":false,\"topic_timer\":{\"id\":47087,\"execute_at\":\"2026-05-02T13:57:39.772Z\",\"duration_minutes\":525600,\"based_on_last_post\":true,\"status_type\":\"close\",\"category_id\":null},\"message_bus_last_id\":1,\"participant_count\":39,\"show_read_indicator\":false,\"thumbnails\":null,\"slow_mode_enabled_until\":null,\"valid_reactions\":[\"heart\",\"laughing\",\"point_up\",\"+1\",\"-1\",\"100\",\"open_mouth\",\"cry\",\"question\",\"thinking\",\"call_me_hand\",\"hugs\",\"angry\"],\"user_chosen_thumbnail_url\":null,\"sidecar_installed\":true,\"details\":{\"can_edit\":false,\"notification_level\":1,\"participants\":[{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"post_count\":16,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":25916,\"username\":\"SamCarlberg\",\"name\":\"Sam Carlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\",\"post_count\":12,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":56324,\"username\":\"Daniel1464\",\"name\":\"Daniel C.\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/d/6bbea6/{size}.png\",\"post_count\":7,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":50699,\"username\":\"Programming4907\",\"name\":\"Scott W\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/programming4907/{size}/168313_2.png\",\"post_count\":6,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":35208,\"username\":\"bathtubed\",\"name\":\"Eric Ward\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/bathtubed/{size}/220364_2.png\",\"post_count\":4,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":44763,\"username\":\"tekdemo\",\"name\":\"Dan\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/tekdemo/{size}/138330_2.png\",\"post_count\":4,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":64095,\"username\":\"Tetsu\",\"name\":\"Tetsuya Cox\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/t/41988e/{size}.png\",\"post_count\":3,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":54372,\"username\":\"krylez\",\"name\":\"Riley Brewer\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/krylez/{size}/176730_2.png\",\"post_count\":3,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":13575,\"username\":\"Peter_Johnson\",\"name\":\"Peter Johnson\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/peter_johnson/{size}/10417_2.png\",\"post_count\":3,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":1267,\"username\":\"Jared_Russell\",\"name\":\"Jared Russell\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jared_russell/{size}/399_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":1737,\"username\":\"Steven_Carmain\",\"name\":\"Steven Carmain\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/s/f07891/{size}.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":12760,\"username\":\"Knufire\",\"name\":\"Rahul Yarlagadda\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/knufire/{size}/67820_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":24533,\"username\":\"microbuns\",\"name\":\"Sam Maier\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/microbuns/{size}/168757_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":32089,\"username\":\"BlueEpiphone\",\"name\":\"Curt Rozeboom\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/blueepiphone/{size}/197122_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":45763,\"username\":\"Starlight220\",\"name\":null,\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/starlight220/{size}/150872_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":53190,\"username\":\"truher\",\"name\":\"joel truher\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/truher/{size}/172222_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":54615,\"username\":\"QwertyChouskie\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/qwertychouskie/{size}/177994_2.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":60033,\"username\":\"catrix\",\"name\":\"sam liu\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/c/dbc845/{size}.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":44471,\"username\":\"jonahb55\",\"name\":\"Jonah Bonner\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jonahb55/{size}/194474_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":34970,\"username\":\"mdurrani834\",\"name\":\"\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mdurrani834/{size}/131246_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":63823,\"username\":\"UHDbits\",\"name\":\"Ashton A\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/u/a5b964/{size}.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":23941,\"username\":\"jnicho15\",\"name\":\"Dan Nichols\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jnicho15/{size}/7893_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":51179,\"username\":\"Cynosure\",\"name\":\"Asher Olgeirson\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/cynosure/{size}/184875_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":52943,\"username\":\"Jimmyy\",\"name\":\"Jimmy McCosker\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/jimmyy/{size}/199505_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2}],\"created_by\":{\"id\":25916,\"username\":\"SamCarlberg\",\"name\":\"Sam Carlberg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/samcarlberg/{size}/207684_2.png\"},\"last_poster\":{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\"},\"links\":[{\"url\":\"https://github.com/wpilibsuite/allwpilib/pull/6518\",\"title\":\"[DRAFT] Commands v3 framework by SamCarlberg · Pull Request #6518 · wpilibsuite/allwpilib · GitHub\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":93,\"user_id\":25916,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://claude.ai/share/e630af9b-dec3-493f-a2bd-5d1b379fd758\",\"title\":null,\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":41,\"user_id\":54615,\"domain\":\"claude.ai\",\"root_domain\":\"claude.ai\"},{\"url\":\"https://github.com/samcarlberg/allwpilib/blob/better-async-commands/design-docs/commands-v3.md\",\"title\":\"allwpilib/design-docs/commands-v3.md at better-async-commands · SamCarlberg/allwpilib · GitHub\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":38,\"user_id\":25916,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://github.com/frc3512/Robot-2020/blob/main/src/main/cpp/autonomous/AutoLeftSideShootTen.cpp\",\"title\":\"Robot-2020/src/main/cpp/autonomous/AutoLeftSideShootTen.cpp at main · frc3512/Robot-2020 · GitHub\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":15,\"user_id\":16846,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://github.com/wpilibsuite/allwpilib/blob/1a10dfb5474513dec1211c0255e42079130782f2/commandsv3/src/main/java/org/wpilib/commands3/Coroutine.java#L105-L164\",\"title\":\"allwpilib/commandsv3/src/main/java/org/wpilib/commands3/Coroutine.java at 1a10dfb5474513dec1211c0255e42079130782f2 · wpilibsuite/allwpilib · GitHub\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":14,\"user_id\":24533,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://github.com/robotpy/robotpy-commands-v2/pull/12\",\"title\":\"Add coroutine command support by TheTripleV · Pull Request #12 · robotpy/robotpy-commands-v2 · GitHub\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":12,\"user_id\":39370,\"domain\":\"github.com\",\"root_domain\":\"github.com\"},{\"url\":\"https://hpx-docs.stellar-group.org/branches/release/html/libs/core/coroutines/docs/index.html\",\"title\":\"coroutines — HPX release documentation\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":9,\"user_id\":16846,\"domain\":\"hpx-docs.stellar-group.org\",\"root_domain\":\"stellar-group.org\"},{\"url\":\"https://source.chromium.org/chromium/chromium/src/+/main:build/android/bytecode/java/org/chromium/bytecode/TraceEventAdder.java;drc=f15fac1f88c8d46ffd687aee10f293b043f53ccd\",\"title\":null,\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":6,\"user_id\":24533,\"domain\":\"source.chromium.org\",\"root_domain\":\"chromium.org\"},{\"url\":\"https://developers.facebook.com/blog/post/2021/10/14/async-stack-traces-c-plus-plus-coroutines-folly-walking-async-stack/\",\"title\":null,\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":3,\"user_id\":16846,\"domain\":\"developers.facebook.com\",\"root_domain\":\"facebook.com\"}]},\"bookmarks\":[]}"}
