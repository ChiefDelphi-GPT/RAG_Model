{"data":"{\"post_stream\":{\"posts\":[{\"id\":3014247,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-02-28T16:12:40.123Z\",\"cooked\":\"\\u003cp\\u003eHello, I am trying to tune a PIDF on the spark max for a flywheel using two neos on a 1:1 reduction and using the internal encoder to read speed. Currently I have a setup that works but still takes too long to spin up.\\u003c/p\\u003e\\n\\u003cp\\u003eWhen I was trying to tune the PIDF to get a better spin up time, I found some things that make me believe the PID is not working as shown on \\u003ca href=\\\"https://docs.revrobotics.com/sparkmax/operating-modes/closed-loop-control\\\" rel=\\\"noopener nofollow ugc\\\"\\u003ethis diagram\\u003c/a\\u003e.\\u003c/p\\u003e\\n\\u003cp\\u003eI tried to set all values to zero and begin with only P, but it is not behaving like a P controller should. When I give it a setpoint, the output goes straight to 40% and does not change. The steady-state error is actually even negative, with the measured value overshooting the setpoint, yet the output still stays positive. Basically it is working as if it only had an F value.\\u003c/p\\u003e\\n\\u003cp\\u003eA similar thing happens if I have all values to zero and a small I. The measured value starts working as you would expect, by ramping up very slowly and going up to the setpoint, but when it gets there, it keeps rising.\\u003c/p\\u003e\\n\\u003cp\\u003eIt is looking like the error is not actually being calculated as zero when the measured value reaches the setpoint, which is pretty odd.\\u003c/p\\u003e\\n\\u003cp\\u003eI have already had a look at \\u003ca href=\\\"https://www.chiefdelphi.com/t/tune-rev-spark-max-pid-for-shooter/379068\\\"\\u003ethis thread\\u003c/a\\u003e and \\u003ca href=\\\"https://www.chiefdelphi.com/t/spark-max-pid-velocity-control-spark-max-reaches-set-point-and-then/378976\\\"\\u003ealso this thread\\u003c/a\\u003e, but they don’t mention anything similar to what I have been seeing here. It is also complicated to debug the PIDF block as it only sends the value to the cam and the code is executed outside of the roborio.\\u003c/p\\u003e\\n\\u003cp\\u003eHas anyone experienced similar issues with the spark max using LabVIEW?\\u003c/p\\u003e\",\"post_number\":1,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:12:40.123Z\",\"reply_count\":0,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":252,\"reads\":106,\"readers_count\":105,\"score\":1281.2,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://docs.revrobotics.com/sparkmax/operating-modes/closed-loop-control\",\"internal\":false,\"reflection\":false,\"title\":\"Closed Loop Control - SPARK MAX\",\"clicks\":16},{\"url\":\"https://www.chiefdelphi.com/t/tune-rev-spark-max-pid-for-shooter/379068\",\"internal\":true,\"reflection\":false,\"title\":\"Tune REV Spark Max PID for shooter\",\"clicks\":3},{\"url\":\"https://www.chiefdelphi.com/t/spark-max-pid-velocity-control-spark-max-reaches-set-point-and-then/378976\",\"internal\":true,\"reflection\":false,\"title\":\"Spark Max PID Velocity control, Spark Max reaches set point and then\",\"clicks\":1}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/1\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null,\"can_vote\":false},{\"id\":3014257,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2022-02-28T16:21:17.291Z\",\"cooked\":\"\\u003cp\\u003eIt sounds like you’re trying to control a flywheel with feedback and no feedforward.  This won’t work.\\u003c/p\\u003e\\n\\u003cp\\u003eGet your feedforward control as close as you can without feedback, and then add proportional feedback on top of it.  For flywheel control, you should not need anything other than proportional gain (integral gain is unstable, and derivative gain doesn’t gain you any additional control over the response at a constant setpoint).\\u003c/p\\u003e\\n\\u003cp\\u003eBe aware that the NEOs have a 110ms measurement delay on their velocity readings that is hardcoded into the SparkMax.  This renders the measured velocity fairly useless for feedback control.\\u003c/p\\u003e\",\"post_number\":2,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:22:19.782Z\",\"reply_count\":0,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":90,\"readers_count\":89,\"score\":48.0,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/2\",\"custom_user_title\":\"Robot apartments! invisible suburbs! skeleton treasuries!\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014268,\"name\":\"Mark McLeod\",\"username\":\"Mark_McLeod\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mark_mcleod/{size}/65145_2.png\",\"created_at\":\"2022-02-28T16:38:49.222Z\",\"cooked\":\"\\u003cp\\u003eHere’s an example form our 2020 robot which was a two wheel shooter.\\u003cbr\\u003e\\nYour gains will differ as your flywheel and mechanical losses will be different.\\u003cbr\\u003e\\nOurs were P Gain=0.0004, F Gain =0.00017\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cdiv class=\\\"lightbox-wrapper\\\"\\u003e\\u003ca class=\\\"lightbox\\\" href=\\\"https://www.chiefdelphi.com/uploads/default/original/3X/d/3/d34d382a76985d740c45cc402538d48f85c25cf2.png\\\" data-download-href=\\\"https://www.chiefdelphi.com/uploads/default/d34d382a76985d740c45cc402538d48f85c25cf2\\\" title=\\\"Neo Shooter\\\"\\u003e\\u003cimg src=\\\"https://www.chiefdelphi.com/uploads/default/optimized/3X/d/3/d34d382a76985d740c45cc402538d48f85c25cf2_2_690x292.png\\\" alt=\\\"Neo Shooter\\\" data-base62-sha1=\\\"u9gbEUoGmTxyPwn9BoXLV33quMq\\\" width=\\\"690\\\" height=\\\"292\\\" srcset=\\\"https://www.chiefdelphi.com/uploads/default/optimized/3X/d/3/d34d382a76985d740c45cc402538d48f85c25cf2_2_690x292.png, https://www.chiefdelphi.com/uploads/default/optimized/3X/d/3/d34d382a76985d740c45cc402538d48f85c25cf2_2_1035x438.png 1.5x, https://www.chiefdelphi.com/uploads/default/optimized/3X/d/3/d34d382a76985d740c45cc402538d48f85c25cf2_2_1380x584.png 2x\\\" data-dominant-color=\\\"F5F0F0\\\"\\u003e\\u003cdiv class=\\\"meta\\\"\\u003e\\u003csvg class=\\\"fa d-icon d-icon-far-image svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#far-image\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003cspan class=\\\"filename\\\"\\u003eNeo Shooter\\u003c/span\\u003e\\u003cspan class=\\\"informations\\\"\\u003e1659×704 86.8 KB\\u003c/span\\u003e\\u003csvg class=\\\"fa d-icon d-icon-discourse-expand svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#discourse-expand\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003c/div\\u003e\\u003c/a\\u003e\\u003c/div\\u003e\\u003cbr\\u003e\\nThis version just used the joystick throttles to adjust rpm. Another version just took top and bottom rpms typed by the driver at the Dashboard.\\u003c/p\\u003e\",\"post_number\":3,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:41:20.933Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":78,\"readers_count\":77,\"score\":50.6,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Mark McLeod\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://www.chiefdelphi.com/uploads/default/original/3X/d/3/d34d382a76985d740c45cc402538d48f85c25cf2.png\",\"internal\":true,\"reflection\":false,\"clicks\":0}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[{\"id\":2,\"count\":1}],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":2123,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Itinerant Troubleshooter\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/3\",\"custom_user_title\":\"Itinerant Troubleshooter\",\"reactions\":[{\"id\":\"heart\",\"type\":\"emoji\",\"count\":1}],\"current_user_reaction\":null,\"reaction_users_count\":1,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014277,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-02-28T16:51:28.995Z\",\"cooked\":\"\\u003cp\\u003eIs there any specific reason for the logic around that true/false block to only set the constants when they change?\\u003c/p\\u003e\\n\\u003cp\\u003eOne thing we were speculating on was that maybe something is going wrong because we are setting the PID constants continuously.\\u003c/p\\u003e\",\"post_number\":4,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:51:28.995Z\",\"reply_count\":2,\"reply_to_post_number\":3,\"quote_count\":0,\"incoming_link_count\":6,\"reads\":70,\"readers_count\":69,\"score\":54.0,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":2123,\"username\":\"Mark_McLeod\",\"name\":\"Mark McLeod\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mark_mcleod/{size}/65145_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/4\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014278,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2022-02-28T16:53:21.268Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"Henrique_Schmit\\\" data-post=\\\"4\\\" data-topic=\\\"404193\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/henrique_schmit/48/6495_2.png\\\" class=\\\"avatar\\\"\\u003e Henrique_Schmit:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003eOne thing we were speculating on was that maybe something is going wrong because we are setting the \\u003cspan class=\\\"abbreviation\\\"\\u003ePID\\u003ctemplate class=\\\"tooltiptext\\\" data-text=\\\"Proportional Integral Derivative\\\"\\u003e\\u003c/template\\u003e\\u003c/span\\u003e constants continuously.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eWhy are you doing this?  Gain scheduling is usually a design smell.\\u003c/p\\u003e\",\"post_number\":5,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:53:29.324Z\",\"reply_count\":1,\"reply_to_post_number\":4,\"quote_count\":1,\"incoming_link_count\":4,\"reads\":68,\"readers_count\":67,\"score\":38.6,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/5\",\"custom_user_title\":\"Robot apartments! invisible suburbs! skeleton treasuries!\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014280,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-02-28T16:56:14.409Z\",\"cooked\":\"\\u003cp\\u003eThe programmers that first coded this have told me it is done inside the loop so we can tune the PID on the fly and not have to reset everything whenever we change any values.\\u003c/p\\u003e\\n\\u003cp\\u003eI guess they haven’t considered doing something like Mark did to only set it when there are actual changes.\\u003c/p\\u003e\",\"post_number\":6,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:56:14.409Z\",\"reply_count\":1,\"reply_to_post_number\":5,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":69,\"readers_count\":68,\"score\":23.8,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/6\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014281,\"name\":\"Ryan Blue\",\"username\":\"Ryan_Blue\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/ryan_blue/{size}/174016_2.png\",\"created_at\":\"2022-02-28T16:56:26.654Z\",\"cooked\":\"\\u003cp\\u003eEvery time you call a pidf set gains command it sends a message out through the can bus, taking up cpu time and causing unnecessary congestion. Multiply that with doing that with multiple controllers and you quickly saturate your CAN bus and waste precious cpu cycles\\u003c/p\\u003e\",\"post_number\":7,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:57:31.042Z\",\"reply_count\":1,\"reply_to_post_number\":4,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":66,\"readers_count\":65,\"score\":23.2,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Ryan Blue\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":19526,\"username\":\"Henrique_Schmit\",\"name\":\"Henrique Schmitz\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":29846,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"WPILib Dev | 1024 Mentor\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/7\",\"custom_user_title\":\"WPILib Dev | 1024 Mentor\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014283,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-02-28T16:58:34.279Z\",\"cooked\":\"\\u003cp\\u003eAgreed. I am going to the lab right now and in around 30 min I’ll come back with a report on whether stopping the configuration spam helps it.\\u003c/p\\u003e\",\"post_number\":8,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:58:34.279Z\",\"reply_count\":1,\"reply_to_post_number\":7,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":66,\"readers_count\":65,\"score\":18.2,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":29846,\"username\":\"Ryan_Blue\",\"name\":\"Ryan Blue\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/ryan_blue/{size}/174016_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/8\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014284,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2022-02-28T16:58:34.804Z\",\"cooked\":\"\\u003caside class=\\\"quote no-group\\\" data-username=\\\"Henrique_Schmit\\\" data-post=\\\"6\\\" data-topic=\\\"404193\\\"\\u003e\\n\\u003cdiv class=\\\"title\\\"\\u003e\\n\\u003cdiv class=\\\"quote-controls\\\"\\u003e\\u003c/div\\u003e\\n\\u003cimg loading=\\\"lazy\\\" alt=\\\"\\\" width=\\\"24\\\" height=\\\"24\\\" src=\\\"https://www.chiefdelphi.com/user_avatar/www.chiefdelphi.com/henrique_schmit/48/6495_2.png\\\" class=\\\"avatar\\\"\\u003e Henrique_Schmit:\\u003c/div\\u003e\\n\\u003cblockquote\\u003e\\n\\u003cp\\u003enot have to reset everything whenever we change any values.\\u003c/p\\u003e\\n\\u003c/blockquote\\u003e\\n\\u003c/aside\\u003e\\n\\u003cp\\u003eYou shouldn’t change gains while mechanisms are in-motion in an ad-hoc manner.  This is unsafe.\\u003c/p\\u003e\",\"post_number\":9,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T16:58:34.804Z\",\"reply_count\":0,\"reply_to_post_number\":6,\"quote_count\":1,\"incoming_link_count\":0,\"reads\":65,\"readers_count\":64,\"score\":13.0,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/9\",\"custom_user_title\":\"Robot apartments! invisible suburbs! skeleton treasuries!\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014290,\"name\":\"Ryan Blue\",\"username\":\"Ryan_Blue\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/ryan_blue/{size}/174016_2.png\",\"created_at\":\"2022-02-28T17:02:28.325Z\",\"cooked\":\"\\u003cp\\u003eI doubt that will fix it, I was just commenting on why Marks code looked the way it did.\\u003c/p\\u003e\",\"post_number\":10,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T17:03:46.551Z\",\"reply_count\":0,\"reply_to_post_number\":8,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":60,\"readers_count\":59,\"score\":12.0,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Ryan Blue\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":19526,\"username\":\"Henrique_Schmit\",\"name\":\"Henrique Schmitz\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":29846,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"WPILib Dev | 1024 Mentor\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/10\",\"custom_user_title\":\"WPILib Dev | 1024 Mentor\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014324,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-02-28T17:34:36.281Z\",\"cooked\":\"\\u003cp\\u003eI have tried stopping the spam of configuration, and the weird behavior is still there.\\u003c/p\\u003e\\n\\u003cp\\u003eThis image represents well what is weird here:\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cdiv class=\\\"lightbox-wrapper\\\"\\u003e\\u003ca class=\\\"lightbox\\\" href=\\\"https://www.chiefdelphi.com/uploads/default/original/3X/c/2/c26364b15a87318e5f796884d169a5e6761e4db9.png\\\" data-download-href=\\\"https://www.chiefdelphi.com/uploads/default/c26364b15a87318e5f796884d169a5e6761e4db9\\\" title=\\\"PID-Bug\\\"\\u003e\\u003cimg src=\\\"https://www.chiefdelphi.com/uploads/default/optimized/3X/c/2/c26364b15a87318e5f796884d169a5e6761e4db9_2_690x327.png\\\" alt=\\\"PID-Bug\\\" data-base62-sha1=\\\"rJDzRK3As9eXyiWfSTrWYU4ap1D\\\" width=\\\"690\\\" height=\\\"327\\\" srcset=\\\"https://www.chiefdelphi.com/uploads/default/optimized/3X/c/2/c26364b15a87318e5f796884d169a5e6761e4db9_2_690x327.png, https://www.chiefdelphi.com/uploads/default/optimized/3X/c/2/c26364b15a87318e5f796884d169a5e6761e4db9_2_1035x490.png 1.5x, https://www.chiefdelphi.com/uploads/default/optimized/3X/c/2/c26364b15a87318e5f796884d169a5e6761e4db9_2_1380x654.png 2x\\\" data-dominant-color=\\\"E2E2E2\\\"\\u003e\\u003cdiv class=\\\"meta\\\"\\u003e\\u003csvg class=\\\"fa d-icon d-icon-far-image svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#far-image\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003cspan class=\\\"filename\\\"\\u003ePID-Bug\\u003c/span\\u003e\\u003cspan class=\\\"informations\\\"\\u003e1738×825 82.9 KB\\u003c/span\\u003e\\u003csvg class=\\\"fa d-icon d-icon-discourse-expand svg-icon\\\" aria-hidden=\\\"true\\\"\\u003e\\u003cuse href=\\\"#discourse-expand\\\"\\u003e\\u003c/use\\u003e\\u003c/svg\\u003e\\u003c/div\\u003e\\u003c/a\\u003e\\u003c/div\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eThe only gain that is not zero is P. The setpoint is at 1900 RPM and the actual flywheel speed is closer to 2000 RPM. Meanwhile the output is still positive. On a purely P controller, this should not be possible.\\u003c/p\\u003e\\n\\u003cp\\u003eIs there something obvious that I am missing?\\u003c/p\\u003e\\n\\u003cp\\u003eEdit: Just FYI, where it says current is actually the motor output, we just didn’t change the name while we were testing this.\\u003c/p\\u003e\",\"post_number\":11,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T17:37:11.755Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":59,\"readers_count\":58,\"score\":21.8,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"link_counts\":[{\"url\":\"https://www.chiefdelphi.com/uploads/default/original/3X/c/2/c26364b15a87318e5f796884d169a5e6761e4db9.png\",\"internal\":true,\"reflection\":false,\"clicks\":0}],\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/11\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014336,\"name\":\"Mark McLeod\",\"username\":\"Mark_McLeod\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mark_mcleod/{size}/65145_2.png\",\"created_at\":\"2022-02-28T17:42:56.976Z\",\"cooked\":\"\\u003cp\\u003eWhy is I Zone 100000?\\u003c/p\\u003e\",\"post_number\":12,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T17:42:56.976Z\",\"reply_count\":1,\"reply_to_post_number\":11,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":56,\"readers_count\":55,\"score\":16.2,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Mark McLeod\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":19526,\"username\":\"Henrique_Schmit\",\"name\":\"Henrique Schmitz\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":2123,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Itinerant Troubleshooter\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/12\",\"custom_user_title\":\"Itinerant Troubleshooter\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014341,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-02-28T17:45:22.057Z\",\"cooked\":\"\\u003cp\\u003eAccording to the programmers, they set it this high to not limit the operation of the I gain. It seems a bit exaggerated, but it shouldn’t impact this P-only controller. Or do you think it might be?\\u003c/p\\u003e\",\"post_number\":13,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T17:45:22.057Z\",\"reply_count\":1,\"reply_to_post_number\":12,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":56,\"readers_count\":55,\"score\":16.2,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":2123,\"username\":\"Mark_McLeod\",\"name\":\"Mark McLeod\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mark_mcleod/{size}/65145_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/13\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014348,\"name\":\"Mark McLeod\",\"username\":\"Mark_McLeod\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mark_mcleod/{size}/65145_2.png\",\"created_at\":\"2022-02-28T17:49:56.900Z\",\"cooked\":\"\\u003cp\\u003eWith an I of 0.0 it probably doesn’t matter, but on general debugging principle it’s always clearer to have everything not being used set to zero.\\u003c/p\\u003e\\n\\u003cp\\u003eDoes the rpm chart change when you change your setpoint?\\u003cbr\\u003e\\nThere may be a minor issue with the math in the code than gives you a slight increase over the value you expected. If changing the setpoint is followed by the chart output then it may just be a plotting issue.\\u003c/p\\u003e\",\"post_number\":14,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T17:55:17.594Z\",\"reply_count\":1,\"reply_to_post_number\":13,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":58,\"readers_count\":57,\"score\":16.6,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Mark McLeod\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":19526,\"username\":\"Henrique_Schmit\",\"name\":\"Henrique Schmitz\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":2123,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Itinerant Troubleshooter\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/14\",\"custom_user_title\":\"Itinerant Troubleshooter\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3014363,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-02-28T18:02:43.700Z\",\"cooked\":\"\\u003cp\\u003eWill zero the I to avoid any interactions with the rest of the PID.\\u003c/p\\u003e\\n\\u003cp\\u003eThe chart is working like you would expect, I can see the rpm ramping up to this value.\\u003c/p\\u003e\\n\\u003cp\\u003eI will have a look to see if there is anything that could skew the chart. Some other things we will check is if there is any configuration on the spark that might be conflicting with what the robot is telling it to do and also improve the code to stop spamming the set output.\\u003c/p\\u003e\\n\\u003cp\\u003eFor that second bit I need to do a bit of refactoring. After that I will be able to share the code in a readable way too. I’ll be back later on with updates.\\u003c/p\\u003e\\n\\u003cp\\u003eThanks for the help so far \\u003cimg src=\\\"https://www.chiefdelphi.com/images/emoji/google/slight_smile.png?v=9\\\" title=\\\":slight_smile:\\\" class=\\\"emoji\\\" alt=\\\":slight_smile:\\\"\\u003e\\u003c/p\\u003e\",\"post_number\":15,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-02-28T18:02:43.700Z\",\"reply_count\":0,\"reply_to_post_number\":14,\"quote_count\":0,\"incoming_link_count\":4,\"reads\":58,\"readers_count\":57,\"score\":31.6,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":2123,\"username\":\"Mark_McLeod\",\"name\":\"Mark McLeod\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mark_mcleod/{size}/65145_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/15\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3024197,\"name\":\"Henrique Schmitz\",\"username\":\"Henrique_Schmit\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"created_at\":\"2022-03-16T14:43:42.099Z\",\"cooked\":\"\\u003cp\\u003eHello everyone,\\u003c/p\\u003e\\n\\u003cp\\u003eLater happened to be quite a bit later. We had an international trip and a regional coming up, so there was not much time to write a decent report. Now that we are back I want to leave our results here for any time travelers from the future doing research.\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cstrong\\u003eOn the Spark Max’s PID\\u003c/strong\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eFor our shooter flywheel it has been pretty disappointing. Like I have shown on the post before, it still does some things that a PID should not. We haven’t been able to pinpoint why. At the moment we have been able to tune it with P and F to get a decent result. It can repeatedly get to a set speed (even though it is higher than our actual setpoint) and it can be very stable.\\u003c/p\\u003e\\n\\u003cp\\u003eThe main problems still present on our setup are that it never sends over 0.4 to the motors and that appears to be making the recovery a bit worse than it should.\\u003c/p\\u003e\\n\\u003cp\\u003e\\u003cstrong\\u003eOur Ugly Fix\\u003c/strong\\u003e\\u003c/p\\u003e\\n\\u003cp\\u003eThe worst problem we had was underusing the neos we had, by sending a maximum of 40% voltage to them, the control loop was capping our power at 16%, which is pretty absurd. We have managed to fix that by starting with a bang bang control and moving to a PID.\\u003c/p\\u003e\\n\\u003cp\\u003eWe first started by setting the motor output to 1 as long as the measured speed was under 80% of the setpoint. This made sure that we could cut most of the time for speeding up and then move to a proper control loop to get a stable speed.\\u003c/p\\u003e\\n\\u003cp\\u003eWe found that the neos would make very unhappy noises when we sent 100% power to them. It looked like there was some heavy slipping going on at the motor’s rotor. The measured speed also went all over, which was probably unsettling our \\u003cem\\u003every advanced control loop\\u003c/em\\u003e. To fix that we also implemented a soft starter on our control loop. Basically when we start up the motors we send 0.6 to the motors for 100ms so they start moving and we decrease the impact created by the bang bang part of the controller.\\u003c/p\\u003e\\n\\u003cp\\u003eAll of this improved our shooter performance a lot, but I am still not very happy with it. We have a long list of improvements for worlds, but if we can get around to this, I would like to still improve the stability and recovery on this controller.\\u003c/p\\u003e\\n\\u003cp\\u003eThanks for all the help so far and I am open for suggestions so far on how to improve this system.\\u003c/p\\u003e\",\"post_number\":16,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-03-16T14:44:51.291Z\",\"reply_count\":1,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":3,\"reads\":47,\"readers_count\":46,\"score\":29.4,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Henrique Schmitz\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":19526,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/16\",\"custom_user_title\":\"Henrique Schmitz, 1156 Mentor / Drive Coach\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3024216,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2022-03-16T15:22:29.124Z\",\"cooked\":\"\\u003cp\\u003eAre you using the internal NEO sensor?  There’s ~110ms of lag due to the hardcoded firmware filter…\\u003c/p\\u003e\",\"post_number\":17,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-03-16T15:22:29.124Z\",\"reply_count\":2,\"reply_to_post_number\":null,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":44,\"readers_count\":43,\"score\":18.8,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/17\",\"custom_user_title\":\"Robot apartments! invisible suburbs! skeleton treasuries!\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3024222,\"name\":\"Tom Line\",\"username\":\"Tom_Line\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/tom_line/{size}/236809_2.png\",\"created_at\":\"2022-03-16T15:35:18.563Z\",\"cooked\":\"\\u003cp\\u003eJust to be clear.  If you use ONLY a feed forward term, you should get to your setpoint.  If you put in a stupidly high setpoint, you should see the motor output go to 1.\\u003c/p\\u003e\\n\\u003cp\\u003eAre you seeing that behavior?\\u003c/p\\u003e\",\"post_number\":18,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-03-16T15:35:18.563Z\",\"reply_count\":1,\"reply_to_post_number\":16,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":40,\"readers_count\":39,\"score\":13.0,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Tom Line\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":19526,\"username\":\"Henrique_Schmit\",\"name\":\"Henrique Schmitz\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":7841,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Team 1498\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/18\",\"custom_user_title\":\"Team 1498\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3024228,\"name\":\"Samuel Tremblay\",\"username\":\"SamTrmbl\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/s/97f17d/{size}.png\",\"created_at\":\"2022-03-16T15:47:37.708Z\",\"cooked\":\"\\u003cp\\u003eWe are using the internal NEO sensors for our flywheel controlled with a feedforward and a proportional feedback and we do not have this issue…\\u003c/p\\u003e\",\"post_number\":19,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-03-16T15:47:37.708Z\",\"reply_count\":2,\"reply_to_post_number\":17,\"quote_count\":0,\"incoming_link_count\":0,\"reads\":34,\"readers_count\":33,\"score\":16.8,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Samuel Tremblay\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":1,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":null,\"reply_to_user\":{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":45293,\"hidden\":false,\"trust_level\":1,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":null,\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/19\",\"custom_user_title\":null,\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null},{\"id\":3024229,\"name\":\"Eli Barnett\",\"username\":\"Oblarg\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"created_at\":\"2022-03-16T15:48:35.341Z\",\"cooked\":\"\\u003cp\\u003eYou definitely do have the issue; you likely have chosen a proportional gain small enough that it is not really doing anything and you are effectively running open-loop control.\\u003c/p\\u003e\\n\\u003cp\\u003eThere’s no escaping it, and the math is not pretty.\\u003c/p\\u003e\",\"post_number\":20,\"post_type\":1,\"posts_count\":26,\"updated_at\":\"2022-03-16T15:48:35.557Z\",\"reply_count\":0,\"reply_to_post_number\":19,\"quote_count\":0,\"incoming_link_count\":1,\"reads\":32,\"readers_count\":31,\"score\":11.4,\"yours\":false,\"topic_id\":404193,\"topic_slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"display_username\":\"Eli Barnett\",\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_bg_color\":null,\"flair_color\":null,\"flair_group_id\":null,\"badges_granted\":[],\"version\":2,\"can_edit\":false,\"can_delete\":false,\"can_recover\":false,\"can_see_hidden_post\":true,\"can_wiki\":false,\"read\":true,\"user_title\":\"\",\"reply_to_user\":{\"id\":45293,\"username\":\"SamTrmbl\",\"name\":\"Samuel Tremblay\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/s/97f17d/{size}.png\"},\"bookmarked\":false,\"actions_summary\":[],\"moderator\":false,\"admin\":false,\"staff\":false,\"user_id\":12381,\"hidden\":false,\"trust_level\":2,\"deleted_at\":null,\"user_deleted\":false,\"edit_reason\":\"Automatically removed quote of whole previous post.\",\"can_view_edit_history\":true,\"wiki\":false,\"user_custom_fields\":{\"user_field_4\":\"Robot apartments! invisible suburbs! skeleton treasuries!\"},\"post_url\":\"/t/spark-max-internal-pid-not-working-as-expected-labview/404193/20\",\"custom_user_title\":\"Robot apartments! invisible suburbs! skeleton treasuries!\",\"reactions\":[],\"current_user_reaction\":null,\"reaction_users_count\":0,\"current_user_used_main_reaction\":false,\"can_accept_answer\":false,\"can_unaccept_answer\":false,\"accepted_answer\":false,\"topic_accepted_answer\":null}],\"stream\":[3014247,3014257,3014268,3014277,3014278,3014280,3014281,3014283,3014284,3014290,3014324,3014336,3014341,3014348,3014363,3024197,3024216,3024222,3024228,3024229,3024230,3024237,3024249,3024252,3024254,3166164]},\"timeline_lookup\":[[1,1322],[4,1321],[16,1306],[26,941]],\"tags\":[\"sparkmax\",\"labview\",\"neo\"],\"tags_descriptions\":{},\"fancy_title\":\"Spark Max internal PID not working as expected [LabVIEW]\",\"id\":404193,\"title\":\"Spark Max internal PID not working as expected [LabVIEW]\",\"posts_count\":26,\"created_at\":\"2022-02-28T16:12:39.986Z\",\"views\":1564,\"reply_count\":19,\"like_count\":3,\"last_posted_at\":\"2023-03-16T16:32:03.980Z\",\"visible\":true,\"closed\":true,\"archived\":false,\"has_summary\":false,\"archetype\":\"regular\",\"slug\":\"spark-max-internal-pid-not-working-as-expected-labview\",\"category_id\":73,\"word_count\":1877,\"deleted_at\":null,\"user_id\":19526,\"featured_link\":null,\"pinned_globally\":false,\"pinned_at\":null,\"pinned_until\":null,\"image_url\":null,\"slow_mode_seconds\":0,\"draft\":null,\"draft_key\":\"topic_404193\",\"draft_sequence\":null,\"unpinned\":null,\"pinned\":false,\"current_post_number\":1,\"highest_post_number\":26,\"deleted_by\":null,\"actions_summary\":[{\"id\":4,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":8,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":10,\"count\":0,\"hidden\":false,\"can_act\":false},{\"id\":7,\"count\":0,\"hidden\":false,\"can_act\":false}],\"chunk_size\":20,\"bookmarked\":false,\"topic_timer\":null,\"message_bus_last_id\":0,\"participant_count\":6,\"show_read_indicator\":false,\"thumbnails\":null,\"slow_mode_enabled_until\":null,\"valid_reactions\":[\"heart\",\"laughing\",\"point_up\",\"+1\",\"-1\",\"100\",\"open_mouth\",\"cry\",\"question\",\"thinking\",\"call_me_hand\",\"hugs\",\"angry\"],\"user_chosen_thumbnail_url\":null,\"sidecar_installed\":true,\"can_vote\":false,\"vote_count\":0,\"user_voted\":false,\"discourse_zendesk_plugin_zendesk_id\":null,\"discourse_zendesk_plugin_zendesk_url\":\"https://your-url.zendesk.com/agent/tickets/\",\"details\":{\"can_edit\":false,\"notification_level\":1,\"participants\":[{\"id\":19526,\"username\":\"Henrique_Schmit\",\"name\":\"Henrique Schmitz\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\",\"post_count\":10,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":12381,\"username\":\"Oblarg\",\"name\":\"Eli Barnett\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/oblarg/{size}/161674_2.png\",\"post_count\":6,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":2123,\"username\":\"Mark_McLeod\",\"name\":\"Mark McLeod\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/mark_mcleod/{size}/65145_2.png\",\"post_count\":3,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":29846,\"username\":\"Ryan_Blue\",\"name\":\"Ryan Blue\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/ryan_blue/{size}/174016_2.png\",\"post_count\":3,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2},{\"id\":45293,\"username\":\"SamTrmbl\",\"name\":\"Samuel Tremblay\",\"avatar_template\":\"/letter_avatar_proxy/v4/letter/s/97f17d/{size}.png\",\"post_count\":2,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":1},{\"id\":7841,\"username\":\"Tom_Line\",\"name\":\"Tom Line\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/tom_line/{size}/236809_2.png\",\"post_count\":1,\"primary_group_name\":null,\"flair_name\":null,\"flair_url\":null,\"flair_color\":null,\"flair_bg_color\":null,\"flair_group_id\":null,\"trust_level\":2}],\"created_by\":{\"id\":19526,\"username\":\"Henrique_Schmit\",\"name\":\"Henrique Schmitz\",\"avatar_template\":\"/user_avatar/www.chiefdelphi.com/henrique_schmit/{size}/6495_2.png\"},\"last_poster\":{\"id\":-1,\"username\":\"system\",\"name\":\"system\",\"avatar_template\":\"/uploads/default/original/4X/9/3/2/93234578e69f55873c63fc00fe2d0d85f23bce55.png\"},\"links\":[{\"url\":\"https://docs.revrobotics.com/sparkmax/operating-modes/closed-loop-control\",\"title\":\"Closed Loop Control - SPARK MAX\",\"internal\":false,\"attachment\":false,\"reflection\":false,\"clicks\":16,\"user_id\":19526,\"domain\":\"docs.revrobotics.com\",\"root_domain\":\"revrobotics.com\"},{\"url\":\"https://www.chiefdelphi.com/t/tune-rev-spark-max-pid-for-shooter/379068\",\"title\":\"Tune REV Spark Max PID for shooter\",\"internal\":true,\"attachment\":false,\"reflection\":false,\"clicks\":3,\"user_id\":19526,\"domain\":\"www.chiefdelphi.com\",\"root_domain\":\"chiefdelphi.com\"},{\"url\":\"https://www.chiefdelphi.com/t/spark-max-pid-velocity-control-spark-max-reaches-set-point-and-then/378976\",\"title\":\"Spark Max PID Velocity control, Spark Max reaches set point and then\",\"internal\":true,\"attachment\":false,\"reflection\":false,\"clicks\":1,\"user_id\":19526,\"domain\":\"www.chiefdelphi.com\",\"root_domain\":\"chiefdelphi.com\"}]},\"bookmarks\":[]}"}
